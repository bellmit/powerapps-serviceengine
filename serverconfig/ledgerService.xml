<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ledgerService">
<resultMap class="hmap" id="getGeneralAccountTypeCodes">
 <result property="CODE" javaType="string"/>
</resultMap>
<select id="getGeneralAccountTypeCodes" resultMap="getGeneralAccountTypeCodes" parameterClass="map">
select '100' <include refid="fromdual"/> union
select '110' <include refid="fromdual"/> union
select '200' <include refid="fromdual"/> union
select '300' <include refid="fromdual"/> union
select '400' <include refid="fromdual"/> union
select '500' <include refid="fromdual"/> union
select '720' <include refid="fromdual"/> union
select '721' <include refid="fromdual"/> union
select '730' <include refid="fromdual"/> union
select '740' <include refid="fromdual"/> union
select '910' <include refid="fromdual"/> union
select '911' <include refid="fromdual"/> union
select '920' <include refid="fromdual"/> union
select '930' <include refid="fromdual"/> union
select '940' <include refid="fromdual"/> union
select '972' <include refid="fromdual"/> union
select '973' <include refid="fromdual"/> union
select '974' <include refid="fromdual"/>
</select>
<select id="getPenaltyAccountTypeCodes" resultMap="getGeneralAccountTypeCodes" parameterClass="map">
select '110' <include refid="fromdual"/>
union
select '200' <include refid="fromdual"/>
union
select '720' <include refid="fromdual"/>
<isEqual property="PENALTY_MODE_ID" compareValue="1">
union
select '400' <include refid="fromdual"/>
union
select '740' <include refid="fromdual"/>
</isEqual>
<isEqual property="PENALTY_MODE_ID" compareValue="2">
union
select '100' <include refid="fromdual"/>
</isEqual>
</select>
<insert id="insertLedgerForAccount" parameterClass="map">
<selectKey keyProperty="ID" resultClass="long"><include refid="sequencePrefix"/>PTRACCOUNT_LEDGER_ID<include refid="sequenceSuffix"/></selectKey>
insert into PTRACCOUNT_LEDGER (ID, ACCOUNT_ID, CREATED_DATE, PROCESSED_TO_DATE, LEDGER_TYPE_ID, DISABLE)
values (#ID#, #ACCOUNT_ID#, #EFFECTIVE_DATE#, #EFFECTIVE_DATE#, 1, 0)
</insert>
<update id="disablePreviousLedger" parameterClass="map">
	update PTRACCOUNT_LEDGER set disable = 1 where ACCOUNT_ID=#ACCOUNT_ID# and LEDGER_TYPE_ID=1
</update>
<resultMap id="getLedgerStartingBalances" class="java.util.HashMap">
 <result property="PRINCIPAL_AMOUNT" javaType="$"/>
 <result property="PRINCIPAL_OVERDUE_AMOUNT" javaType="$"/>
 <result property="INTEREST_AMOUNT" javaType="$"/>
 <result property="CHARGE_AMOUNT" javaType="$"/>
 <result property="PENALTY_AMOUNT" javaType="$"/>
 <result property="INTEREST_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="CHARGE_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="PENALTY_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="CURRENCY" javaType="string"/>
</resultMap>
<select id="getLedgerStartingBalances" resultMap="getLedgerStartingBalances" parameterClass="map">
select cast(#OPENING_BALANCE_AMOUNT# as DECIMAL(24, 2)), 0, 0, 0, 0, 0, 0, 0, 'MYR'
<include refid="fromdual"/>
</select>


<resultMap id="getLedgerProcessedToDate" class="java.util.HashMap">
 <result property="PROCESSED_TO_DATE" javaType="date"/>
</resultMap>
<select id="getLedgerProcessedToDate" resultMap="getLedgerProcessedToDate" parameterClass="map">
select PROCESSED_TO_DATE from PTRACCOUNT_LEDGER where ID = #LEDGER_ID#
</select>
<update id="updateLedgerProcessedToDate">
update PTRACCOUNT_LEDGER set PROCESSED_TO_DATE = #EFFECTIVE_DATE#
where ID = #LEDGER_ID#
</update>
<resultMap id="getAccountCurrentLedger" class="java.util.HashMap">
 <result property="LEDGER_ID" javaType="long"/>
</resultMap>
<select id="getAccountCurrentLedger" resultMap="getAccountCurrentLedger" parameterClass="map">
select max(ID) from PTRACCOUNT_LEDGER
where ACCOUNT_ID = #ACCOUNT_ID# and ledger_type_id=1
  and DISABLE = 0
</select>


<resultMap id="getDefaultInterestScheduleForLedger" class="java.util.HashMap">
 <result property="ENTRY_CYCLE" />
 <result property="ENTRY_DATE" javaType="date"/>
 <result property="ENTRY_RATE" javaType="$" />
 <result property="P" />
</resultMap>
<select id="getDefaultInterestScheduleForLedger" resultMap="getDefaultInterestScheduleForLedger" parameterClass="map">
select '31', CAST(#EFFECTIVE_DATE:DATE# as DATE), COALESCE(CAST(#INTEREST_RATE:NUMERIC# as DECIMAL(20,6)), 0.10), 'P'
<include refid="fromdual"/>
</select>
<resultMap id="getAmountsForProjection" class="java.util.HashMap">
 <result property="OPENING_BALANCE_AMOUNT" javaType="$" />
 <result property="INSTALLMENT_AMOUNT" javaType="$" />
</resultMap>
<select id="getAmountsForProjection" resultMap="getAmountsForProjection" parameterClass="map">
select CAST(#OPENING_BALANCE_AMOUNT# as DECIMAL(20,2)),
 CAST(#INSTALLMENT_AMOUNT# as DECIMAL(20,2))
<include refid="fromdual"/>
</select>

</sqlMap>

