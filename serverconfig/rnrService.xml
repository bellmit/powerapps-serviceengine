<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="rnrService">

<resultMap class="hmap" id="validateUpfrontPaymentDate">
<result property="validateUpfrontPaymentDate" javaType="boolean"/>
</resultMap>

<select id="validateUpfrontPaymentDate" resultMap="validateUpfrontPaymentDate">
select case when cast(#UPFRONT_PAYMENT# as decimal(19,5)) &gt; 0 then 1 else 0 end <include refid="fromdual"/>
</select>

	<resultMap class="hmap" id="getTreatmentRnrOsBalanceAmount">
		<result property="OUTSTANDING_BALANCE_AMOUNT" javaType="$" />
	</resultMap>

	<select id="getTreatmentRnrCurrentTotalOsAmount" resultMap="getTreatmentRnrOsBalanceAmount">
		select case when rnr.OS_BALANCE_TYPE_ID = 1 then
		coalesce(rnr.OUTSTANDING_BALANCE_AMOUNT,a.payoff_amount) else
		a.payoff_amount end as OUTSTANDING_BALANCE_AMOUNT
		from ptraccount a
		left join ptrtreatment_rnr rnr on a.id = rnr.account_id and rnr.treatment_id = #TREATMENT_ID#
		where a.id = #ACCOUNT_ID#
	</select>
	<select id="getTreatmentRnrMemoInputAmount" resultMap="getTreatmentRnrOsBalanceAmount">
		select case when rnr.OS_BALANCE_TYPE_ID = 2 then
		rnr.OUTSTANDING_BALANCE_AMOUNT else null end as
		OUTSTANDING_BALANCE_AMOUNT
		from ptraccount a
		left join ptrtreatment_rnr rnr on a.account_id = rnr.account_id and rnr.treatment_id = #TREATMENT_ID#
		where a.id = #ACCOUNT_ID#
	</select>
<select id="getTreatmentRnrJudgementInputAmount" resultMap="getTreatmentRnrOsBalanceAmount">
	select case when rnr.OS_BALANCE_TYPE_ID = 3 then
	rnr.OUTSTANDING_BALANCE_AMOUNT else null end as
	OUTSTANDING_BALANCE_AMOUNT
	from ptraccount a
	left join ptrtreatment_rnr rnr on a.id = rnr.account_id and rnr.treatment_id = #TREATMENT_ID#
	where a.id = #ACCOUNT_ID#
</select>
<select id="getTreatmentRnrManualInputAmount" resultMap="getTreatmentRnrOsBalanceAmount">
	select case when rnr.OS_BALANCE_TYPE_ID = 4 then rnr.OUTSTANDING_BALANCE_AMOUNT else null end as OUTSTANDING_BALANCE_AMOUNT 
	from ptraccount a
	left join ptrtreatment_rnr rnr on a.id = rnr.account_id and rnr.treatment_id = #TREATMENT_ID#
	where a.id = #ACCOUNT_ID#
</select>



	<resultMap id="getDecimalConversion" class="java.util.HashMap">
		<result property="POST" javaType="string" />
		<result property="BILLING_DATE" javaType="date" />
		<result property="RATE" javaType="$" />
		<result property="BILLING_CYCLE" javaType="string" />
	</resultMap>
	<select id="getDecimalConversion" resultMap="getDecimalConversion">
		select 'P',cast(#DATE# as date),cast(#RATE# as
		DECIMAL(19,5)),cast(#BILLING_CYCLE# as varchar(2))
		<include refid="fromdual" />
	</select>

	<resultMap class="hmap" id="getDecimalSettlementAmountConversion">
		<result property="SETTLEMENT_AMOUNT" javaType="$" />
	</resultMap>

	<select id="getDecimalSettlementAmountConversion" resultMap="getDecimalSettlementAmountConversion">
		select cast(#SETTLEMENT_AMOUNT# as DECIMAL(19,5))
		<include refid="fromdual" />
	</select>

	<resultMap class="hmap" id="getAccountDetailsForTreatment">
		<result property="SPTF_FLAG" javaType="long" />
		<result property="PRODUCT_TYPE_CATEGORY_CODE" javaType="string" />
		<result property="OS_BALANCE" javaType="$" />
	</resultMap>

	<select id="getAccountDetailsForTreatment" resultMap="getAccountDetailsForTreatment">
		select
		NULL, cat.CODE, acc.CURRENT_BALANCE
		from PTRACCOUNT acc
		inner join PTRPRODUCT_TYPE_REF pro on pro.ID=acc.PRODUCT_TYPE_ID
		inner join PTRPRODUCT_TYPE_CATEGORY_REF cat on cat.ID=pro.CATEGORY_ID
		where
		acc.ID=#ACCOUNT_ID#
	</select>

	<resultMap class="hmap"
		id="getLegalAdditionalDetailsJudgementBreakdown">
		<result property="ACCOUNT_ID" javaType="long" />
		<result property="JUDGMENT_AMOUNT" javaType="$" />
		<result property="JUDGMENT_INTEREST" javaType="$" />
		<result property="COST_AWARD" javaType="$" />
		<result property="JUDGMENT_DATE" javaType="date" />
		<result property="LODR_DATE" javaType="date" />
	</resultMap>

	<select id="getLegalAdditionalDetailsJudgementBreakdown"
		resultMap="getLegalAdditionalDetailsJudgementBreakdown">
		select ad.ACCOUNT_ID,
		max(decode(upper(re.CODE),upper('jud_sum'),ad.AMOUNT_VALUE)) as
		JUDGMENT_AMOUNT,
		max(decode(upper(re.CODE),upper('jud-Interest'),ad.AMOUNT_VALUE)) as
		JUDGMENT_INTEREST,
		max(decode(upper(re.CODE),upper('cost_award'),ad.AMOUNT_VALUE)) as
		COST_AWARD,
		max(decode(upper(re.CODE),upper('JUD_OBT'),ad.DATE_VALUE)) as JUDGMENT_DATE,
		max(decode(upper(re.CODE),upper('LODR/T_ISSU'),ad.DATE_VALUE)) as
		LODR_DATE
		from PTRACCOUNT_ASSIGNMENT_LEGAL_ADDITIONAL_DETAILS_SUMMARY ad
		inner join PTRLEGAL_ADDITIONAL_DETAIL_REF re on re.ID=ad.FIELD_ID
		inner join PTRLEGAL_ADDITIONAL_DETAIL_TYPE_REF ty on ty.ID=re.TYPE_ID
		inner join PTRACCOUNT_AGENCY_ASSIGNMENT ass on ass.ID=ad.AGENCY_ASSIGNMENT_ID
		inner join PTRTREATPROC_SUBTYPE_REF sb on sb.TREATPROC_SUBTYPE_ID=ass.PROCESS_SUB_TYPE_ID
		where
		sb.TREATPROC_TYPE_ID=50 and
		ass.AGENCY_ID is not null and
		ass.ACKNOWLEDGEMENT_TIME is not null and
		ass.EFFECTIVE_DATE is not null and
		ty.CODE in ('2','4') and
		ad.ACCOUNT_ID=#ACCOUNT_ID#
		group by ad.ACCOUNT_ID
	</select>

	<resultMap id="getDaysOfMonth" class="hmap">
		<result property="DAY" javaType="long" />
		<result property="DESCRIPTION" />
	</resultMap>
	<select id="getDaysOfMonth" resultMap="getDaysOfMonth"
		parameterClass="map">
		select a.ID,a.DESCRIPTION
		from (
		values
		(null,'--Please Select--',0),
		('1','1st',1),
		('2','2nd',2),
		('3','3rd',3),
		('4','4th',4),
		('5','5th',5),
		('6','6th',6),
		('7','7th',7),
		('8','8th',8),
		('9','9th',9),
		('10','10th',10),
		('11','11th',11),
		('12','12th',12),
		('13','13th',13),
		('14','14th',14),
		('15','15th',15),
		('16','16th',16),
		('17','17th',17),
		('18','18th',18),
		('19','19th',19),
		('20','20th',20),
		('21','21st',21),
		('22','22nd',22),
		('23','23rd',23),
		('24','24th',24),
		('25','25th',25),
		('26','26th',26),
		('27','27th',27),
		('28','28th',28),
		('29','29th',29),
		('30','30th',30),
		('31','31st',31)
		)
		as a (ID,DESCRIPTION,SORT_PRIORITY)
		order by a.sort_priority
	</select>

	<select id="getRecoveryLedgerWaiverTypes" resultMap="global.ref">
		select ID, CODE, DESCRIPTION, DISABLE, SORT_PRIORITY
		from PTRRECOVERY_LEDGER_WAIVER_TYPE_REF
	</select>

	<resultMap class="hmap" id="getSettlementType">
		<result property="ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
	</resultMap>
	<select id="getSettlementType" resultMap="getSettlementType">
		select
		a.ID,a.DESCRIPTION from (
		values
		(null,'--Please Select--'),
		(1,'Fixed'),
		(2,'Variable')
		)
		as a (ID,DESCRIPTION)
	</select>

	<resultMap class="hmap" id="getSystemBreakdownDefault-rmap">
		<result property="BREAKDOWN_ID" javaType="long" />
		<result property="BREAKDOWN" javaType="string" />
		<result property="AMOUNT" javaType="$" />
		<result property="PROPOSED_PAYMENT_SUM" javaType="$" />
		<result property="WAIVER_AMOUNT" javaType="$" />
	</resultMap>

	<select id="getSystemBreakdownDefault" resultMap="getSystemBreakdownDefault-rmap">
		SELECT
		R.ID,R.DESCRIPTION,
		CASE
		WHEN R.CODE='PRINCIPAL' THEN 0
		WHEN R.CODE='INTEREST_IN_SUSPENSE' THEN 0
		WHEN R.CODE='OTHER_CHARGES' THEN 0
		WHEN R.CODE='LATE_CHARGES' THEN 0
		END AS AMOUNT,
		W.PROPOSED_PAYMENT_SUM,W.WAIVER_AMOUNT FROM
		PTRSYSTEM_BRAKEDOWN_REF R
		LEFT JOIN PTRTREATMENT_RNR_SYSTEM_BRAKEDOWN_WAIVER W ON R.ID=W.BRAKEDOWN_ID AND W.TREATMENT_ID=#TREATMENT_ID#
		LEFT JOIN PTRACCOUNT A ON A.ID=#ACCOUNT_ID#
		order by r.id asc
	</select>
	
	<select id="getSavedSystemBreakdownDefault" resultMap="getSystemBreakdownDefault-rmap">
		SELECT  R.ID,R.DESCRIPTION, w.AMOUNT,w.PROPOSED_PAYMENT_SUM,w.WAIVER_AMOUNT
		FROM PTRSYSTEM_BRAKEDOWN_REF R 
		LEFT JOIN PTRTREATMENT_RNR_SYSTEM_BRAKEDOWN_WAIVER W ON R.ID=W.BRAKEDOWN_ID AND W.TREATMENT_ID=#TREATMENT_ID#
		order by r.id asc
	</select>


	<select id="getJudgementBreakdownDefault" resultMap="getSystemBreakdownDefault-rmap">
		select r.id,r.description,coalesce(w.AMOUNT,coalesce(b.amount,0)) as
		AMOUNT,W.PROPOSED_PAYMENT_SUM,W.WAIVER_AMOUNT
		from
		PTRJUDGEMENT_BRAKEDOWN_REF r left join
		(select 1 as
		ID,coalesce(#JUDGMENT_AMOUNT:NUMERIC#,0) as AMOUNT
		<include refid="fromdual" />
		union
		select 2,coalesce((#JUDGMENT_AMOUNT:NUMERIC# *
		(#JUDGMENT_INTEREST:NUMERIC#/100)),0)
		<include refid="fromdual" />
		union
		select 3,coalesce(#COST_AWARD:NUMERIC#,0)
		<include refid="fromdual" />
		union
		select 4,coalesce(sum(t.AMOUNT),0) from PTRTRANSACTION t
		where
		<!-- t.POSTING_DATE >= (select po.LETTER_OF_TERMINATE_DATE from ptraccount_legal_action_civil 
			po where po.ACCOUNT_ID=#ACCOUNT_ID#) and t.DEBIT_CREDIT_FLAG = -1 and (t.AFFECTS_CODE 
			in ('P') or t.AFFECTS_CODE is null) and -->
		t.ACCOUNT_ID=#ACCOUNT_ID#
		) b on r.id=b.id
		LEFT JOIN
		PTRTREATMENT_RNR_JUDGEMENT_BRAKEDOWN_WAIVER W ON
		R.ID=W.BRAKEDOWN_ID
		AND W.TREATMENT_ID=#TREATMENT_ID#
	</select>

	<select id="getSavedJudgementBreakdownDefault" resultMap="getSystemBreakdownDefault-rmap">
		SELECT
		R.ID,R.DESCRIPTION, w.AMOUNT,w.PROPOSED_PAYMENT_SUM,w.WAIVER_AMOUNT
		FROM PTRJUDGEMENT_BRAKEDOWN_REF R
		LEFT JOIN PTRTREATMENT_RNR_JUDGEMENT_BRAKEDOWN_WAIVER W ON
		R.ID=W.BRAKEDOWN_ID AND W.TREATMENT_ID=#TREATMENT_ID#
	</select>

	<resultMap id="getPaymentReasonForRequestMattersForConsideration"
		class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="DISABLE" javaType="boolean" />
		<result property="SORT_PRIORITY" javaType="long" />
	</resultMap>

	<select id="getPaymentReasonForRequestMattersForConsideration"
		resultMap="getPaymentReasonForRequestMattersForConsideration">
		select null ,' ','--Please Select--',false,-1
		<include refid="fromdual" />
		union
		select ID,CODE,DESCRIPTION,DISABLE,SORT_PRIORITY from
		PTRPAYMENT_REASON_REF
		where CODE not in ('R18','R19')
	</select>

	<resultMap id="getPropertyStatusForCollateralTable" class="hmap">
		<result property="STATUS_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="STATUS" javaType="string" />
		<result property="DISABLE" javaType="boolean" />
		<result property="SORT_PRIORITY" javaType="string" />
	</resultMap>

	<select id="getPropertyStatusForCollateralTable" resultMap="getPropertyStatusForCollateralTable">
		select ID,CODE,DESCRIPTION,DISABLE,SORT_PRIORITY from
		PTRRECOVERY_LEDGER_PROPERTY_STATUS_REF
	</select>

	<resultMap class="hmap" id="getTpsCtos">
		<result property="FINANCIER" javaType="string" />
		<result property="VEH_NO" javaType="string" />
		<result property="MODEL" javaType="string" />
		<result property="AGRT_DATE" javaType="date" />
		<result property="TENOR" javaType="string" />
		<result property="OLD_REGISTRATION_NO" javaType="string" />
		<result property="INSURANCE_CO" javaType="string" />
		<result property="EXPIRY_DATE" javaType="date" />
		<result property="PLANTIF_NAME" javaType="string" />
		<result property="CIVIL_STATUS" javaType="string" />
		<result property="AMOUNT" javaType="long" />
		<result property="PETITON" javaType="date" />
		<result property="DISC_DATE" javaType="date" />
		<result property="ORDER_DATE" javaType="date" />
		<result property="LAWYER" javaType="string" />
		<result property="LAW_CONTACT_NO" javaType="string" />
		<result property="ROB" javaType="date" />
		<result property="SHAREHOLDER_PN" javaType="string" />
		<result property="SHAREHOLDER_PA" javaType="string" />
		<result property="DIRECTOR_NAME" javaType="string" />
		<result property="DIRECTOR_ADD" javaType="string" />
		<result property="COM_PAID" javaType="long" />
		<result property="SUBMITTED_DATE" javaType="date" />
		<result property="STATUS" javaType="string" />
		<result property="CATEGORY" javaType="string" />
		<result property="OWNER_NAME" javaType="string" />
		<result property="OWNER_ADD" javaType="string" />
	</resultMap>

	<select id="getTpsCtos" resultMap="getTpsCtos" parameterClass="map">
		SELECT
		a.FINANCIER,a.VEH_NO,a.MODEL,a.AGRT_DATE,TENOR,a.OLD_REGISTRATION_NO,a.INSURANCE_COM,
		a.EXPIRY_DATE,a.PLAINTIFF_NAME,a.SIVIL_STATUS,a.AMOUNT,a.PETITION_DATE,a.DISC_DATE,a.ORDER_DATE,a.PLAINTIFF_LAWYER,a.LAWYER_CONTACT_NO,
		a.REGISTRATION_EXPIRY_DATE,a.SHAREHOLDER_NAME,a.SHAREHOLDER_ADDRESS,a.DIRECTOR_NAME,a.DIRECTOR_ADDRESS,a.PAID_UP,a.SUBMITTED_DATE,
		a.STATUS,a.CATEGORY,a.OWNER_NAME,a.OWNER_ADDRESS FROM
		ptrtreatment_tps_internal a
		inner join ptrtreatment tp on
		tp.id=a.treatment_id
		where tp.ACCOUNT_ID=#ACCOUNT_ID#
		order by
		tp.CREATED_TIME desc
	</select>

	<resultMap class="hmap" id="getCcrisPaymentActivity">
		<result property="FACILITY" javaType="string" jdbcType="VARCHAR" />
		<result property="COUNT" javaType="long" jdbcType="NUMERIC" />
		<result property="LIMIT" javaType="double" jdbcType="NUMERIC" />
		<result property="OS" javaType="double" jdbcType="NUMERIC" />
		<result property="MIA" javaType="long" jdbcType="NUMERIC" />
		<result property="MIAMAX" javaType="long" jdbcType="NUMERIC" />
		<result property="ACCOUNT_ID" javaType="long" jdbcType="NUMERIC" />
		<result property="TREATMENT_PROCESS_ID" javaType="long"
			jdbcType="NUMERIC" />
		<result property="CUSTOMER_ID" javaType="long" />
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="RELATIONSHIP" javaType="string" />
	</resultMap>

	<select id="getCcrisPaymentActivity" resultMap="getCcrisPaymentActivity"
		parameterClass="map">
		select
		f.DESCRIPTION as FACILITY,
		a.COUNTER,
		a.LIMITER,
		a.OS,
		a.MIA,
		a.MIAMAX,
		a.ACCOUNT_ID,
		a.TREATMENT_ID,
		a.CUSTOMER_ID,
		c.CUSTOMER_NAME,
		tr.DESCRIPTION
		from ptrccris_payment_activity a
		left
		join PTRCUSTOMER c on a.CUSTOMER_ID=c.ID
		left join
		PTRCUSTOMER_ACCOUNT_REL r on r.ACCOUNT_ID=a.ACCOUNT_ID and
		r.CUSTOMER_ID=a.CUSTOMER_ID
		left join PTRCUSTOMER_ACCOUNT_REL_TYPE_REF
		tr on tr.ID=r.TYPE_ID
		left join ptrfacility_type_ref f on
		f.id=a.facility_id
		inner join ptrtreatment tp on tp.ID=a.TREATMENT_ID
		where tp.ACCOUNT_ID=#ACCOUNT_ID#
		order by tp.CREATED_TIME desc
	</select>

	<select id="getRnrApprovalAuthority" resultMap="global.ref">
		select null,'',' --Please Select-- ',false,-1
		<include refid="fromdual" />
		union
		select id,code,description,disable,sort_priority from
		PTRRNR_APPROVAL_AUTHORITY_REF
	</select>

	<resultMap id="getRecoveryLedgerTreatmentTypeId" class="hmap">
		<result property="PROCESS_TYPE_ID" javaType="long" />
	</resultMap>
	<select id="getRecoveryLedgerTreatmentTypeId" resultMap="getRecoveryLedgerTreatmentTypeId"
		parameterClass="map">
		select 49
		<include refid="fromdual" />
	</select>

	<resultMap class="hmap" id="getAccountCategoryAndStatus">
		<result property="PRODUCT_CATEGORY" javaType="string" />
		<result property="ACCOUNT_STATUS" javaType="string" />
		<result property="PRODUCT_CATEGORY_ID" javaType="string" />
	</resultMap>
	<select id="getAccountCategoryAndStatus" resultMap="getAccountCategoryAndStatus">
		select
		pc.CODE,s.CODE,r.CATEGORY_ID from ptraccount a
		inner join
		PTRPRODUCT_TYPE_REF r on a.PRODUCT_TYPE_ID=r.ID
		inner join
		PTRPRODUCT_TYPE_CATEGORY_REF pc on pc.ID=r.CATEGORY_ID
		left join
		PTRACCOUNT_STATUS_REF s on s.ID=a.STATUS_ID
		where a.ID=#ACCOUNT_ID#
	</select>

	<resultMap class="hmap" id="getRandRcountChecker">
		<result property="IMPLEMENTED_RNR_COUNT" />
	</resultMap>

	<select id="getRandRcountChecker" resultMap="getRandRcountChecker">
		select coalesce
		(count(*), 0) as IMPLEMENTED_RNR_COUNT from ptrtreatment c
		inner join
		PTRACCOUNT a on (a.ID = c.ACCOUNT_ID)
		where a.ID=#ACCOUNT_ID# and
		c.TYPE_ID = 49 and c.STATUS_ID in(15004)
	</select>

	<resultMap class="hmap" id="getAccountWorkListType">
		<result property="WORKLIST_TYPE_ID" javaType="long" />
		<result property="WORKLIST_TYPE" javaType="string" />
		<result property="YEAR_OF_FUNDED" javaType="string" />
	</resultMap>

	<select id="getAccountWorkListType" resultMap="getAccountWorkListType">
		select
		coalesce(rnr.WORKLIST_TYPE_ID,wl.WORK_LIST_GROUP) as
		work_list_type_id,
		wg.DESCRIPTION,
		coalesce(rnr.year_of_funded,cast(extract(year from a.release_date)as
		text))
		from
		ptraccount a
		left join PTRACCOUNT_WORK_LIST_ASSIGNMENT w on
		a.id=w.account_id
		left join ptrwork_list wl on
		wl.WORK_LIST_ID=w.WORK_LIST_ID
		left join PTRTREATMENT_RNR rnr on
		rnr.ACCOUNT_ID=a.ID and rnr.TREATMENT_ID = #TREATMENT_ID#
		left join
		ptrwork_list_category_ref wg on (wg.ID=wl.work_list_category) or
		(wg.ID=rnr.WORKLIST_TYPE_ID)
		where a.ID=#ACCOUNT_ID#
	</select>

	<resultMap class="hmap" id="getRandrCurrentNoOfTimes">
		<result property="CURRENT_NO_OF_TIME_IN_RNR" javaType="long" />
		<result property="PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR"
			javaType="long" />
		<result property="PREVIOUS_RNR_APPROVED_DATE" javaType="date" />
		<result property="YEAR_SINCE_RNR" javaType="string" />
		<result property="MONTH_SINCE_RNR" javaType="string" />
	</resultMap>

	<select id="getRandrCurrentNoOfTimes" resultMap="getRandrCurrentNoOfTimes">
		SELECT
		COALESCE(RNR.CURRENT_NO_OF_TIME_IN_RNR,R.CURRENT_NO_OF_TIME_IN_RNR,0),
		COALESCE(R.CURRENT_NO_OF_TIME_IN_RNR,0) AS
		PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR,
		R.PREVIOUS_RNR_APPROVED_DATE,
		null,null
		FROM
		PTRACCOUNT A
		LEFT JOIN PTRACCOUNT_RNR_INFORMATION R ON
		R.ACCOUNT_ID=A.ID
		LEFT JOIN PTRTREATMENT_RNR RNR ON
		RNR.ACCOUNT_ID=A.ID AND RNR.TREATMENT_ID=#TREATMENT_ID#
		WHERE
		A.ID=#ACCOUNT_ID#
	</select>

	<resultMap class="hmap" id="getAccountOsBalanceType">
		<result property="ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
	</resultMap>
	<select id="getAccountOsBalanceType" resultMap="getAccountOsBalanceType">
		select a.ID,a.DESCRIPTION from (
		values
		 <isNotEqual property="PRODUCT_CATEGORY" compareValue="PF">
			<isNotEqual property="PRODUCT_CATEGORY" compareValue="PFI">
				<isNotEqual property="PRODUCT_CATEGORY" compareValue="AF">
					(null,'Please Select')
				</isNotEqual>
			</isNotEqual>
		</isNotEqual>

		<isEqual property="PRODUCT_CATEGORY" compareValue="PF"> 
			(null,'Please Select'),
			(1,'Current Total O/S'),
			(2,'Memo
			Balance'),
			(3,'Judgment Balance'),
			(4,'Manual
			Input')
	 	</isEqual>
		<isEqual property="PRODUCT_CATEGORY" compareValue="AF">
			(null,'Please Select'),
			(1,'Current Total O/S'),
			(4,'Manual Input')
		</isEqual>
		<isEqual property="PRODUCT_CATEGORY" compareValue="PFI">
			(null,'Please Select'),
			(1,'Current Total O/S'),
			(4,'Manual Input')
		</isEqual>
		)
		as a (ID,DESCRIPTION)
	</select>

	<resultMap class="hmap" id="getCustomerAndGuarantor">
		<result property="CUSTOMER_ID" javaType="long" />
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="RELATIONSHIP_TYPE" javaType="string" />
		<result property="ACCOUNT_ID" javaType="java.lang.Long" />
		<result property="SORT" javaType="java.lang.Long" />
	</resultMap>


	<resultMap class="hmap" extends="getCustomerAndGuarantor"
		id="getCustomerforGeneralBackgroundInformation">
		<result property="NATURE_OF_BUSINESS" javaType="java.lang.String" />
		<result property="EMPLOYER_NAME" javaType="java.lang.String" />
		<result property="EMPLOYER_NATURE_OF_BUSINESS" javaType="java.lang.String" />
	</resultMap>

	<sql id="getCustomerAndGuarantor-Fragment">
		select
		c.ID,
		relref.DESCRIPTION||' -
		'||coalesce(c.CUSTOMER_NAME,'N/A') as CUSTOMER_NAME,
		relref.DESCRIPTION as RELATIONSHIP_TYPE,
		rel.ACCOUNT_ID,
		case when
		relref.id = 99 then 0 else 1 end as sort
	</sql>

	<sql id="getCustomerAndGuarantor-joinFragment">
		from PTRCUSTOMER_ACCOUNT_REL rel
		inner join PTRCUSTOMER c on
		rel.customer_id = c.id
		inner join ptrcustomer_account_relation_type_ref
		relref on rel.TYPE_ID =
		relref.id
	</sql>

	<select id="getCustomerforGeneralBackgroundInformation"
		resultMap="getCustomerforGeneralBackgroundInformation">
		<include refid="getCustomerAndGuarantor-Fragment" />
		,
		rc.NATURE_OF_BUSINESS,rc.EMPLOYER_NAME,EMPLOYER_NATURE_OF_BUSINESS
		<include refid="getCustomerAndGuarantor-joinFragment" />
		left join PTRTREATMENT_RNR_CUSTOMER rc on rc.customer_id=c.id and
		rc.TREATMENT_ID=#TREATMENT_ID#
		where rel.ACCOUNT_ID = #ACCOUNT_ID# and
		rel.HOST_SEQUENCE = (select max(a.HOST_SEQUENCE) from
		PTRCUSTOMER_ACCOUNT_REL a where
		a.ACCOUNT_ID=#ACCOUNT_ID# and
		a.CUSTOMER_ID=rel.CUSTOMER_ID)
		order by sort asc
	</select>

	<resultMap class="hmap" id="getCustomerforDebtServiceRatio"
		extends="getCustomerAndGuarantor">
		<result property="AGE" javaType="long" />
		<result property="SETTLEMENT_PERIOD" javaType="long" />
		<result property="AGENCY_AT_END_OF_SETTLEMENT" javaType="long" />
		<result property="EPF_ACCOUNT_ONE" javaType="$" />
		<result property="EPF_ACCOUNT_TWO" javaType="$" />
		<result property="TOTAL_EPF" javaType="$" />
		<result property="STATEMENT_DATE" javaType="date" />
	</resultMap>

	<select id="getCustomerforDebtServiceRatio" resultMap="getCustomerforDebtServiceRatio">
		<include refid="getCustomerAndGuarantor-Fragment" />
		,
		coalesce(rc.AGE,(extract(year from CURRENT_DATE) - extract(year from
		c.DATE_OF_BIRTH))) as
		AGE_THIS_YEAR ,
		coalesce(rc.SETTLEMENT_PERIOD,0),coalesce(rc.AGENCY_AT_END_OF_SETTLEMENT,0),coalesce(rc.EPF_ACCOUNT_ONE,0),coalesce(rc.EPF_ACCOUNT_TWO,0),
		coalesce(rc.TOTAL_EPF,0),STATEMENT_DATE
		<include refid="getCustomerAndGuarantor-joinFragment" />
		left join PTRTREATMENT_RNR_CUSTOMER_AGE_INFORMATION rc on rc.customer_id=c.id and rc.TREATMENT_ID=#TREATMENT_ID#
		where rel.ACCOUNT_ID = #ACCOUNT_ID#
		order by sort asc
	</select>

	<resultMap class="hmap" id="getCollateralBackgroundInformation">
		<result property="COLLATERAL_ID" javaType="long" />
		<result property="NAME" javaType="string" />
		<result property="REGISTRATION_NUMBER" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="STATUS" javaType="string" />
		<result property="STATUS_ID" javaType="long" />
		<result property="SALEABILITY" javaType="string" />
		<result property="YEAR_OF_MANUFACTURING" javaType="string" />
		<result property="MARKET_VALUE" javaType="double" />
		<result property="REMARKS" javaType="string" />
		<result property="HOST_ID" javaType="string" />
		<result property="LOAD_EXECUTION_ID" javaType="long" />
	</resultMap>


	<select id="getCollateralBackgroundInformation" resultMap="getCollateralBackgroundInformation">
		select distinct
		ac.COLLATERAL_ID,
		coalesce(c.NAME, ''),
		coalesce(c.registration_no, ''),
		c.DESCRIPTION,
		PR.DESCRIPTION AS STATUS,
		PR.ID,
		RC.SALEABILITY,
		c.year_of_manufacture,
		rc.market_value,
		rc.remarks,
		c.host_collateral_id,
		c.LOAD_EXECUTION_ID
		from ptraccount a
		inner join ptraccount_collateral_rel ac on a.id = ac.account_id
		inner join ptrcollateral c on ac.collateral_id = c.id
		inner join PTRCOLLATERAL_TYPE_REF cref on cref.id=c.TYPE_ID
		LEFT JOIN ptrtreatment_rnr_collateral RC ON
		ac.COLLATERAL_ID=RC.COLLATERAL_ID and rc.TREATMENT_ID=#TREATMENT_ID#
		LEFT JOIN ptrrecovery_ledger_property_status_ref PR ON
		RC.STATUS_ID=PR.ID
		where a.ID=#ACCOUNT_ID#<!-- and cref.code not in ('K01','K02','K03','K04','K05','K06','K07','K08','K10','K99') 
			and cref.code not in ('K01','K02','K03','K04','K05','K06','K07','K08','K10','K99') -->
		and c.LOAD_EXECUTION_ID is not null
	</select>

	<select id="getCollectionCentre" resultMap="global.ref">
		select null ,' ','--Please Select--',false,0
		<include refid="fromdual" />
		<!-- union select id,name,name,disable,0 from PTRCOLLECTION_CENTRE where 
			product_type_category_id =#PRODUCT_CATEGORY_ID# -->
	</select>

	<resultMap class="hmap" id="getRnrPrime">
		<result property="VARIANCE" javaType="double" />
		<result property="VARIANCE_REVISED" javaType="double" />
	</resultMap>
	<select id="getRnrPrime" resultMap="getRnrPrime">
		select coalesce(PRIME_VARIANCE/100,0),0 from PTRACCOUNT where ID=#ACCOUNT_ID#
	</select>

	<resultMap class="hmap" id="getRnrPrimeRate">
		<result property="PRIME_RATE" javaType="$" />
		<result property="PRIME_RATE_TYPE" javaType="long" />
	</resultMap>
	<select id="getRnrPrimeRate" resultMap="getRnrPrimeRate">
		select prime_rate_floor/100, 0 from PTRACCOUNT where ID=#ACCOUNT_ID#
		<include refid="fromdual" />
		<!-- SELECT case when ptc.PRODUCT_TYPE_CATEGORY_CODE in ('HP','FS','IH') 
			then 0 else coalesce(a.INTEREST_RATE,0) end ,rr.RATE_NUMBER from ptraccount 
			a inner join ptrproduct_type_ref ptr on a.product_type_id = ptr.product_type_id 
			inner join ptrproduct_type_category_ref ptc on ptr.product_type_category_id 
			= ptc.product_type_category_id left join PTRMASTER_RATE_REF rr on a.master_rate_id=rr.id 
			where a.ACCOUNT_ID=#ACCOUNT_ID# -->
	</select>

	<resultMap class="hmap" id="getTreatmentRnrAdhocDetails">
		<result property="OS_BALANCE_TYPE_ID" javaType="long" />
		<result property="SETTLEMENT_TYPE_ID" javaType="long" />
	</resultMap>

	<select id="getTreatmentRnrAdhocDetails" resultMap="getTreatmentRnrAdhocDetails">
		select OS_BALANCE_TYPE_ID, SETTLEMENT_TYPE_ID from PTRTREATMENT_RNR where TREATMENT_ID=#TREATMENT_ID#
	</select>

	<resultMap class="hmap" id="getTreatmentRnrSchedule">
		<result property="INSTALLMENT_START_DATE" javaType="date" />
		<result property="INSTALLMENT_END_DATE" javaType="date" />
		<result property="INSTALLMENT_AMOUNT" javaType="$" />
		<result property="PRINCIPAL_DUE_AMOUNT" javaType="$" />
		<result property="INTEREST_AMOUNT" javaType="$" />
		<result property="PRINCIPAL_REMAINING" javaType="$" />
		<result property="OPENING_PRINCIPAL" javaType="$" />
	</resultMap>

	<select id="getTreatmentRnrSchedule" resultMap="getTreatmentRnrSchedule">
		select INSTALLMENT_START_DATE,INSTALLMENT_END_DATE,
		INSTALLMENT_AMOUNT,PRINCIPAL_DUE_AMOUNT,INTEREST_AMOUNT,PRINCIPAL_REMAINING,
		OPENING_PRINCIPAL
		from PTRTREATMENT_RNR_SCHEDULE
		where TREATMENT_ID=#TREATMENT_ID# order by INSTALLMENT_START_DATE asc
	</select>

	<resultMap class="hmap" id="getTreatmentApprovedRnrSchedule">
		<result property="INSTALLMENT_START_DATE" javaType="date" />
		<result property="INSTALLMENT_END_DATE" javaType="date" />
		<result property="INSTALLMENT_AMOUNT" javaType="$" />
		<result property="OPENING_PRINCIPAL" javaType="$" />
		<result property="INTEREST_AMOUNT" javaType="$" />
		<result property="PRINCIPAL_REMAINING" javaType="$" />
	</resultMap>

	<select id="getTreatmentApprovedRnrSchedule" resultMap="getTreatmentApprovedRnrSchedule">
		select INSTALLMENT_START_DATE,INSTALLMENT_END_DATE,
		INSTALLMENT_AMOUNT,OPENING_PRINCIPAL,INTEREST_AMOUNT,PRINCIPAL_REMAINING
		from PTRTREATMENT_RNR_SCHEDULE
		where TREATMENT_ID=#TREATMENT_ID# order by INSTALLMENT_START_DATE asc
	</select>

<insert id="insertTreatmentRnr">  
	INSERT INTO PTRTREATMENT_RNR (TREATMENT_ID,ACCOUNT_ID,TOTAL_BALANCE_1,TOTAL_BALANCE_2,GRAND_TOTAL,
	CONNECTED_PARTY_ID,CTOS,CUSTOMER_REQUEST_DATE,CUSTOMER_REQUEST_RECEIVED_DATE,
	COLLECTION_CENTRE_ID,SHORTFALL,PARTIAL_WRITTEN_OFF,PARTIAL_WRITTEN_OFF_DATE,WORKLIST_TYPE_ID,
	CURRENT_NO_OF_TIME_IN_RNR,PREVIOUS_RNR_APPROVED_DATE,DURATION_FROM_PREVIOUS_RNR,PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR,
	INCOME_EVIDENCE,INCOME_EVIDENCE_REMARKS,RNR_REASON_ID,OTHER_RNR_REASON_REMARKS,NET_INCOME,OTHER_INCOME,TOTAL_INCOME,
	TOTAL_HOUSEHOLD_EXPENDITURES,TOTAL_FINANCIAL_COMMITMENTS,AMOUNT_TO_PAY_THE_BANK,DEBT_SERVICE_RATIO,REASON_OF_DEFAULT,
	YEAR_OF_FUNDED,SYSTEM_COMPUTATION_BREAKDOWN_TOTAL,SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM,SYSTEM_COMPUTATION_WAIVER_TOTAL,
	JUDGEMENT_BREAKDOWN_TOTAL,JUDGEMENT_PAYMENT_SUM_TOTAL,JUDGEMENT_WAIVER_TOTAL,SETTLEMENT_AMOUNT,WITH_FURTHER_INTEREST,
	UPFRONT_PAYMENT,PDC_REQUIRED,PDC_REMARKS,REVIEW_DATE,FIRST_PAYMENT_DUE_DATE,NEXT_PAYMENT_DUE_DATE,LATE_CHARGES,
	APPROVED_DATE,REJECTED_DATE,IMPLEMENTED_DATE,APPROVING_AUTHORITY_ID,REJECTED_REASON,SLO_ACCEPTANCE_DATE,
	FIRST_INSTALLMENT_RECEIVED_DATE,CANCEL_RNR_DATE,CANCEL_REASON,PHOTOCOPY_OF_IC,LPI,TEMPLATE_VERSION_ID,
	OS_BALANCE_TYPE_ID,OUTSTANDING_BALANCE_AMOUNT,UPFRONT_WAIVER_AMOUNT,INSTALLMENT_DUE_DAY,WITH_JUDGEMENT,SETTLEMENT_TYPE_ID,
	INTEREST_RATE,SETTLEMENT_MODE_ID,INSTALLMENT_AMOUNT,TENURE,MATTERS_FOR_CONSIDERATION,IS_APPROVED,FINALIZED_SETTLEMENT_AMOUNT,VARIANCE,VARIANCE_REVISED,
	PRIME_RATE,PRIME_RATE_TYPE,HQ_MANAGER_REMARKS,TEAM_MANAGER_REMARKS,TEAM_LEADER_REMARKS,BASIS_OF_RECOMMENDATION,
	TYPE_STATUS_ID,SUBTYPE_ID)values(#ID#,#ACCOUNT_ID#,#TOTAL_BALANCE_1#,#TOTAL_BALANCE_2#,#GRAND_TOTAL#,
	#CONNECTED_PARTY_ID#,#CTOS#,#CUSTOMER_REQUEST_DATE#,#CUSTOMER_REQUEST_RECEIVED_DATE#,
	#COLLECTION_CENTRE_ID#,#SHORTFALL#,#PARTIAL_WRITTEN_OFF#,#PARTIAL_WRITTEN_OFF_DATE#,#WORKLIST_TYPE_ID#,
	coalesce(#CURRENT_NO_OF_TIME_IN_RNR#,0) + 1,#PREVIOUS_RNR_APPROVED_DATE#,#DURATION_FROM_PREVIOUS_RNR#,#PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR#,
	#INCOME_EVIDENCE#,#INCOME_EVIDENCE_REMARKS#,#RNR_REASON_ID#,#OTHER_RNR_REASON_REMARKS#,#NET_INCOME#,#OTHER_INCOME#,#TOTAL_INCOME#,
	#TOTAL_HOUSEHOLD_EXPENDITURES#,#TOTAL_FINANCIAL_COMMITMENTS#,#AMOUNT_TO_PAY_THE_BANK#,#DEBT_SERVICE_RATIO#,#REASON_OF_DEFAULT#,
	#YEAR_OF_FUNDED#,#SYSTEM_COMPUTATION_BREAKDOWN_TOTAL#,#SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM#,#SYSTEM_COMPUTATION_WAIVER_TOTAL#,
	#JUDGEMENT_BREAKDOWN_TOTAL#,#JUDGEMENT_PAYMENT_SUM_TOTAL#,#JUDGEMENT_WAIVER_TOTAL#,#SETTLEMENT_AMOUNT#,#WITH_FURTHER_INTEREST#,
	#UPFRONT_PAYMENT#,#PDC_REQUIRED#,#PDC_REMARKS#,#REVIEW_DATE#,#FIRST_PAYMENT_DUE_DATE#,#NEXT_PAYMENT_DUE_DATE#,#LATE_CHARGES#,
	#APPROVED_DATE#,#REJECTED_DATE#,#IMPLEMENTED_DATE#,#APPROVING_AUTHORITY_ID#,#REJECTED_REASON#,#SLO_ACCEPTANCE_DATE#,
	#FIRST_INSTALLMENT_RECEIVED_DATE#,#CANCEL_RNR_DATE#,#CANCEL_REASON#,#PHOTOCOPY_OF_IC#,#LPI#,#TEMPLATE_VERSION_ID#,
	#OS_BALANCE_TYPE_ID#,#OUTSTANDING_BALANCE_AMOUNT#,#UPFRONT_WAIVER_AMOUNT#,#INSTALLMENT_DUE_DAY#,#WITH_JUDGEMENT#,#SETTLEMENT_TYPE_ID#,
	#INTEREST_RATE#,#SETTLEMENT_MODE_ID#,#INSTALLMENT_AMOUNT#,#TENURE#,#MATTERS_FOR_CONSIDERATION#,coalesce(#IS_APPROVED#,false),#FINALIZED_SETTLEMENT_AMOUNT#,#VARIANCE#,#VARIANCE_REVISED#,
	#PRIME_RATE#,#PRIME_RATE_TYPE#,#HQ_MANAGER_REMARKS#,#TEAM_MANAGER_REMARKS#,#TEAM_LEADER_REMARKS#,#BASIS_OF_RECOMMENDATION#,
	#TYPE_STATUS_ID#,#SUBTYPE_ID#)
</insert>
<update id="updateTreatmentRnr">
	update PTRTREATMENT_RNR
	set
	VARIANCE=#VARIANCE#,
	VARIANCE_REVISED=#VARIANCE_REVISED#,
	TOTAL_BALANCE_1=#TOTAL_BALANCE_1#,
	TOTAL_BALANCE_2=#TOTAL_BALANCE_2#,
	GRAND_TOTAL=#GRAND_TOTAL#,
	CONNECTED_PARTY_ID=#CONNECTED_PARTY_ID#,
	CTOS=#CTOS#,
	CUSTOMER_REQUEST_DATE=#CUSTOMER_REQUEST_DATE#,
	CUSTOMER_REQUEST_RECEIVED_DATE=#CUSTOMER_REQUEST_RECEIVED_DATE#,
	COLLECTION_CENTRE_ID=#COLLECTION_CENTRE_ID#,
	SHORTFALL=#SHORTFALL#,
	PARTIAL_WRITTEN_OFF=#PARTIAL_WRITTEN_OFF#,
	PARTIAL_WRITTEN_OFF_DATE=#PARTIAL_WRITTEN_OFF_DATE#,
	WORKLIST_TYPE_ID=#WORKLIST_TYPE_ID#,
	CURRENT_NO_OF_TIME_IN_RNR=#CURRENT_NO_OF_TIME_IN_RNR#,
	PREVIOUS_RNR_APPROVED_DATE=#PREVIOUS_RNR_APPROVED_DATE#,
	DURATION_FROM_PREVIOUS_RNR=#DURATION_FROM_PREVIOUS_RNR#,
	PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR=#PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR#,
	INCOME_EVIDENCE=#INCOME_EVIDENCE#,
	INCOME_EVIDENCE_REMARKS=#INCOME_EVIDENCE_REMARKS#,
	RNR_REASON_ID=#RNR_REASON_ID#,
	OTHER_RNR_REASON_REMARKS=#OTHER_RNR_REASON_REMARKS#,
	NET_INCOME=#NET_INCOME#,
	OTHER_INCOME=#OTHER_INCOME#,
	TOTAL_INCOME=#TOTAL_INCOME#,
	TOTAL_HOUSEHOLD_EXPENDITURES=#TOTAL_HOUSEHOLD_EXPENDITURES#,
	TOTAL_FINANCIAL_COMMITMENTS=#TOTAL_FINANCIAL_COMMITMENTS#,
	AMOUNT_TO_PAY_THE_BANK=#AMOUNT_TO_PAY_THE_BANK#,
	DEBT_SERVICE_RATIO=#DEBT_SERVICE_RATIO#,
	REASON_OF_DEFAULT=#REASON_OF_DEFAULT#,
	YEAR_OF_FUNDED=#YEAR_OF_FUNDED#,
	SYSTEM_COMPUTATION_BREAKDOWN_TOTAL=#SYSTEM_COMPUTATION_BREAKDOWN_TOTAL#,
	SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM=#SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM#,
	SYSTEM_COMPUTATION_WAIVER_TOTAL=#SYSTEM_COMPUTATION_WAIVER_TOTAL#,
	JUDGEMENT_BREAKDOWN_TOTAL=#JUDGEMENT_BREAKDOWN_TOTAL#,
	JUDGEMENT_PAYMENT_SUM_TOTAL=#JUDGEMENT_PAYMENT_SUM_TOTAL#,
	JUDGEMENT_WAIVER_TOTAL=#JUDGEMENT_WAIVER_TOTAL#,
	SETTLEMENT_AMOUNT=#SETTLEMENT_AMOUNT#,
	WITH_FURTHER_INTEREST=#WITH_FURTHER_INTEREST#,
	UPFRONT_PAYMENT=#UPFRONT_PAYMENT#,
	PDC_REQUIRED=#PDC_REQUIRED#,
	PDC_REMARKS=#PDC_REMARKS#,
	REVIEW_DATE=#REVIEW_DATE#,
	FIRST_PAYMENT_DUE_DATE=#FIRST_PAYMENT_DUE_DATE#,
	NEXT_PAYMENT_DUE_DATE=#NEXT_PAYMENT_DUE_DATE#,
	LATE_CHARGES=#LATE_CHARGES#,
	APPROVED_DATE=#APPROVED_DATE#,
	REJECTED_DATE=#REJECTED_DATE#,
	IMPLEMENTED_DATE=#IMPLEMENTED_DATE#,
	APPROVING_AUTHORITY_ID=#APPROVING_AUTHORITY_ID#,
	REJECTED_REASON=#REJECTED_REASON#,
	SLO_ACCEPTANCE_DATE=#SLO_ACCEPTANCE_DATE#,
	FIRST_INSTALLMENT_RECEIVED_DATE=#FIRST_INSTALLMENT_RECEIVED_DATE#,
	CANCEL_RNR_DATE=#CANCEL_RNR_DATE#,
	CANCEL_REASON=#CANCEL_REASON#,
	PHOTOCOPY_OF_IC=#PHOTOCOPY_OF_IC#,
	LPI	= #LPI#,
	TEMPLATE_VERSION_ID = #TEMPLATE_VERSION_ID#,
	OS_BALANCE_TYPE_ID = #OS_BALANCE_TYPE_ID#,
	OUTSTANDING_BALANCE_AMOUNT = #OUTSTANDING_BALANCE_AMOUNT#,
	UPFRONT_WAIVER_AMOUNT = #UPFRONT_WAIVER_AMOUNT#,
	INSTALLMENT_DUE_DAY = #INSTALLMENT_DUE_DAY#,
	WITH_JUDGEMENT = #WITH_JUDGEMENT#,
	SETTLEMENT_TYPE_ID = #SETTLEMENT_TYPE_ID#,
	INTEREST_RATE = #INTEREST_RATE#,
	SETTLEMENT_MODE_ID = #SETTLEMENT_MODE_ID#,
	INSTALLMENT_AMOUNT = #INSTALLMENT_AMOUNT#,
	TENURE = #TENURE#,
	MATTERS_FOR_CONSIDERATION = #MATTERS_FOR_CONSIDERATION#,
	IS_APPROVED=coalesce(#IS_APPROVED#,false),
	FINALIZED_SETTLEMENT_AMOUNT = #FINALIZED_SETTLEMENT_AMOUNT#,
	PRIME_RATE=#PRIME_RATE#,
	PRIME_RATE_TYPE=#PRIME_RATE_TYPE#,
	HQ_MANAGER_REMARKS=#HQ_MANAGER_REMARKS#,
	TEAM_MANAGER_REMARKS=#TEAM_MANAGER_REMARKS#,
	TEAM_LEADER_REMARKS=#TEAM_LEADER_REMARKS#,
	BASIS_OF_RECOMMENDATION=#BASIS_OF_RECOMMENDATION#,
	TYPE_STATUS_ID=#TYPE_STATUS_ID#,
	SUBTYPE_ID=#SUBTYPE_ID#
	where TREATMENT_ID=#ID#
</update>
<delete id="deleteTreatmentRnrHouseholdExpenditure">
    delete from PTRTREATMENT_RNR_HOUSEHOLD_EXPENDITURE 
	where TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrHouseholdExpenditure">
	insert into PTRTREATMENT_RNR_HOUSEHOLD_EXPENDITURE(TREATMENT_ID,DESCRIPTION,AMOUNT)
	values(#TREATMENT_ID#,#DESCRIPTION#,#AMOUNT#)
</insert>

<delete id="deleteTreatmentRnrFinancialCommitment">
    delete from PTRTREATMENT_RNR_FINANCIAL_COMMITMENT where TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrFinancialCommitment">
	insert into PTRTREATMENT_RNR_FINANCIAL_COMMITMENT(TREATMENT_ID,DESCRIPTION,AMOUNT)
	values(#TREATMENT_ID#,#DESCRIPTION#,#AMOUNT#)
</insert>
<delete id="deleteTreatmentRnrSystemBrakedownWaiver">
    DELETE FROM PTRTREATMENT_RNR_SYSTEM_BRAKEDOWN_WAIVER WHERE TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrSystemBrakedownWaiver">
    INSERT INTO PTRTREATMENT_RNR_SYSTEM_BRAKEDOWN_WAIVER(TREATMENT_ID,BRAKEDOWN_ID,AMOUNT,PROPOSED_PAYMENT_SUM,WAIVER_AMOUNT)
	VALUES(#TREATMENT_ID#,#BREAKDOWN_ID#,#AMOUNT#,#PROPOSED_PAYMENT_SUM#,#WAIVER_AMOUNT#)
</insert>
<delete id="deleteTreatmentRnrJudgementBrakedownWaiver">
    DELETE FROM PTRTREATMENT_RNR_JUDGEMENT_BRAKEDOWN_WAIVER WHERE TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrJudgementBrakedownWaiver">
    INSERT INTO PTRTREATMENT_RNR_JUDGEMENT_BRAKEDOWN_WAIVER(TREATMENT_ID,BRAKEDOWN_ID,AMOUNT,PROPOSED_PAYMENT_SUM,WAIVER_AMOUNT)
	VALUES(#TREATMENT_ID#,#BREAKDOWN_ID#,#AMOUNT#,#PROPOSED_PAYMENT_SUM#,#WAIVER_AMOUNT#)
</insert>
<delete id="deleteTreatmentRnrCollateral">
    DELETE FROM PTRTREATMENT_RNR_COLLATERAL WHERE TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrCollateral">
	insert into PTRTREATMENT_RNR_COLLATERAL(TREATMENT_ID,COLLATERAL_ID,STATUS_ID,SALEABILITY,MARKET_VALUE,REMARKS)
	values(#TREATMENT_ID#,#COLLATERAL_ID#,#STATUS_ID#,#SALEABILITY#,#MARKET_VALUE#,#REMARKS#)
</insert>

<delete id="deleteTreatmentRnrCustomer">
    DELETE FROM PTRTREATMENT_RNR_CUSTOMER WHERE TREATMENT_ID=#ID#
</delete>
<insert id="insertTreatmentRnrCustomer">
	insert into PTRTREATMENT_RNR_CUSTOMER(TREATMENT_ID,CUSTOMER_ID,NATURE_OF_BUSINESS,EMPLOYER_NAME,EMPLOYER_NATURE_OF_BUSINESS)
	values(#TREATMENT_ID#,#CUSTOMER_ID#,#NATURE_OF_BUSINESS#,#EMPLOYER_NAME#,#EMPLOYER_NATURE_OF_BUSINESS#)
</insert>

<delete id="deleteTreatmentRnrRemarks">
    DELETE FROM PTRTREATMENT_RNR_REMARKS WHERE TREATMENT_ID=#ID#
</delete>

<insert id="insertTreatmentRnrRemarks">
	insert into PTRTREATMENT_RNR_REMARKS(TREATMENT_ID,TYPE_CODE,REMARKS)
	values(#ID#,#TYPE_CODE#,#REMARKS#)
</insert>

<delete id="deleteTreatmentRnrCustomerAgeInformation">
    DELETE FROM PTRTREATMENT_RNR_CUSTOMER_AGE_INFORMATION WHERE TREATMENT_ID=#ID#
</delete>

<insert id="insertTreatmentRnrCustomerAgeInformation">
	INSERT INTO PTRTREATMENT_RNR_CUSTOMER_AGE_INFORMATION(TREATMENT_ID,CUSTOMER_ID,AGE,SETTLEMENT_PERIOD,AGENCY_AT_END_OF_SETTLEMENT,
	EPF_ACCOUNT_ONE,EPF_ACCOUNT_TWO,TOTAL_EPF,STATEMENT_DATE)
	VALUES(#TREATMENT_ID#,#CUSTOMER_ID#,#AGE#,#SETTLEMENT_PERIOD#,#AGENCY_AT_END_OF_SETTLEMENT#,#EPF_ACCOUNT_ONE#,#EPF_ACCOUNT_TWO#,#TOTAL_EPF#,#STATEMENT_DATE#
	)
</insert>

<delete id="deleteTreatmentRnrAccountPrerequisite">
    DELETE FROM PTRTREATMENT_RNR_ACCOUNT_PREREQUISITE WHERE TREATMENT_ID = #ID#
</delete>

<insert id="insertTreatmentRnrAccountPrerequisite">
<selectKey keyProperty="ID" resultClass="long" type="pre"><include refid="sequencePrefix"/>PTRTREATMENT_RNR_ACCOUNT_PREREQUISITE_ID<include refid="sequenceSuffix"/></selectKey>
	INSERT INTO PTRTREATMENT_RNR_ACCOUNT_PREREQUISITE (ID,TREATMENT_ID,ACCOUNT_ID,TO_EXCLUDE,TABLE_CODE)
	VALUES(#ID#,#TREATMENT_ID#,#ACCOUNT_ID#,#TO_EXCLUDE#,#TABLE_CODE#)
</insert>

<update id="updateAccountLatestRnrStatus">
	update PTRACCOUNT_LATEST_RNR_STATUS set 
	SUBTYPE_ID = #SUBTYPE_ID#, 
	TYPE_STATUS_ID = #TYPE_STATUS_ID#,
	TREATMENT_ID = #ID#,
	UPDATED_TIME =#UPDATED_TIME#,
	TERMINATION_DATE = null
	where ACCOUNT_ID = #ACCOUNT_ID#
</update>

	<insert id="insertAccountLatestRnrStatus">
		insert into PTRACCOUNT_LATEST_RNR_STATUS
		(ACCOUNT_ID,SUBTYPE_ID,TYPE_STATUS_ID,TREATMENT_ID,UPDATED_TIME,TERMINATION_DATE)
		values
		(#ACCOUNT_ID#,#SUBTYPE_ID#,#TYPE_STATUS_ID#,#ID#,#UPDATED_TIME#,null)
	</insert>

	<delete id="deleteTreatmentRnrSchedule">
		delete from PTRTREATMENT_RNR_SCHEDULE where TREATMENT_ID = #ID#
	</delete>
	<insert id="insertTreatmentRnrSchedule">
		insert into PTRTREATMENT_RNR_SCHEDULE
		(TREATMENT_ID,INSTALLMENT_START_DATE,INSTALLMENT_END_DATE,
		INSTALLMENT_AMOUNT,PRINCIPAL_DUE_AMOUNT,INTEREST_AMOUNT,PRINCIPAL_REMAINING,OPENING_PRINCIPAL)
		values(#TREATMENT_ID#,#INSTALLMENT_START_DATE#,#INSTALLMENT_END_DATE#,
		#INSTALLMENT_AMOUNT#,#PRINCIPAL_DUE_AMOUNT#,#INTEREST_AMOUNT#,#PRINCIPAL_REMAINING#,#OPENING_PRINCIPAL#)
	</insert>

	<delete id="deleteTreatmentRnrVariableSchedule">
		delete from PTRTREATMENT_RNR_VARIABLE_SCHEDULE where TREATMENT_ID =#ID#
	</delete>

	<insert id="insertTreatmentRnrVariableSchedule">
		insert into PTRTREATMENT_RNR_VARIABLE_SCHEDULE
		(TREATMENT_ID,FROM_DATE,TO_DATE,INSTALLMENT_AMOUNT,INTEREST_RATE)
		values(#ID#,#FROM_DATE#,#TO_DATE#,#INSTALLMENT_AMOUNT#,#INTEREST_RATE#)
	</insert>

	<resultMap class="hmap" id="getRnrTreatmentProcessInformation">
		<result property="TREATMENT_ID" javaType="long" />
		<result property="TOTAL_BALANCE_1" javaType="$" />
		<result property="TOTAL_BALANCE_2" javaType="$" />
		<result property="GRAND_TOTAL" javaType="$" />
		<result property="CONNECTED_PARTY_ID" javaType="long" />
		
		<result property="CTOS" javaType="string" />
		<result property="CUSTOMER_REQUEST_DATE" javaType="date" />
		<result property="CUSTOMER_REQUEST_RECEIVED_DATE" javaType="date" />
		<result property="SUBTYPE_ID" javaType="long" />
		<result property="COLLECTION_CENTRE_ID" javaType="long" />
		
		<result property="SHORTFALL" javaType="string" />
		<result property="PARTIAL_WRITTEN_OFF" javaType="string" />
		<result property="PARTIAL_WRITTEN_OFF_DATE" javaType="date" />
		<result property="WORKLIST_TYPE_ID" javaType="long" />
		<result property="CURRENT_NO_OF_TIME_IN_RNR" javaType="long" />
		
		<result property="PREVIOUS_RNR_APPROVED_DATE" javaType="date" />
		<result property="DURATION_FROM_PREVIOUS_RNR" javaType="string" />
		<result property="PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR" javaType="long" />
		<result property="INCOME_EVIDENCE" javaType="boolean" />
		<result property="INCOME_EVIDENCE_REMARKS" javaType="string" />
		
		<result property="RNR_REASON_ID" javaType="long" />
		<result property="OTHER_RNR_REASON_REMARKS" javaType="string" />
		<result property="NET_INCOME" javaType="$" />
		<result property="OTHER_INCOME" javaType="$" />
		<result property="TOTAL_INCOME" javaType="$" />
		
		<result property="TOTAL_HOUSEHOLD_EXPENDITURES" javaType="$" />
		<result property="TOTAL_FINANCIAL_COMMITMENTS" javaType="$" />
		<result property="AMOUNT_TO_PAY_THE_BANK" javaType="$" />
		<result property="DEBT_SERVICE_RATIO" javaType="$" />
		<result property="REASON_OF_DEFAULT" javaType="string" />
		
		<result property="YEAR_OF_FUNDED" javaType="string" />
		<result property="SYSTEM_COMPUTATION_BREAKDOWN_TOTAL" javaType="$" />
		<result property="SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM" javaType="$" />
		<result property="SYSTEM_COMPUTATION_WAIVER_TOTAL" javaType="$" />
		<result property="JUDGEMENT_BREAKDOWN_TOTAL" javaType="$" />
		
		<result property="JUDGEMENT_PAYMENT_SUM_TOTAL" javaType="$" />
		<result property="JUDGEMENT_WAIVER_TOTAL" javaType="$" />
		<result property="SETTLEMENT_AMOUNT" javaType="$" />
		<result property="WITH_FURTHER_INTEREST" javaType="boolean" />
		<result property="UPFRONT_PAYMENT" javaType="$" />
		
		<result property="PDC_REQUIRED" javaType="boolean" />
		<result property="PDC_REMARKS" javaType="string" />
		<result property="REVIEW_DATE" javaType="date" />
		<result property="FIRST_PAYMENT_DUE_DATE" javaType="date" />
		<result property="NEXT_PAYMENT_DUE_DATE" javaType="date" />
		
		<result property="LATE_CHARGES" javaType="$" />
		<result property="APPROVED_DATE" javaType="date" />
		<result property="REJECTED_DATE" javaType="date" />
		<result property="IMPLEMENTED_DATE" javaType="date" />
		<result property="APPROVING_AUTHORITY_ID" javaType="long" />
		
		<result property="REJECTED_REASON" javaType="string" />
		<result property="SLO_ACCEPTANCE_DATE" javaType="date" />
		<result property="FIRST_INSTALLMENT_RECEIVED_DATE" javaType="date" />
		<result property="CANCEL_RNR_DATE" javaType="date" />
		<result property="CANCEL_REASON" javaType="string" />
		
		<result property="PHOTOCOPY_OF_IC" javaType="boolean" />
		<result property="LPI" javaType="$" />
		<result property="TEMPLATE_VERSION_ID" javaType="long" />
		<result property="OS_BALANCE_TYPE_ID" javaType="long" />
		<result property="OUTSTANDING_BALANCE_AMOUNT" javaType="$" />
		
		<result property="UPFRONT_WAIVER_AMOUNT" javaType="$" />
		<result property="INSTALLMENT_DUE_DAY" javaType="long" />
		<result property="WITH_JUDGEMENT" javaType="boolean" />
		<result property="SETTLEMENT_TYPE_ID" javaType="long" />
		<result property="INTEREST_RATE" javaType="$" />
		
		<result property="SETTLEMENT_MODE_ID" javaType="long" />
		<result property="INSTALLMENT_AMOUNT" javaType="$" />
		<result property="TENURE" javaType="long" />
		<result property="MATTERS_FOR_CONSIDERATION" javaType="string" />
		<result property="IS_APPROVED" javaType="boolean" />
		
		<result property="FINALIZED_SETTLEMENT_AMOUNT" javaType="$" />
		<result property="VARIANCE" javaType="double" />
		<result property="VARIANCE_REVISED" javaType="double" />
		<result property="PRIME_RATE" javaType="double" />
		<result property="PRIME_RATE_TYPE" javaType="long" />

		<result property="HQ_MANAGER_REMARKS" javaType="string" />
		<result property="TEAM_MANAGER_REMARKS" javaType="string" />
		<result property="TEAM_LEADER_REMARKS" javaType="string" />
		<result property="BASIS_OF_RECOMMENDATION" javaType="string" />
		<result property="TYPE_STATUS_ID" javaType="long"/>
		
		<result property="OS_BALANCE_TYPE_ID" javaType="long"/>
		<result property="SETTLEMENT_TYPE_ID" javaType="long"/>
	</resultMap>
	<select id="getRnrTreatmentProcessInformation" resultMap="getRnrTreatmentProcessInformation">
		select 
		TREATMENT_ID,TOTAL_BALANCE_1,TOTAL_BALANCE_2,GRAND_TOTAL,CONNECTED_PARTY_ID,
		CTOS,CUSTOMER_REQUEST_DATE,CUSTOMER_REQUEST_RECEIVED_DATE,SUBTYPE_ID,COLLECTION_CENTRE_ID,
		SHORTFALL,PARTIAL_WRITTEN_OFF,PARTIAL_WRITTEN_OFF_DATE,WORKLIST_TYPE_ID,CURRENT_NO_OF_TIME_IN_RNR,
		PREVIOUS_RNR_APPROVED_DATE,DURATION_FROM_PREVIOUS_RNR,PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR,INCOME_EVIDENCE,INCOME_EVIDENCE_REMARKS,
		RNR_REASON_ID,OTHER_RNR_REASON_REMARKS,NET_INCOME,OTHER_INCOME,TOTAL_INCOME,
		TOTAL_HOUSEHOLD_EXPENDITURES,TOTAL_FINANCIAL_COMMITMENTS,AMOUNT_TO_PAY_THE_BANK,DEBT_SERVICE_RATIO,REASON_OF_DEFAULT,
		YEAR_OF_FUNDED,SYSTEM_COMPUTATION_BREAKDOWN_TOTAL,SYSTEM_TOTAL_PROPOSED_PAYMENT_SUM,SYSTEM_COMPUTATION_WAIVER_TOTAL,JUDGEMENT_BREAKDOWN_TOTAL,
		JUDGEMENT_PAYMENT_SUM_TOTAL,JUDGEMENT_WAIVER_TOTAL,SETTLEMENT_AMOUNT,WITH_FURTHER_INTEREST,UPFRONT_PAYMENT,
		PDC_REQUIRED,PDC_REMARKS,REVIEW_DATE,FIRST_PAYMENT_DUE_DATE,NEXT_PAYMENT_DUE_DATE,
		LATE_CHARGES,APPROVED_DATE,REJECTED_DATE,IMPLEMENTED_DATE,APPROVING_AUTHORITY_ID,
		REJECTED_REASON,SLO_ACCEPTANCE_DATE,FIRST_INSTALLMENT_RECEIVED_DATE,CANCEL_RNR_DATE,CANCEL_REASON,
		PHOTOCOPY_OF_IC,LPI,TEMPLATE_VERSION_ID,OS_BALANCE_TYPE_ID,OUTSTANDING_BALANCE_AMOUNT,
		UPFRONT_WAIVER_AMOUNT,INSTALLMENT_DUE_DAY,WITH_JUDGEMENT,SETTLEMENT_TYPE_ID,INTEREST_RATE,
		SETTLEMENT_MODE_ID,INSTALLMENT_AMOUNT,TENURE,MATTERS_FOR_CONSIDERATION,IS_APPROVED,
		FINALIZED_SETTLEMENT_AMOUNT,VARIANCE,VARIANCE_REVISED,PRIME_RATE,PRIME_RATE_TYPE,
		HQ_MANAGER_REMARKS,TEAM_MANAGER_REMARKS,TEAM_LEADER_REMARKS,BASIS_OF_RECOMMENDATION,TYPE_STATUS_ID,
		OS_BALANCE_TYPE_ID,SETTLEMENT_TYPE_ID
		from PTRTREATMENT_RNR where TREATMENT_ID=#ID#
	</select>


	<resultMap class="hmap" id="getTreatmentRnrHouseholdExpenditure">
		<result property="DESCRIPTION" javaType="string" />
		<result property="AMOUNT" javaType="$" />
	</resultMap>

	<select id="getTreatmentRnrHouseholdExpenditure" resultMap="getTreatmentRnrHouseholdExpenditure">
		select DESCRIPTION,AMOUNT from PTRTREATMENT_RNR_HOUSEHOLD_EXPENDITURE
		where TREATMENT_ID=#ID#
	</select>
	<select id="getTreatmentRnrFinancialCommitment" resultMap="getTreatmentRnrHouseholdExpenditure">
		select DESCRIPTION,AMOUNT from PTRTREATMENT_RNR_FINANCIAL_COMMITMENT
		where TREATMENT_ID=#ID#
	</select>

	<resultMap class="hmap" id="treatmentRnrRemarks">
		<result property="REMARKS" javaType="string" />
	</resultMap>

	<select id="getTreatmentRnrOthRemarks" resultMap="treatmentRnrRemarks">
		select REMARKS from PTRTREATMENT_RNR_REMARKS
		where TREATMENT_ID=#ID# and TYPE_CODE='OTH'
	</select>
	<select id="getTreatmentRnrBorRemarks" resultMap="treatmentRnrRemarks">
		select REMARKS from PTRTREATMENT_RNR_REMARKS
		where TREATMENT_ID=#ID# and TYPE_CODE='BOR'
	</select>
	<select id="getTreatmentRnrTlrRemarks" resultMap="treatmentRnrRemarks">
		select REMARKS from PTRTREATMENT_RNR_REMARKS
		where TREATMENT_ID=#ID# and TYPE_CODE='TLR'
	</select>
	<select id="getTreatmentRnrTmrRemarks" resultMap="treatmentRnrRemarks">
		select REMARKS from PTRTREATMENT_RNR_REMARKS
		where TREATMENT_ID=#ID# and TYPE_CODE='TMR'
	</select>
	<select id="getTreatmentRnrHqrRemarks" resultMap="treatmentRnrRemarks">
		select REMARKS from PTRTREATMENT_RNR_REMARKS
		where TREATMENT_ID=#ID# and TYPE_CODE='HQR'
	</select>

	<resultMap class="hmap" id="getTreatmentRnrVariableSchedule">
		<result property="FROM_DATE" javaType="date" />
		<result property="TO_DATE" javaType="date" />
		<result property="INSTALLMENT_AMOUNT" javaType="$" />
		<result property="INTEREST_RATE" javaType="$" />
	</resultMap>

	<select id="getTreatmentRnrVariableSchedule" resultMap="getTreatmentRnrVariableSchedule">
		select FROM_DATE,TO_DATE,INSTALLMENT_AMOUNT,INTEREST_RATE
		from PTRTREATMENT_RNR_VARIABLE_SCHEDULE
		where TREATMENT_ID = #ID#
	</select>

	<insert id="insertrandraccounttreatment" parameterClass="map">
		INSERT INTO PTRRANDR_ACC_TREATMENT_REL (ACCOUNT_ID, TREATMENT_ID) VALUES
		(#ACCOUNT_ID#, #ID#)
	</insert>

<resultMap class="hmap" id="getExistingRandrCurrentNoOfTimes">
<result property="CURRENT_NO_OF_TIME_IN_RNR" javaType="long"/>
<result property="PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR" javaType="long"/>
<result property="PREVIOUS_RNR_APPROVED_DATE" javaType="date"/>
<result property="DURATION_FROM_PREVIOUS_RNR" javaType="string"/>
</resultMap>
<select id="getExistingRandrCurrentNoOfTimes" resultMap="getExistingRandrCurrentNoOfTimes">
SELECT CURRENT_NO_OF_TIME_IN_RNR,PREVIOUS_NO_OF_TIME_REPORTED_AS_RNR,PREVIOUS_RNR_APPROVED_DATE,DURATION_FROM_PREVIOUS_RNR 
FROM PTRTREATMENT_RNR where TREATMENT_ID=#ID#
</select>

<resultMap class="hmap" id="getRandrDurations">
<result property="YEAR_SINCE_RNR" javaType="string"/>
<result property="MONTH_SINCE_RNR" javaType="string"/>
</resultMap>
<select id="getRandrDurations" resultMap="getRandrDurations">
SELECT
lpad(cast(date_part('year',age(cast(#APPROVED_DATE# as date), cast(#PREVIOUS_RNR_APPROVED_DATE# as date))) as text),2,'0'),
lpad(cast(date_part('month',age(cast(#APPROVED_DATE# as date), cast(#PREVIOUS_RNR_APPROVED_DATE# as date))) as text),2,'0')
<include refid="fromdual"/>
</select>

<delete id="deleteTreatmentApprovedRnrSchedule">
	delete from PTRTREATMENT_RNR_APPROVED_SCHEDULE	where TREATMENT_ID = 	#ID#
</delete>
<insert id="insertTreatmentApprovedRnrSchedule">
	insert into PTRTREATMENT_RNR_APPROVED_SCHEDULE (TREATMENT_ID,INSTALLMENT_START_DATE,INSTALLMENT_END_DATE,
	INSTALLMENT_AMOUNT,PRINCIPAL_DUE_AMOUNT,INTEREST_AMOUNT,PRINCIPAL_REMAINING,OPENING_PRINCIPAL)
	values(#TREATMENT_ID#,#INSTALLMENT_START_DATE#,#INSTALLMENT_END_DATE#,
	#INSTALLMENT_AMOUNT#,#PRINCIPAL_DUE_AMOUNT#,#INTEREST_AMOUNT#,#PRINCIPAL_REMAINING#,#OPENING_PRINCIPAL#)	
</insert>


<resultMap class="hmap" id="getTreatmentRnrDebtCrystalization">
		<result property="CF_MIA" javaType="int" />
		<result property="CF_INSTALLMENT_AMOUNT" javaType="$" />
		<result property="CF_LATE_CHARGES" javaType="$" />
		<result property="CF_ACCRUED_INTEREST" javaType="$" />		
		<result property="CF_ACCRUED_LATE_CHARGE" javaType="$" />
		
		<result property="CF_MEMO_LATE_CHARGE" javaType="$" />
		<result property="CF_MISC_CHARGES" javaType="$" />
		<result property="CF_OTHER_CHARGES" javaType="$" />
		<result property="CF_OUTSTANDING_BALANCE" javaType="$" />		
	</resultMap>
	<select id="getTreatmentRnrDebtCrystalization" resultMap="getTreatmentRnrDebtCrystalization">
		select
a.months_in_arrears,
a.PAYMENT_AMOUNT,
0 as LATE_CHARGES,
a.accrued_interest,
0 as ACCRUED_LATE_CHARGES,
a.memo_late_charge,
a.miscellaneous_charge,
a.other_charge,
a.outstanding_balance
FROM ptraccount a
LEFT OUTER JOIN PTRPRODUCT_TYPE_REF t12 ON (t12.ID = a.PRODUCT_TYPE_ID)
LEFT OUTER join PTRPRODUCT_TYPE_CATEGORY_REF ptc on (ptc.ID = t12.CATEGORY_ID)
where a.ID=#ACCOUNT_ID#
	</select>

<insert id="insertRnrDebtCrystalization">
INSERT INTO PTRRNR_DEBTCRYSTALIZATION 
    (TREATMENT_ID,ACCOUNT_ID,CF_MIA,CF_INSTALLMENT_AMOUNT,CF_LATE_CHARGES,CF_ACCRUED_INTEREST,CF_ACCRUED_LATE_CHARGE,CF_MEMO_LATE_CHARGE,CF_MISC_CHARGES,CF_OTHER_CHARGES,CF_OUTSTANDING_BALANCE,STATUS_ID)
VALUES 
    (#ID#,#ACCOUNT_ID#,#CF_MIA#,#CF_INSTALLMENT_AMOUNT#,#CF_LATE_CHARGES#,#CF_ACCRUED_INTEREST#,#CF_ACCRUED_LATE_CHARGE#,#CF_MEMO_LATE_CHARGE#,#CF_MISC_CHARGES#,#CF_OTHER_CHARGES#,#CF_OUTSTANDING_BALANCE#,#STATUS_ID#)
</insert>

<resultMap class="hmap" id="getRnrApprovalTypeStatus">
<result property="IS_APPROVAL_TYPE_STATUS" javaType="boolean"/>
</resultMap>
<select id="getRnrApprovalTypeStatus" resultMap="getRnrApprovalTypeStatus">
select true from ptrtreatment_type_status_ref where type_id=49 and code in ('RNR_AMAN','RNR_AHOD1','RNR_AHOD2') and id=#TYPE_STATUS_ID#
</select>

<resultMap class="hmap" id="getRnrImplementedTypeStatus">
<result property="IS_IMPLEMENTED_TYPE_STATUS" javaType="boolean"/>
</resultMap>
<select id="getRnrImplementedTypeStatus" resultMap="getRnrImplementedTypeStatus">
select true from ptrtreatment_type_status_ref where type_id=49 and code in ('RNR_IMP') and id=#TYPE_STATUS_ID#
</select>

<insert id="insertRnrScheduleTable">	
<selectKey keyProperty="ID" resultClass="long" type="pre"><include refid="sequencePrefix"/>ptrrnr_installment_id<include refid="sequenceSuffix"/></selectKey>
	insert into ptrrnr_installment (ACCOUNT_ID,SCHEDULE_DATE,RATE,TREATMENT_ID,ID,CREATED_TIME)
	values (#ACCOUNT_ID#,#DATE#,#RATE#,#TREATMENT_ID#,#ID#,#CURRENT_DATE#)
</insert>
<resultMap id="getLedgerStartingBalancesForNppLedger" class="java.util.HashMap">
 <result property="PRINCIPAL_AMOUNT" javaType="$"/>
 <result property="PRINCIPAL_OVERDUE_AMOUNT" javaType="$"/>
 <result property="INTEREST_AMOUNT" javaType="$"/>
 <result property="CHARGE_AMOUNT" javaType="$"/>
 <result property="PENALTY_AMOUNT" javaType="$"/>
 <result property="INTEREST_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="CHARGE_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="PENALTY_IN_SUSPENSE_AMOUNT" javaType="$"/>
 <result property="CURRENCY" javaType="string"/>
 <result property="POST_ACTION" javaType="string"/>
 <result property="CHARGE_ACCOUNT_CODE" javaType="string"/>
</resultMap>
<select id="getLedgerStartingBalancesForNppLedger" resultMap="getLedgerStartingBalancesForNppLedger" parameterClass="map">
select cast(#FINALIZED_SETTLEMENT_AMOUNT# as DECIMAL(19,5)), 0, 0, 0, 0, 0, 0, 0, 'MYR', 'P', '300' <include refid="fromdual"/>
</select>

<update id="updateAccountRnrInformation">
	UPDATE PTRACCOUNT_RNR_INFORMATION SET
	CURRENT_NO_OF_TIME_IN_RNR = CURRENT_NO_OF_TIME_IN_RNR + 1,
	PREVIOUS_RNR_APPROVED_DATE = #RNR_APPROVED_DATE#,
	FINALIZED_SETTLEMENT_AMOUNT = #FINALIZED_SETTLEMENT_AMOUNT#
	WHERE ACCOUNT_ID = #ACCOUNT_ID#
</update>

<insert id="insertAccountRnrInformation">
	INSERT INTO PTRACCOUNT_RNR_INFORMATION(ACCOUNT_ID,CURRENT_NO_OF_TIME_IN_RNR,FINALIZED_SETTLEMENT_AMOUNT,PREVIOUS_RNR_APPROVED_DATE)
	VALUES(#ACCOUNT_ID#,1,#FINALIZED_SETTLEMENT_AMOUNT#,#RNR_APPROVED_DATE#)
</insert>






</sqlMap>
	