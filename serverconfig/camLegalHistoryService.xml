<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="camLegalHistoryService">

<resultMap class="hmap" id="getCamLegalHistory">
<result property="LEGAL_TYPE" javaType="string"/>
<result property="ACCOUNT_NUMBER" javaType="string"/>
<result property="OS_BAL" javaType="$"/>
<result property="DATE" javaType="date"/>
<result property="ASSIGN_DATE" javaType="date"/>
<result property="ABORT_DATE" javaType="date"/>
<result property="ABORT_REASON" javaType="string"/>
<result property="STATUS" javaType="string"/>
<result property="CASE_REG_NO" javaType="string"/>
<result property="FIRM_CODE" javaType="string"/>
<result property="AGENCY_NAME" javaType="string"/>
<result property="AGENCY_ASSIGNMENT_ID" javaType="long"/>
<result property="CLOSURE_TYPE" javaType="string"/>
<result property="TREATPROC_TYPE_ID" javaType="long"/>
<result property="USER_ID" javaType="string"/>
<result property="ABORTED_BY" javaType="string"/>
</resultMap>
	
	<select id="getCamLegalHistory" resultMap="getCamLegalHistory">
	select
ty.description as LEGAL_TYPE,
a.account_no as ACCOUNT_NUMBER,
a.outstanding_balance as OS_BAL,
ass.created_time as DATE,
ass.approved_date as ASSIGN_DATE,
ass.aborted_date as ABORT_DATE,
leg.description as ABORT_REASON,
st.description as STATUS,
NULL as CASE_REG_NO,
ag.code as FIRM_CODE,
ag.description as AGENCY_NAME,
ass.ID as AGENCY_ASSIGNMENT_ID,
sb.description as CLOSURE_TYPE,
ty.id as TREATPROC_TYPE_ID,
ass.created_by as USER_ID,
ass.aborted_by as ABORTED_BY
from ptraccount a
inner join ptraccount_agency_assignment ass on ass.account_id=a.id
inner join ptrtreatment_subtype_ref sb on sb.id=ass.subtype_id
inner join ptrtreatment_type_ref ty on ty.id=sb.type_id
inner join ptrtreatment_status_ref st on st.id=ass.status_id
left join ptragency ag on ag.id=ass.agency_id
left join ptrlegal_abort_reason_ref leg on leg.id=ass.abort_reason_id
where a.ID=#ACCOUNT_ID#
order by ass.created_time desc
	</select>
	
	<resultMap class="hmap" id="getCamLegalHistoryAction">
	<result property="PROCESS_ID" javaType="long"/>
<result property="ACTION_TYPE" javaType="string"/>
<result property="INSTRUCTION" javaType="string"/>
<result property="ACTION_ID" javaType="long"/>
<result property="ACTION" javaType="string"/>
<result property="STATUS" javaType="string"/>
<result property="REMARK" javaType="string"/>
<result property="LAWYER_REF_NO" javaType="string"/>
<result property="CREATED_BY" javaType="string"/>
<result property="CREATED_FROM" javaType="string"/>
<result property="UPDATED_BY" javaType="string"/>
<result property="UPDATED_TIME" javaType="ts"/>
<result property="DISBURSEMENT_AMOUNT" javaType="$"/>
<result property="LAWYER_REFERENCE_NO" javaType="string"/>
</resultMap>
	
	<select id="getCamLegalHistoryAction" resultMap="getCamLegalHistoryAction">
	select
	la.ID as PROCESS_ID,
ty.description as ACTION_TYPE,
ins.description as INSTRUCTION,
la.action_id as ACTION_ID,
lar.description as ACTION,
st.description as STATUS,
rem.remarks as REMARK,
NULL as LAWYER_REF_NO,
la.created_by as CREATED_BY,
NULL as CREATED_FROM,
la.updated_by as UPDATED_BY,
la.updated_time as UPDATED_TIME,
la.disbursement_amount,
la.LAWYER_REFERENCE_NO
from ptraccount_agency_assignment ass
inner join ptrlegal_action_process la on la.agency_assignment_id=ass.id
inner join ptrlegal_action_ref lar on lar.id=la.action_id
inner join ptrtreatment_subtype_ref sb on sb.id=lar.subtype_id
inner join ptrtreatment_type_ref ty on ty.id=sb.type_id
inner join ptrtreatment_status_ref st on st.id=la.status_id
left join ptrlegal_action_ref ins on ins.id=lar.instruction_id
left join ptrlegal_action_remarks rem on rem.process_id=la.id
where ass.ID=#AGENCY_ASSIGNMENT_ID#
order by la.id desc
	</select>
	
		<resultMap class="hmap" id="getCamLegalHistoryRemarks">
<result property="REMARKS" javaType="string"/>
<result property="UPDATE_TIME" javaType="ts"/>
</resultMap>
	
	<select id="getCamLegalHistoryRemarks" resultMap="getCamLegalHistoryRemarks">
	select
rem.remarks as REMARK,
rem.update_time as UPDATE_TIME
from ptraccount_agency_assignment ass
inner join ptrlegal_action_process la on la.agency_assignment_id=ass.id
inner join ptrlegal_action_remarks rem on rem.process_id=la.id
where ass.ID=#AGENCY_ASSIGNMENT_ID#
order by rem.update_time desc
	</select>
	
	
	
	
<resultMap class="hmap" id="getCamLegalHistoryAdditionalDetails">
<result property="PROCESS_ID" javaType="long"/>
<result property="DESCRIPTION" javaType="string"/>
<result property="TYPE_CODE" javaType="string"/>
<result property="CHECKBOX" javaType="boolean"/>
<result property="TEXT" javaType="string"/>
<result property="NUMBER" javaType="long"/>
<result property="AMOUNT" javaType="$"/>
<result property="PERCENTAGE" javaType="$"/>
<result property="CALENDAR" javaType="date"/>
<result property="100" javaType="long"/>
</resultMap>
	
	<select id="getCamLegalHistoryAdditionalDetails" resultMap="getCamLegalHistoryAdditionalDetails">
select 
a.process_id, 
ad.description, 
ady.code,
a.checkbox,
a.text,
a.number,
a.amount,
a.percentage,
a.calendar,
100
from ptrlegal_additional_detail_ref ad
inner join ptrlegal_action_detail_rel d on d.additional_detail_id=ad.id
inner join ptradditional_detail_type_ref ady on ady.id=ad.type_id
left join ptrlegal_action_process_additional_details a on a.detail_id=ad.id and a.process_id=#PROCESS_ID#
where d.action_id=#ACTION_ID#
order by a.id 
	</select>
</sqlMap>