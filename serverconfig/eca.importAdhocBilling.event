<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event transactional="false" type="event">
 <exec count="1" type="createlist"/>
 <exec type="guard">
  <conditions>
   <condition lhsfield="SPREADSHEET_LIST" operator="is not empty" rhsvalue=""/>
  </conditions>
  <exec message="ff3333" target="RED" type="formattext"/>
  <exec from="100" key="100" to="SPREADSHEET_LIST" type="copyintolist"/>
  <exec from="FALSE" key="VALID" to="SPREADSHEET_LIST" type="copyintolist"/>
  <exec from="RED" key="COLOR" to="SPREADSHEET_LIST" type="copyintolist"/>
  <exec size="999" source="SPREADSHEET_LIST" target="DIVIDED_SPREADSHEET_LIST" type="dividelist"/>
  <exec argument="DIVIDED_SPREADSHEET_LIST" type="loop">
   <exec from="SPREADSHEET_LIST" key="CUSTOMER_PRIMARY_ID" to="CUSTOMERS" type="extract"/>
   <exec from="SPREADSHEET_LIST" key="ACCOUNT_NO" to="ACCOUNTS" type="extract"/>
   <exec type="parallelquery">
    <query value="getValidCustomers"/>
    <query value="getValidEcaAgencyAssignment"/>
    <target value="VALID_CUSTOMER_LIST"/>
    <target value="VALID_ECA_ASSIGNMENTS"/>
   </exec>
   <exec from="VALID_CUSTOMER_LIST" key="ACCOUNT_ID" to="ACCOUNTS" type="extract"/>
   <exec argument="ACCOUNT_TAGGINGS" query="getEcaBillingTransactionAccountTagging" type="query"/>
   <exec from="ACCOUNT_TAGGINGS" key="ACCOUNT_ID" target="ACCOUNT_TAGGINGS" to="VALID_CUSTOMER_LIST" type="groupedmerge"/>
   <exec argument="VALID_CUSTOMER_LIST" type="loop">
    <exec from="ACCOUNT_TAGGINGS" key="ACCOUNT_TAGGING" to="ACCOUNT_TAGGING" type="extract"/>
    <exec message="{0}" target="ACCOUNT_TAGGING" type="formattext">
     <key value="ACCOUNT_TAGGING"/>
    </exec>
   </exec>
   <exec from="VALID_ECA_ASSIGNMENTS" key="ACCOUNT_ID" to="VALID_CUSTOMER_LIST" type="merge"/>
   <exec from="VALID_CUSTOMER_LIST" key="CUSTOMER_PRIMARY_ID" to="SPREADSHEET_LIST" type="merge"/>
  </exec>
  <exec from="DIVIDED_SPREADSHEET_LIST" key="SPREADSHEET_LIST" to="SPREADSHEET_LIST" type="extract"/>
  <exec argument="SPREADSHEET_LIST" type="loop">
   <exec type="guard">
    <conditions>
     <condition lhsfield="RATE" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec lhs="RATE" rhs="100" target="RATE" type="divide"/>
   </exec>
   <exec statement="getEcaAdhocBillingUpload" type="select"/>
  </exec>
  <exec from="SPREADSHEET_LIST" key="RESULT_LIST" type="copyintolist"/>
 </exec>
 <exec type="guard">
  <conditions>
   <condition lhsfield="SPREADSHEET_LIST" operator="is empty" rhsvalue=""/>
  </conditions>
  <exec from="RESULT_LIST" key="RESULT_LIST" type="copyintolist"/>
 </exec>
</event>
