<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="emailService">

<resultMap class="hmap" id="getTreatmentEmailAddresses">
<result property="CONTACT_ID" javaType="long"/>
<result property="TO_LIST" javaType="string"/>
</resultMap>

<select id="getTreatmentEmailAddresses" resultMap="getTreatmentEmailAddresses">
select c.ID, c.NO
from PTRCONTACT_NUMBER c
inner join ptrcontact_number_type_ref ct on ct.ID=c.CONTACT_TYPE_ID
where c.CUSTOMER_ID=#CUSTOMER_ID# and ct.CODE='EMAIL'
</select>


<select id="getCategoryOfContact" resultMap="global.ref">
<include refid="refselect"/> FROM ptrcategory_contact_ref WHERE disable = false
</select>

<insert id="insertTreatmentEmail" parameterClass="map">
insert into PTRTREATMENT_EMAIL(TREATMENT_ID,ACCOUNT_ID,TYPE_STATUS_ID,SUBTYPE_ID,CONTACT_ID,
SEND_TO_ID,TEMPLATE_VERSION_ID,CATEGORY_CONTACT_ID)
values
(#ID#,#ACCOUNT_ID#,#TYPE_STATUS_ID#,#SUBTYPE_ID#,#CONTACT_ID#,
#SEND_TO_ID#,#TEMPLATE_VERSION_ID#,#CATEGORY_CONTACT_ID#)
</insert>

<update id="updateTreatmentEmail" parameterClass="map">
update PTRTREATMENT_EMAIL set 
TYPE_STATUS_ID=#TYPE_STATUS_ID#,
SUBTYPE_ID=#SUBTYPE_ID#,
CONTACT_ID=#CONTACT_ID#,
SEND_TO_ID=#SEND_TO_ID#,
TEMPLATE_VERSION_ID=#TEMPLATE_VERSION_ID#,
CATEGORY_CONTACT_ID=#CATEGORY_CONTACT_ID#
where TREATMENT_ID=#ID#
</update>

<resultMap class="hmap" id="getTreatmentEmail">
<result property="TYPE_STATUS_ID" javaType="long"/>
<result property="SUBTYPE_ID" javaType="long"/>
<result property="CONTACT_ID" javaType="long"/>
<result property="SEND_TO_ID" javaType="long"/>
<result property="TEMPLATE_VERSION_ID" javaType="long"/>
<result property="CATEGORY_CONTACT_ID" javaType="long"/>
</resultMap>

<select id="getTreatmentEmail" resultMap="getTreatmentEmail">
select TYPE_STATUS_ID, SUBTYPE_ID, CONTACT_ID,
SEND_TO_ID, TEMPLATE_VERSION_ID,CATEGORY_CONTACT_ID 
from PTRTREATMENT_EMAIL where TREATMENT_ID=#ID#
</select>
	
</sqlMap>