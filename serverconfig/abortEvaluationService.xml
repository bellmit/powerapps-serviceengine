<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="abortEvaluationService">

	<select id="getLegalAbortEvaluationTree" resultMap="global.ref">
		<include refid="refselect" /> 
		FROM PTRLEGAL_ABORT_TREE
		WHERE SUBTYPE_ID =#SUBTYPE_ID# AND DISABLE = <include refid="false"/>
	</select>
	
	<resultMap id="getAbortEvaluationTreeDocumentId" class="hmap">
		<result property="DOCUMENT_ID" javaType="long" />
	</resultMap>
	<select id="getAbortEvaluationTreeDocumentId" resultMap="getAbortEvaluationTreeDocumentId">
		SELECT DOCUMENT_ID FROM PTRLEGAL_ABORT_TREE WHERE ID=#ID#	
	</select>
	
	<resultMap id="getAbortTreeForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="SUBTYPE_ID" javaType="long" />
		<result property="IS_BATCH" javaType="boolean" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getAbortTreeForEditing" resultMap="getAbortTreeForEditing">
		SELECT CODE,DESCRIPTION,SUBTYPE_ID,IS_BATCH,DISABLE
		FROM PTRLEGAL_ABORT_TREE
		WHERE ID = #ID#	
	</select>	

	<update id="updateAbortEvaluationTree">
		UPDATE PTRLEGAL_ABORT_TREE SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		SUBTYPE_ID =#SUBTYPE_ID#,
		IS_BATCH = #IS_BATCH#,
		IS_IMPORT = #IS_IMPORT#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#ID#	
	</update>

	<insert id="insertAbortEvaluationTree">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_ABORT_TREE_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_ABORT_TREE(ID,CODE,DESCRIPTION,IS_BATCH,IS_IMPORT,SUBTYPE_ID,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#IS_BATCH#,#IS_IMPORT#,#SUBTYPE_ID#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>	
	
	<update id="updateAbortEvaluationTreeContent">
		UPDATE PTRLEGAL_ABORT_TREE SET DOCUMENT_ID = #DOCUMENT_ID#, 
		REMARKS = #REMARKS#, UPDATED_BY = #LOGON_USER#, UPDATED_TIME =#CURRENT_TIME#
		WHERE ID =#ID#
	</update>
	<select id="getAbortEvaluationTreeBuckets" resultMap="global.ref">
		<include refid="refselect" /> 
		FROM PTRLEGAL_ABORT_REASON_REF WHERE SUBTYPE_ID=#SUBTYPE_ID# 
	</select>	
</sqlMap>