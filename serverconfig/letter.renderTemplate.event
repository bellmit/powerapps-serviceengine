<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event transactional="true" type="event">
   <exec type="guard">
      <conditions>
         <condition lhsfield="TREATMENT_PROCESS_ID" operator="exists" rhsvalue=""/>
      </conditions>
      <exec statement="getTemplateVersionDocumentId" type="select"/>
      <exec type="guard">
         <conditions>
            <condition lhsfield="Not Ready" operator="=" rhsvalue="Not Ready"/>
         </conditions>
         <exec statement="getTemplateDataId" type="select"/>
         <exec recordcount="" statement="updateLetterTemplateDataAddress" type="update"/>
      </exec>
      <exec directToDatabase="false" directorydatepattern="yyyy-MM-dd" exportformat="XML"
            filenamedatepattern="HH-mm-ss-"
            filenameprefix=""
            from="DOCUMENT_ID"
            to="LETTER_CONTENT"
            type="generatetemplate"
            version="5.5.0"/>
   </exec>
   <exec type="guard">
      <conditions>
         <condition lhsfield="TREATMENT_PROCESS_ID" operator="not present" rhsvalue=""/>
      </conditions>
      <exec to="CREATED_USER" type="user"/>
      <exec ceiling="false" endmonth="false" nextweekday="false" startmonth="false"
            truncate="true"
            type="date"/>
      <exec ceiling="false" endmonth="false" nextweekday="false" startmonth="true"
            to="FIRST_OF_MONTH"
            truncate="true"
            type="date"/>
      <exec statement="getTrue" type="select"/>
      <exec from="TRUE" to="IS_USING_TEMP_DATA" type="copy"/>
      <exec type="guard">
         <conditions>
            <condition lhsfield="Not Ready" operator="=" rhsvalue="Not Ready"/>
         </conditions>
         <exec statement="insertLetterTemplateData" type="insert"/>
         <exec statement="insertLetterCardTemplateData" type="insert"/>
      </exec>
   </exec>
   <exec type="guard">
      <conditions>
         <condition lhsfield="TEMPLATE_VERSION_ID" operator="exists" rhsvalue=""/>
      </conditions>
      <exec statement="getGenericCustomerLetterData" type="select"/>
      <exec statement="getTemplateVersionDocumentId" type="select"/>
      <exec directToDatabase="false" directorydatepattern="yyyy-MM-dd" exportformat="XML"
            filenamedatepattern="HH-mm-ss-"
            filenameprefix=""
            from="DOCUMENT_ID"
            to="LETTER_CONTENT"
            type="generatetemplate"
            version="5.5.0"/>
   </exec>
   <exec count="1" type="createlist"/>
   <exec from="LETTER_CONTENT" key="LETTER_CONTENT" type="copyintolist"/>
   <exec type="loop">
      <exec statement="getTrue" type="select"/>
      <exec from="TRUE" to="TEMPLATE_LOADED" type="copy"/>
   </exec>
   <exec type="guard">
      <conditions>
         <condition lhsfield="IS_USING_TEMP_DATA" operator="=" rhsvalue="true"/>
      </conditions>
      <exec type="guard">
         <conditions>
            <condition lhsfield="Not Ready" operator="=" rhsvalue="Not Ready"/>
         </conditions>
         <exec statement="deleteLetterTemplateData" type="delete"/>
         <exec statement="deleteLetterCardTemplateData" type="delete"/>
      </exec>
   </exec>
</event>