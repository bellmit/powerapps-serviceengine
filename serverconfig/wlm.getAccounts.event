<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event transactional="false" type="event">
 <exec event="wlm.getUserType" ignoreresult="true" type="raise"/>
 <exec from="SELECTED_WORK_LIST_ID" to="WORK_LIST_ID" type="copy"/>
 <exec ceiling="false" endmonth="false" nextweekday="false" startmonth="false" truncate="true" type="date"/>
 <exec ceiling="false" endmonth="false" nextweekday="false" startmonth="true" to="FIRST_OF_MONTH" truncate="true" type="date"/>
 <exec type="guard">
  <conditions>
   <condition lhsfield="TYPE_CODE" operator="=" rhsvalue="bankuser"/>
  </conditions>
  <exec type="guard">
   <conditions>
    <condition lhsfield="WORK_LIST_ID" operator="exists" rhsvalue=""/>
    <condition lhsfield="WORK_LIST_ID" operator="is not empty" rhsvalue=""/>
   </conditions>
   <exec type="guard">
    <conditions>
     <condition lhsfield="IS_PREVIOUS_MONTH" operator="=" rhsvalue="false"/>
    </conditions>
    <exec argument="ACCOUNT_LIST" query="getWlmAccounts" type="query"/>
    <exec event="wlm.getDetails" ignoreresult="true" type="raise"/>
   </exec>
   <exec type="guard">
    <conditions>
     <condition lhsfield="IS_PREVIOUS_MONTH" operator="=" rhsvalue="true"/>
    </conditions>
    <exec event="wlm.getPreviousMonthDetails" ignoreresult="true" type="raise"/>
   </exec>
   <exec argument="ACCOUNT_LIST" type="loop"/>
   <exec from="ACCOUNT_LIST" type="copy"/>
  </exec>
 </exec>
 <exec type="guard">
  <conditions>
   <condition lhsfield="TYPE_CODE" operator="=" rhsvalue="agencyuser"/>
  </conditions>
  <exec argument="ACCOUNT_LIST" query="getWlmAgencyAccounts" type="query"/>
  <exec argument="MONTHLY_PAYMENT_LIST" query="getMonthlyTotalPaymentForAgency" type="query"/>
  <exec from="MONTHLY_PAYMENT_LIST" key="ACCOUNT_ID" to="ACCOUNT_LIST" type="merge"/>
  <exec from="ACCOUNT_LIST" type="copy"/>
 </exec>
</event>
