<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="workListTabAgencyAssignedService">

<select id="getWltAgencyAssignedSubtypes" resultMap="global.ref">
	<include refid="pleaseSelectRef"/> 
	union
	<include refid="refselect"/> from ptrtreatment_subtype_ref where type_id=45
	</select>
	
	<resultMap class="hmap" id="getWltAgencyAssignedAgencyAssignmentIds">
	<result property="AGENCY_ASSIGNMENT_ID" javaType="long"/>
	</resultMap>
	
	<select id="getWltAgencyAssignedAgencyAssignmentIds" resultMap="getWltAgencyAssignedAgencyAssignmentIds">
	select ass.ID from PTRACCOUNT_AGENCY_ASSIGNMENT ass
	inner join PTRTREATMENT_INSTRUCT_ECA eca on eca.AGENCY_ASSIGNMENT_ID=ass.ID
	inner join PTRTREATMENT t on t.ID=eca.TREATMENT_ID
	where t.CREATED_USER_ID=#USER_ID# and ass.STATUS_ID=15007 and ass.MONITORING_STATUS_ID is not null
	<isNotNull property="SUBTYPE_ID">
	and ass.MONITORING_STATUS_ID=#SUBTYPE_ID#
	</isNotNull>
	order by t.CREATED_TIME desc
	</select>
	
	<resultMap class="hmap" id="getWltAgencyAssignedResults">
	<result property="AGENCY_ASSIGNMENT_ID" javaType="long"/>
	<result property="ACCOUNT_ID" javaType="long"/>
	<result property="CUSTOMER_ID" javaType="long"/>
	<result property="ACCOUNT_NUMBER" javaType="string"/>
	<result property="CUSTOMER_NAME" javaType="string"/>
	
	<result property="CREATED_DATE" javaType="date"/>
	<result property="CREATED_USER" javaType="string"/>
	<result property="SUBTYPE" javaType="string"/>
	<result property="AGENCY_NAME" javaType="string"/>
	<result property="REMARKS" javaType="string"/>
	
	<result property="IDENTIFICATION_NO" javaType="string"/>
	<result property="AGENCY_NAME" javaType="string"/>
	</resultMap>
	
	<select id="getWltAgencyAssignedResults" resultMap="getWltAgencyAssignedResults">
select 
ass.id,
a.id,
a.customer_id,
a.account_no,
c.customer_name,

t.created_time,
t.created_user_id,
sb.description,
ag.description,
note.note_text,

c.customer_no,
ag.description
from PTRACCOUNT_AGENCY_ASSIGNMENT ass
inner join PTRTREATMENT_INSTRUCT_ECA eca on eca.AGENCY_ASSIGNMENT_ID=ass.ID
inner join PTRTREATMENT t on t.ID=eca.TREATMENT_ID
inner join ptraccount a on a.id=ass.ACCOUNT_ID
inner join ptrcustomer c on c.id=a.customer_id
inner join ptrtreatment_subtype_ref sb on sb.id=t.subtype_id
inner join ptragency ag on ag.id=ass.agency_id
inner join ptrtreatment_note note on note.treatment_id=t.id
<iterate open="(" close=")" prepend="where ass.id in" conjunction="," property="AGENCY_ASSIGNMENT_IDS">#AGENCY_ASSIGNMENT_IDS[]#</iterate>
	</select>



</sqlMap>