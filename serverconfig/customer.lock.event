<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event transactional="false" type="event">
 <exec argument="CUSTOMER_LOCK" property="CustomerLock" type="serverproperty"/>
 <exec statement="getCustomerIdForLock" type="select"/>
 <exec statement="getCustomerLock" type="select"/>
 <exec throttlename="CUSTOMER_LOCK" type="throttle">
  <exec type="guard">
   <conditions>
    <condition lhsfield="CURRENT_LOCK_USER_ID" operator="exists" rhsvalue=""/>
   </conditions>
   <exec message="{0} - {1}" target="CURRENT_LOCK_USER_ID" type="formattext">
    <key value="CURRENT_LOCK_USER_FIRST_NAME"/>
    <key value="CURRENT_LOCK_USER_ID"/>
   </exec>
   <exec code="CUSTOMER_LOCKED" type="error">
    <key value="CURRENT_LOCK_USER_ID"/>
    <key value="CURRENT_LOCK_SINCE_TIME"/>
    <key value="CURRENT_LOCK_EXPIRATION_TIME"/>
   </exec>
  </exec>
  <exec type="guard">
   <conditions>
    <condition lhsfield="CURRENT_LOCK_USER_ID" operator="not present" rhsvalue=""/>
   </conditions>
   <exec type="transaction">
    <exec statement="removeCustomerLock" type="delete"/>
   </exec>
   <exec type="transaction">
    <exec recordcount="UPDATE_COUNT" statement="updateCustomerLock" type="update"/>
    <exec type="guard">
     <conditions>
      <condition lhsfield="UPDATE_COUNT" operator="=" rhsvalue="0"/>
     </conditions>
     <exec statement="insertCustomerLock" type="insert"/>
    </exec>
   </exec>
  </exec>
 </exec>
</event>
