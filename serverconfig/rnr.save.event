<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event transactional="false" type="event">
 <exec text="base save process" type="comment">
  <exec type="guard">
   <conditions>
    <condition lhsfield="IS_NEW_TREATMENT" operator="=" rhsvalue="true"/>
   </conditions>
   <exec statement="insertTreatmentRnr" type="insert"/>
   <exec statement="insertrandraccounttreatment" type="insert"/>
  </exec>
  <exec type="guard">
   <conditions>
    <condition lhsfield="IS_NEW_TREATMENT" operator="&lt;&gt;" rhsvalue="true"/>
   </conditions>
   <exec recordcount="" statement="updateTreatmentRnr" type="update"/>
  </exec>
  <exec type="guard">
   <conditions>
    <condition lhsfield="STATUS_ID" operator="=" rhsvalue="15004"/>
   </conditions>
   <exec from="APPROVED_DATE" to="RNR_APPROVED_DATE" type="copy"/>
   <exec recordcount="IMPLEMENTED_UPDATE_COUNT" statement="updateAccountRnrInformation" type="update"/>
   <exec type="guard">
    <conditions>
     <condition lhsfield="IMPLEMENTED_UPDATE_COUNT" operator="=" rhsvalue="0"/>
    </conditions>
    <exec statement="insertAccountRnrInformation" type="insert"/>
   </exec>
  </exec>
  <exec type="guard">
   <conditions>
    <condition lhsfield="STATUS_ID" operator="&lt;&gt;" rhsvalue="15007"/>
   </conditions>
   <exec type="guard">
    <conditions>
     <condition lhsfield="UPDATED_TIME" operator="is empty" rhsvalue=""/>
    </conditions>
    <exec ceiling="false" endmonth="false" nextweekday="false" startmonth="false" to="UPDATED_TIME" truncate="true" type="date"/>
   </exec>
   <exec recordcount="UPDATE_LATEST_RNR_COUNT" statement="updateAccountLatestRnrStatus" type="update"/>
   <exec type="guard">
    <conditions>
     <condition lhsfield="UPDATE_LATEST_RNR_COUNT" operator="=" rhsvalue="0"/>
    </conditions>
    <exec statement="insertAccountLatestRnrStatus" type="insert"/>
   </exec>
  </exec>
 </exec>
 <exec text="saving process for list related items" type="comment">
  <exec type="guard">
   <conditions>
    <condition lhsfield="FINANCIAL_COMMITMENTS" operator="is not empty" rhsvalue=""/>
   </conditions>
   <exec from="ID" key="TREATMENT_ID" to="FINANCIAL_COMMITMENTS" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrFinancialCommitment" type="delete"/>
   <exec argument="FINANCIAL_COMMITMENTS" type="loop">
    <exec statement="insertTreatmentRnrFinancialCommitment" type="insert"/>
   </exec>
  </exec>
  <exec type="guard">
   <conditions>
    <condition lhsfield="HOUSEHOLD_EXPENDITURES" operator="is not empty" rhsvalue=""/>
   </conditions>
   <exec from="ID" key="TREATMENT_ID" to="HOUSEHOLD_EXPENDITURES" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrHouseholdExpenditure" type="delete"/>
   <exec argument="HOUSEHOLD_EXPENDITURES" type="loop">
    <exec statement="insertTreatmentRnrHouseholdExpenditure" type="insert"/>
   </exec>
  </exec>
  <exec text="waivers" type="comment">
   <exec from="ID" key="TREATMENT_ID" to="SYSTEM_WAIVER" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrSystemBrakedownWaiver" type="delete"/>
   <exec argument="SYSTEM_WAIVER" type="loop">
    <exec statement="insertTreatmentRnrSystemBrakedownWaiver" type="insert"/>
   </exec>
   <exec from="ID" key="TREATMENT_ID" to="JUDGEMENT_WAIVER" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrJudgementBrakedownWaiver" type="delete"/>
   <exec argument="JUDGEMENT_WAIVER" type="loop">
    <exec statement="insertTreatmentRnrJudgementBrakedownWaiver" type="insert"/>
   </exec>
  </exec>
  <exec text="collateral" type="comment">
   <exec from="ID" key="TREATMENT_ID" to="COLLATERAL_BACKGROUND_INFORMATION" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrCollateral" type="delete"/>
   <exec argument="COLLATERAL_BACKGROUND_INFORMATION" type="loop">
    <exec statement="insertTreatmentRnrCollateral" type="insert"/>
   </exec>
  </exec>
  <exec text="customer" type="comment">
   <exec from="ID" key="TREATMENT_ID" to="CUSTOMER_BACKGROUND_INFORMATION" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrCustomer" type="delete"/>
   <exec argument="CUSTOMER_BACKGROUND_INFORMATION" type="loop">
    <exec statement="insertTreatmentRnrCustomer" type="insert"/>
   </exec>
  </exec>
  <exec text="customer age" type="comment">
   <exec from="ID" key="TREATMENT_ID" to="CUSTOMER_DEBT_RATIO_LIST" type="copyintolist"/>
   <exec statement="deleteTreatmentRnrCustomerAgeInformation" type="delete"/>
   <exec argument="CUSTOMER_DEBT_RATIO_LIST" type="loop">
    <exec statement="insertTreatmentRnrCustomerAgeInformation" type="insert"/>
   </exec>
  </exec>
  <exec text="prerequisite : to be moved into a separate treatment" type="comment">
   <exec type="guard">
    <conditions>
     <condition lhsfield="PREREQUISITE_TABLE_1" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec message="T1" target="TABLE_CODE" type="formattext"/>
    <exec from="TABLE_CODE" key="TABLE_CODE" to="PREREQUISITE_TABLE_1" type="copyintolist"/>
    <exec from="PREREQUISITE_TABLE_1" to="ACCOUNT_PREREQUISITE" type="append"/>
   </exec>
   <exec type="guard">
    <conditions>
     <condition lhsfield="PREREQUISITE_TABLE_2" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec message="T2" target="TABLE_CODE" type="formattext"/>
    <exec from="TABLE_CODE" key="TABLE_CODE" to="PREREQUISITE_TABLE_2" type="copyintolist"/>
    <exec from="PREREQUISITE_TABLE_2" to="ACCOUNT_PREREQUISITE" type="append"/>
   </exec>
   <exec statement="deleteTreatmentRnrAccountPrerequisite" type="delete"/>
   <exec from="ID" key="TREATMENT_ID" to="ACCOUNT_PREREQUISITE" type="copyintolist"/>
   <exec argument="ACCOUNT_PREREQUISITE" type="loop">
    <exec type="guard">
     <conditions>
      <condition lhsfield="ACCOUNT_ID" operator="is not empty" rhsvalue=""/>
     </conditions>
     <exec statement="insertTreatmentRnrAccountPrerequisite" type="insert"/>
    </exec>
   </exec>
  </exec>
  <exec text="variable input schedule" type="comment">
   <exec type="guard">
    <conditions>
     <condition lhsfield="MG_VARIABLE_SETTLEMENT_LIST" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec from="MG_VARIABLE_SETTLEMENT_LIST" to="VARIABLE_SETTLEMENT_LIST" type="copy"/>
   </exec>
   <exec type="guard">
    <conditions>
     <condition lhsfield="HP_VARIABLE_SETTLEMENT_LIST" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec from="HP_VARIABLE_SETTLEMENT_LIST" to="VARIABLE_SETTLEMENT_LIST" type="copy"/>
   </exec>
   <exec statement="deleteTreatmentRnrVariableSchedule" type="delete"/>
   <exec from="ID" key="TREATMENT_ID" to="VARIABLE_SETTLEMENT_LIST" type="copyintolist"/>
   <exec argument="VARIABLE_SETTLEMENT_LIST" type="loop">
    <exec statement="insertTreatmentRnrVariableSchedule" type="insert"/>
   </exec>
  </exec>
  <exec text="schedule" type="comment">
   <exec type="guard">
    <conditions>
     <condition lhsfield="GENERATED_SCHEDULE" operator="is not empty" rhsvalue=""/>
    </conditions>
    <exec statement="deleteTreatmentRnrSchedule" type="delete"/>
    <exec from="ID" key="TREATMENT_ID" to="GENERATED_SCHEDULE" type="copyintolist"/>
    <exec argument="GENERATED_SCHEDULE" type="loop">
     <exec statement="insertTreatmentRnrSchedule" type="insert"/>
    </exec>
   </exec>
   <exec text="on  approval process" type="comment">
    <exec statement="getRnrApprovalTypeStatus" type="select"/>
    <exec type="guard">
     <conditions>
      <condition lhsfield="GENERATED_SCHEDULE" operator="is not empty" rhsvalue=""/>
      <condition lhsfield="IS_APPROVAL_TYPE_STATUS" operator="=" rhsvalue="true"/>
     </conditions>
     <exec statement="deleteTreatmentApprovedRnrSchedule" type="delete"/>
     <exec from="ID" key="TREATMENT_ID" to="GENERATED_SCHEDULE" type="copyintolist"/>
     <exec argument="GENERATED_SCHEDULE" type="loop">
      <exec statement="insertTreatmentApprovedRnrSchedule" type="insert"/>
     </exec>
    </exec>
   </exec>
  </exec>
 </exec>
 <exec statement="getRnrImplementedTypeStatus" type="select"/>
 <exec text="posting of schedules on implemented" type="comment">
  <exec event="rnr.createNewLedger" ignoreresult="true" type="raise"/>
 </exec>
 <exec type="guard">
  <conditions>
   <condition lhsfield="IS_IMPLEMENTED_TYPE_STATUS" operator="=" rhsvalue="true"/>
  </conditions>
  <exec statement="getTreatmentRnrDebtCrystalization" type="select"/>
  <exec statement="insertRnrDebtCrystalization" type="insert"/>
 </exec>
</event>
