<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="camService">
	<resultMap id="getAccountPtpForCurrentMonth" class="hmap">
		<result property="OVER_TWENTY_FIFTH" javaType="boolean" />
		<result property="PTP_STATUS" javaType="string" />
	</resultMap>
	<select id="getAccountPtpForCurrentMonth" resultMap="getAccountPtpForCurrentMonth">
		SELECT CASE
		WHEN CAST(EXTRACT(DAY FROM cast(#CURRENT_DATE:DATE# as DATE)) AS
		DECIMAL) &gt;=25 THEN TRUE END,
		CASE WHEN COUNT(AC.TREATMENT_ID) > 0
		THEN 'PTP_EXIST' ELSE 'NO_PTP' END AS PTP_STATUS
		FROM PTRACCOUNT A LEFT
		JOIN
		PTRACCOUNT_TREATMENT_CURRENT AC on A.ID=AC.ACCOUNT_ID AND
		AC.TYPE_ID=2 and DATE(AC.CREATED_TIME) &gt;= DATE(DATE_TRUNC('MONTH',
		cast(#CURRENT_DATE:DATE# as DATE)))
		WHERE A.ID=#ACCOUNT_D#
		GROUP BY A.ID
	</select>
	<resultMap id="getAccountTAWexludeSMSForCurrentMonth" class="hmap">
		<result property="ACTION_STATUS" javaType="string" />
	</resultMap>
	<select id="getAccountTAWexludeSMSForCurrentMonth" resultMap="getAccountTAWexludeSMSForCurrentMonth">
		SELECT CASE WHEN COUNT(AC.TREATMENT_ID) &gt; 0 THEN 'ACTION_EXIST'
		ELSE 'NO_ACTION' END AS ACTION_STATUS
		FROM PTRACCOUNT A
		LEFT JOIN
		PTRACCOUNT_TREATMENT_CURRENT AC ON A.ID=AC.ACCOUNT_ID AND TYPE_ID !=13
		and DATE(AC.CREATED_TIME) &gt;= DATE(DATE_TRUNC('MONTH',
		cast(#CURRENT_DATE:DATE# as DATE)))
		WHERE A.ID=#ACCOUNT_ID#
		GROUP BY A.ID
	</select>
	<insert id="insertPermanentMessage">
		insert into
		PTRPERMANENT_MESSAGE(ACCOUNT_ID,MESSAGE,CREATED_TIME,USER_ID)
		values(#ACCOUNT_ID#,#MESSAGE#,#CURRENT_TIME#,#LOGON_USER#)
	</insert>
	<insert id="insertSpecialStatus">
		insert into
		PTRACCOUNT_SPECIAL_STATUS(ACCOUNT_ID,REMARKS,STATUS_ID,SPECIAL_STATUS_ID,CREATED_TIME,CREATED_BY)
		values(#ACCOUNT_ID#,#REMARKS#,#STATUS_ID#,#SPECIAL_STATUS_ID#,#CURRENT_TIME#,#LOGON_USER#)
	</insert>
	<update id="resetSpecialStatusPriority">
		update PTRACCOUNT_SPECIAL_STATUS
		set IS_PRIORITY =
		<include refid="false" /> , EXPIRY_DATE = null
		where account_id=#ACCOUNT_ID#
	</update>
	<update id="updateSpecialStatus">
		update PTRACCOUNT_SPECIAL_STATUS set
		UPDATED_TIME=#CURRENT_TIME#,UPDATED_BY=#LOGON_USER#,EXPIRY_DATE=#EXPIRY_DATE#,
		IS_PRIORITY=#IS_PRIORITY# where ID=#ID#
	</update>
	<update id="removeSpecialStatus">
		update PTRACCOUNT_SPECIAL_STATUS set
		UPDATED_TIME=#CURRENT_TIME#,UPDATED_BY=#LOGON_USER#,
		STATUS_ID=15001
		where ID=#ID#
	</update>
	
	<resultMap id="getAccountSummaryTree" class="hmap">
		<result property="FREEZE_ACCOUNT" javaType="string" />
		<result property="LEGAL_STATUS" javaType="string" />
<result property="LD_DATE" javaType="date" />
<result property="LT_DATE" javaType="date" />
<result property="FILING_SUMMON_DATE" javaType="date" />
<result property="ACCOUNT_CLASSIFICATION" javaType="string" />
<result property="REASON_OF_DEFAULT" javaType="string" />
<result property="HOST_REASON_OF_DEFAULT" javaType="string" />
<result property="FS_DATE" javaType="date" />
<result property="NI_DATE" javaType="date" />
<result property="RO_DATE" javaType="date" />
<result property="PAYMENT_HISTORY" javaType="string" />
<result property="REPOSESSION" javaType="string" />
<result property="FORECLOSURE" javaType="string" />
<result property="CATEGORY" javaType="string" />
<result property="CATEGORY_POINTS" javaType="long" />
<result property="DATE_ACCOUNT_UPDATED" javaType="date"/>
	</resultMap>
	<select id="getAccountSummaryTree" resultMap="getAccountSummaryTree">
		SELECT
        case when asr.code = '6' then 'Yes'
        when asr.code = '7' then 'Yes' else 'No' end,
            sr.description as LEGAL_STATUS,
		NULL as LD_DATE,
		NULL as LT_DATE,
		NULL as FILING_SUMMON_DATE,
		acc.description as ACCOUNT_CLASSIFICATION,
		def.description as REASON_OF_DEFAULT,
		NULL as HOST_REASON_OF_DEFAULT,
		NULL as FS_DATE,
		NULL as NI_DATE,
		NULL as RO_DATE,
		NULL as PAYMENT_HISTORY,
		NULL as REPOSESSION,
		NULL as FORECLOSURE,
		NULL as CATEGORY,
		NULL as CATEGORY_POINTS,
		a.date_account_updated
        FROM ptraccount a
        left join ptraccount_status_ref asr on a.status_id=asr.id
        left join ptrwltab_evaluation eval on eval.account_id=a.id
        left join ptrtreatment_place_a_call pac on pac.treatment_id=eval.call_treatment_process_id
        left join ptrreason_of_call_ref def on def.id=pac.reason_call_id
        left join (select max(acc.treatment_id), acc.account_id, ref.description from ptrtreatment_account_classification acc
                    inner join PTRTREATMENT_ACCOUNT_CLASSIFICATION_TYPE_REF ref on ref.id=acc.account_classification_id
                    where acc.account_id=#ACCOUNT_ID#
                    group by acc.account_id, ref.description) acc on acc.account_id=a.id
         left join ptraccount_last_legal_action l on l.account_id=a.id
        left join ptrlegal_action_process ap on ap.id=l.process_id
        left join ptrtreatment_status_ref sr on sr.id=ap.status_id
        where a.id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPermanentMessage" class="hmap">
		<result property="MESSAGE" javaType="string" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
	</resultMap>
	<select id="getPermanentMessage" resultMap="getPermanentMessage">
		select
		p.MESSAGE,p.CREATED_TIME,p.USER_ID from
		PTRPERMANENT_MESSAGE p
		inner
		join ptraccount a on p.account_id=a.id
		where
		a.customer_id=cast(#CUSTOMER_ID# as bigint)
	</select>

	<resultMap id="getAvailableSpecialStatus" class="hmap">
		<result property="SPECIAL_STATUS_ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
	</resultMap>
	<select id="getAvailableSpecialStatus" resultMap="getAvailableSpecialStatus">
		select
		id,description from PTRSPECIAL_STATUS_REF
		where disable = false and id
		not in(select SPECIAL_STATUS_ID from
		PTRACCOUNT_SPECIAL_STATUS where
		ACCOUNT_ID = #ACCOUNT_ID# and status_id = 15004)
	</select>
	<resultMap id="getAccountSpecialStatus" class="hmap">
		<result property="ID" javaType="long" />
		<result property="SPECIAL_STATUS_ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="PRIORITY" javaType="boolean" />
		<result property="EXPIRY_DATE" javaType="date" />
	</resultMap>
	<select id="getAccountSpecialStatus" resultMap="getAccountSpecialStatus">
		select
		ss.id,s.id,s.description,ss.is_priority,ss.expiry_date from PTRSPECIAL_STATUS_REF s
		inner join PTRACCOUNT_SPECIAL_STATUS ss on s.id=ss.special_status_id
		where ss.ACCOUNT_ID = #ACCOUNT_ID# and ss.status_id = 15004
		order by ss.expiry_date asc 
	</select>
	<select id="getDocumentTypes" resultMap="global.ref">
		<include refid="selectAllRef" />
		union
		<include refid="refselect" />
		from PTRDMS_DOCUMENT_TYPE_REF
	</select>
	
<!-- 	<select id="getDocumentTypesForEditing" resultMap="global.ref">
		<include refid="pleaseSelectRef" />
		union
		<include refid="refselect" />
		from PTRDMS_DOCUMENT_TYPE_REF
	</select> -->
	<select id="getDocumentTypesForEditing" resultMap="global.ref">
		<include refid="pleaseSelectRef" />
		union
		<include refid="refselect" />
		from PTRDMS_DOCUMENT_TYPE_REF
	</select>
	<resultMap id="getAccountProductCategories" class="hmap">
		<result property="PRODUCT_CATEGORY" javaType="string" />
	</resultMap>
	<select id="getAccountProductCategories" resultMap="getAccountProductCategories">
		select r.code
		from ptraccount a
		inner join ptrproduct_type_ref p on p.id=a.product_type_id
		inner join
		ptrproduct_type_category_ref r on r.id=p.category_id
		where
		a.id=#ACCOUNT_ID#
	</select>
	<resultMap id="getCasaDetails" class="hmap">
		<result property="ACCOUNT_NO" javaType="string" />
		<result property="ACCOUNT_STATUS" javaType="string" />
		<result property="AVAILABLE_BALANCE" javaType="$" />
		<result property="CURRENCY_CODE" javaType="string" />
		<result property="LEDGER_BALANCE" javaType="$" />
		<result property="PRODUCT_TYPE" javaType="string" />
		<result property="RELATIONSHIP" javaType="string" />
	</resultMap>
	<select id="getCasaDetails" resultMap="getCasaDetails">
		select
		a.account_no,s.description as ACCOUNT_STATUS,0 as
		AVAILABLE_BALANCE,'MYR' as CURRENCY_CODE,0 as
		LEDGER_BALANCE,p.description as PRODUCT_TYPE,'None' as RELATIONSHIP
		from ptraccount a
		inner join ptrproduct_type_ref p on
		p.id=a.product_type_id
		left join ptraccount_status_ref s on
		s.id=a.status_id
		where a.id = #ACCOUNT_ID#
	</select>
	<resultMap id="getAccountDocuments" class="hmap">
		<result property="ID" javaType="long" />
		<result property="DOCUMENT_ID" javaType="long" />
		<result property="DOCUMENT_NAME" javaType="string" />
		<result property="FILE_NAME" javaType="string" />
		<result property="TYPE" javaType="string" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />		
		<result property="DISABLE" javaType="boolean" />
		<result property="DMS_AGENCY" javaType="string" />
	</resultMap>
	<select id="getAccountDocuments" resultMap="getAccountDocuments">
		select
		u.id,u.document_id,u.document_name,d.description,r.description,u.created_time,u.created_by,u.disable,u.dms_agency
		from PTRACCOUNT_UPLOADED_DOCUMENT u
		inner join ptrdocument d on
		d.id=u.document_id
		inner JOIN PTRDMS_DOCUMENT_TYPE_REF r on
		r.id=u.type_id
		where u.account_id=#ACCOUNT_ID#
		<isNotNull property="TYPE_ID">
			and u.type_id=#TYPE_ID#
		</isNotNull>
	</select>
	<update id="dmsSetDisable">
	update ptraccount_uploaded_document set disable = true where document_id = #DOCUMENT_ID#
	</update>
	
	<resultMap id="getAccountSummary" class="hmap">
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="ACCOUNT_NUMBER" javaType="string" />
		<result property="SALUTATION" javaType="string" />
		<result property="LAST_PAYMENT_DATE" javaType="date" />
		<result property="LAST_PAYMENT_AMOUNT" javaType="$" />
		
		<result property="ACCOUNT_STATUS" javaType="string" />
		<result property="MISC_CHARGES_AMOUNT" javaType="$" />
		<result property="OTHER_CHARGES_AMOUNT" javaType="$" />
		<result property="RELEASE_AMOUNT" javaType="$" />
		<result property="ADVANCE_PAY" javaType="$" />
		
		<result property="PAYOFF_AMOUNT" javaType="$" />
		<result property="FINAL_PAYMENT_AMOUNT" javaType="$" />
		<result property="FINANCING_TYPE" javaType="string" />
		<result property="BRANCH_NAME" javaType="string" />
		<result property="BRANCH_NUMBER" javaType="string" />
		
		<result property="NEXT_PAYMENT_DUE_DATE" javaType="date" />
		<result property="NPF_DATE" javaType="date" />
		<result property="NPF_STATUS" javaType="string" />
		<result property="SPTF_FLAG" javaType="string" />
		<result property="CREDIT_APPLICATION_NUMBER" javaType="string" />
		
		<result property="ACCRUED_PROFIT" javaType="$" />
		<result property="NPF_FLAG" javaType="string" />
		<result property="MONTHLY_INSTALLMENT_AMOUNT" javaType="$" />
		<result property="PRINCIPAL_AMOUNT" javaType="$" />
		<result property="INTEREST_AMOUNT" javaType="$" />
		
		<result property="CUSTOMER_NUMBER" javaType="$" />
		<result property="TAWIDH" javaType="$" />
		<result property="ACCOUNT_STATUS_DATE" javaType="date" />
		<result property="MIA" javaType="long" />
		<result property="NO_OF_INSTALLMENT_IN_ARREARS" javaType="long" />
		
		<result property="SUM_OF_INSTALLMENT_IN_ARREARS" javaType="long" />	
		<result property="TOTAL_OVERDUE_AMOUNT" javaType="$" />		
		<result property="CURRENT_PAYOFF_AMOUNT" javaType="$" />		
		<result property="SHORTFALL_STATUS" javaType="string" />	
		<result property="SELLING_PRICE" javaType="$" />	
		
		<result property="SHORT_PAYMENT" javaType="$" />
		<result property="ORIGINAL_LIMIT" javaType="$"/>	
		<result property="HOLD_MAIL" javaType="string" />	
		<result property="T_INST_PAID" javaType="$" />
		<result property="FREEZE_INDICATOR" javaType="string" />
		
		<result property="FACILITY_TYPE" javaType="string"/>
		<result property="IC_NO" javaType="string"/>
		<result property="PRODUCT_TYPE" javaType="string"/>
		<result property="TAKAFUL" javaType="string"/>
		<result property="CURRENT_BALANCE" javaType="$" />
		
		<result property="PROFIT_RATE" javaType="$"/>
		<result property="SECURITY_DEPOSIT" javaType="$"/>
		<result property="EMPLOYER_NAME" javaType="string" />
		<result property="OCCUPATION" javaType="string" />		
		<result property="ECA_ABORT_DATE" javaType="date" />	
		
		<result property="ECA" javaType="string" />
			
		<result property="OUTSTANDING_BALANCE" javaType="$" />
		<result property="MONTHLY_PAYMENT" javaType="$"/>	
		<result property="PAYMENT_IN_ARREARS" javaType="$" />	
		
		<result property="PERCENTAGE_OF_RELEASED_AMOUNT" javaType="$"/>
		<result property="PRINCIPAL_BALANCE" javaType="$"/>
		<result property="PROFIT_CHARGES" javaType="$"/>
		<result property="DEFICIENCY" javaType="string"/>
		<result property="DUE_DATE" javaType="string" />
		<result property="TIER_TYPE" javaType="string" />	
		<result property="COLLECTION_OFFICER" javaType="string" />
		<result property="COLLECTION_OFFICER_FIRST_NAME" javaType="string" />
		<result property="COLLECTION_OFFICER_MIDDLE_NAME" javaType="string" />
		<result property="COLLECTION_OFFICER_LAST_NAME" javaType="string" />
		<result property="LIASON_NAME" javaType="string" />
		<result property="AGENCY_NAME" javaType="string" />
		<result property="ECA_ABORT_DATE" javaType="date" />
		
	</resultMap>
	
	<select id="getAccountSummary" resultMap="getAccountSummary">
		SELECT
		C.CUSTOMER_NAME,
		A.ACCOUNT_NO AS ACCOUNT_NUMBER,
		SALUTATION.DESCRIPTION AS SALUTATION,
		A.LAST_PAYMENT_DATE,
		A.LAST_PAYMENT_AMOUNT,
		
		STATUS.DESCRIPTION AS ACCOUNT_STATUS,
		A.MISCELLANEOUS_CHARGE as MISC_CHARGES_AMOUNT,
		A.OTHER_CHARGE as OTHER_CHARGES_AMOUNT,
		A.RELEASED_AMOUNT as RELEASE_AMOUNT,
		A.ADVANCE_PAYMENT_AMOUNT,
		
		A.PAYOFF_AMOUNT,
		A.FINAL_PAYMENT_AMOUNT,
		R.DESCRIPTION AS FINANCING_TYPE,
		B.DESCRIPTION AS BRANCH_NAME,
		ltrim(B.CODE , '0') AS BRANCH_NUMBER,
		
		A.NEXT_PAYMENT_DUE_DATE,
		A.NPL_DATE AS NPF_DATE,
		NPL.CODE AS NPF_STATUS,
		SPTF.CODE AS SPTF_FLAG,
		null AS CREDIT_APPLICATION_NO,
		
		coalesce(a.interest_due_amount,0) AS ACCRUED_PROFIT,
		A.NPL_FLAG AS NPF_FLAG,
		A.PAYMENT_AMOUNT,
		A.PRINCIPLE_DUE_AMOUNT,
		a.bank_discount_amount as INTEREST_AMOUNT,
		
		C.CUSTOMER_NO,
		a.tawidh_amount as TAWIDH,
		A.STATUS_DATE,
		A.MONTHS_IN_ARREARS,
		A.INSTALLMENT_PAID_COUNT,
		
		coalesce(a.interest_due_amount,0) INSTALLMENT_AMOUNT_IN_ARREARS,
		coalesce(A.total_amount_due,0),
		a.payoff_amount,
		case when tlast.tlast_value_58 = #tlast.tlast_value_58# then 'Yes' else 'No' end,
		coalesce(isl.sptf_selling_price_amount,0) as SELLING_PRICE,
		
		case when (a.PAYMENT_AMOUNT - a.last_payment_amount) &gt; 0 then (a.PAYMENT_AMOUNT - a.last_payment_amount) else 0 end as short_payment,
		a.ORIGINAL_BALANCE as ORIGINAL_LIMIT,
		h.description as HOLD_MAIL ,
		a.total_installment_paid_cash_price_ratio as T_INST_PAID,
        case when asr.code = '6' then 'Yes'
        when asr.code = '7' then 'Yes' else 'No' end,
        
        gr.description as FACILITY_TYPE,
        c.customer_id_no as IC_NO,
        p.description as PRODUCT_TYPE,
        case when ic.code is not null then 'Y' else 'N' end as TAKAFUL,
        a.current_balance as CURRENT_BALANCE,
        
        A.INTEREST_RATE as PROFIT_RATE,
        a.security_deposit_amount as SECURITY_DEPOSIT,
        em.employer_name,
		occ.description as occupation,
		null as ECA_ABORT_DATE,
		
		null as ECA,
		a.outstanding_balance as OUTSTANDING_BALANCE,
		a.PAYMENT_AMOUNT as MONTHLY_PAYMENT,
		a.installment_amount_in_arrears as PAYMENT_IN_ARREARS,
		
		case when a.released_amount &gt; 0 and a.original_balance &gt; 0 then
		(a.released_amount/a.original_balance) else 0 end as PERCENTAGE_OF_RELEASED_AMOUNT,
		(a.current_balance - a.interest_rebate_amount - isl.sptf_profit_outstanding_amount - isl.sptf_profit_overdue_amount ) as PRINCIPAL_BALANCE,  
		a.bank_discount_amount as PROFIT_CHARGES,
		case when tt.status_id='15007' then 'Y' else 'N' end as DEFICIENCY,
		TO_CHAR (a.next_payment_due_date, 'DD') as DUE_DATE,
		case when multi_tier_flag='Y' then 'Multi - Tier' else 'Single Tier' end as TIER_TYPE,
		 uw.user_id,e.first_name,e.middle_name,e.last_name,
		 g.bank_coordinator,g.description,ag.expected_end_date
		 
		FROM ptraccount a
		inner join ptrcustomer c on C.ID=CAST(A.CUSTOMER_ID AS BIGINT)		
		INNER JOIN PTRPRODUCT_TYPE_REF P ON P.ID=A.PRODUCT_TYPE_ID
		left join ptrproduct_type_category_ref r on r.id=p.category_id
		LEFT JOIN PTRSALUTATION_REF SALUTATION ON SALUTATION.ID=C.SALUTATION_ID
		LEFT JOIN PTRACCOUNT_STATUS_REF STATUS ON STATUS.ID=A.STATUS_ID
		left JOIN ptrbank_branch_ref B ON B.ID=A.BANK_BRANCH_ID
		LEFT JOIN PTRNPL_STATUS_REF NPL ON NPL.ID=A.NPL_STATUS_ID
		LEFT JOIN PTRSPTF_TYPE_REF SPTF ON SPTF.ID=A.SPTF_TYPE_ID
		left join ptraccount_tlast tlast on tlast.account_id=a.id
		left join ptraccount_islamic_det isl on isl.account_id=a.id
		left join ptraccount_status_ref asr on a.status_id=asr.id
		left join ptrfacility_code_ref fa on fa.id=a.facility_code_id
		left join ptrhold_mail_code_ref h on a.hold_mail_code_id = h.id 
		left join ptraccount_collateral_rel rel on a.id=rel.account_id
		left join ptrcollateral col on col.id=rel.collateral_id
		left join ptrhost_collateral_insurance i on i.collateral_id = col.id
		left join ptrinsurance_company_ref ic on i.insurance_company_id = ic.id
		left join ptrhost_employment_history em on em.customer_id=c.id
		left join ptroccupation_ref occ on em.occupation_id=occ.id
		left join ptrfacility_type_ref fac on fac.id=a.facility_code_id
		left join ptrfacility_type_group_ref gr on gr.id=fa.group_id
		left join ptrtreatment tt on tt.account_id=a.id
		left JOIN ptraccount_work_list_assignment wl on wl.account_id=a.id
		left join ptruser_wl_assign uw on uw.work_list_id=wl.work_list_id and uw.is_default_user = <include refid="true"/>
		left join ptruser u on u.user_id=uw.user_id
		left join ptremployee e on e.id=u.employee_id
		left join ptraccount_agency_assignment ag on ag.account_id=a.id
		left join ptragency g on g.id=ag.agency_id
		WHERE A.ID=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getLastActionHistory" class="hmap">
		<result property="LAST_ACTION_CODE" javaType="string" />
		<result property="LAST_ACTION_DESCRIPTION" javaType="string" />
		<result property="LAST_ACTION_STATUS" javaType="string" />
		<result property="LAST_ACTION_DATE" javaType="date" />
	</resultMap>
	<select id="getLastActionHistory" resultMap="getLastActionHistory">
		select tr.code,tr.description,coalesce(ts.description,s.description) as STATUS, 
		coalesce(tt.updated_time,tt.created_time) as LAST_ACTION_DATE
		from ptraccount_last_treatment t
		inner join ptrtreatment tt on tt.id=t.treatment_id
		inner join ptrtreatment_type_ref tr on tr.id=tt.type_id
		inner join ptrtreatment_status_ref s on s.id=tt.status_id
		left join ptrtreatment_type_status_ref ts on ts.id=tt.type_status_id
		WHERE t.account_id=#ACCOUNT_ID#
	</select>

	<resultMap id="getAccountEcaInformation" class="hmap">
		<result property="AGENCY_NAME" javaType="string" />
		<result property="ECA_ABORT_DATE" javaType="date" />
	</resultMap>
	<select id="getAccountEcaInformation" resultMap="getAccountEcaInformation">
		select g.description,ag.expected_end_date
		from ptraccount a
		left join ptraccount_agency_assignment ag on ag.account_id=a.id and ag.status_id=15007
		left join ptragency g on g.id=ag.agency_id
		left join ptrtreatment_subtype_ref s on s.id=ag.subtype_id and s.type_id=19
		where a.id=#ACCOUNT_ID#
	</select>
		
	<resultMap id="getLastPaymentReversal" class="hmap">
		<result property="ACCOUNT_ID" javaType="long" />
		<result property="REVERSAL_DATE" javaType="date" />
		<result property="REVERSAL_AMOUNT" javaType="$" />
	</resultMap>
	<select id="getLastPaymentReversal" resultMap="getLastPaymentReversal">
		select account_id, reversal_date, reversal_amount
        from (
           select p.account_id, p.posting_date reversal_date, p.amount reversal_amount,  p.id, 
           row_number() over (partition by p.account_id order by p.posting_date desc, p.posting_order desc) as rowNum
           from ptrtransaction p
           inner join ptrtransaction_type_ref ref on p.transaction_type_id = ref.id
           where  p.account_id = #ACCOUNT_ID#  and
           upper(ref.description) like '%REV%'
           order by  p.posting_date desc , p.id desc
          )t
         where rownum = 1
	</select>
	
	<resultMap id="getCollateralDetails" class="hmap">
		<result property="VEHICLE_NUMBER" javaType="string" />
		<result property="COLLATERAL_DESCRIPTION" javaType="string" />
		<result property="MODEL" javaType="string" />
		<result property="YEAR_OF_MANUFACTURE" javaType="long" />
	</resultMap>
	<select id="getCollateralDetails" resultMap="getCollateralDetails">
		SELECT 
		COL.REGISTRATION_NO,
		col.description,
		col.model_no,
		col.year_of_manufacture 
		FROM ptrcollateral col
		inner join ptraccount_collateral_rel r on r.collateral_id=col.id
		inner join ptraccount a on a.id=r.account_id
		WHERE A.ID=#ACCOUNT_ID#
	</select>
	

	<resultMap id="getCustomerStatistic" class="hmap">
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="CIF_NUMBER" javaType="string" />
		<result property="ACCOUNT_NUMBER" javaType="string" />
		<result property="LOAN_TYPE" javaType="string"/>
		<result property="ACCOUNT_RELATIONSHIP" javaType="string"/>
		<result property="NUMBER_PROMISE" javaType="long" />
		<result property="NUMBER_KEPT_PROMISE" javaType="long" />
		<result property="NUMBER_BROKEN_PROMISE" javaType="long" />
		<result property="NUMBER_CALL_ATTEMPT" javaType="long" />
		<result property="MIA" javaType="long" />
		<result property="OUTSTANDING_BALANCE" javaType="$" />
		
	</resultMap>
	<select id="getCustomerStatistic" resultMap="getCustomerStatistic">
		SELECT
		C.CUSTOMER_NAME,
		C.CUSTOMER_NO as CIF_NUMBER,
		A.ACCOUNT_NO AS ACCOUNT_NUMBER,
		p.description as FINANCING_TYPE,
		TYPE.DESCRIPTION as ACCOUNT_RELATIONSHIP,
		count(distinct proc.id) as PROMISES_COUNT,
        count(distinct proc2.id) as KEPT_PROMISES_COUNT,
        count(distinct proc3.id) as BROKEN_PROMISES_COUNT,
        count(distinct pr.id) as NUMBER_CALL_ATTEMPT,
        a.MONTHS_IN_ARREARS,
        A.outstanding_balance as OUTSTANDING_BALANCE
		FROM PTRCUSTOMER C
		INNER JOIN PTRACCOUNT A ON C.ID=A.CUSTOMER_ID
		INNER JOIN PTRPRODUCT_TYPE_REF P ON P.ID=A.PRODUCT_TYPE_ID
		INNER JOIN PTRCUSTOMER_ACCOUNT_REL R ON R.CUSTOMER_ID=C.ID
		INNER JOIN PTRCUSTOMER_ACCOUNT_RELATION_TYPE_REF TYPE ON TYPE.ID=R.TYPE_ID
		LEFT OUTER JOIN PTRTREATMENT proc on (a.id = proc.account_id and proc.TYPE_ID=2 and proc.TYPE_STATUS_ID not in (15005) and proc.created_time between #FROM_DATE# and #TO_DATE#)       
        LEFT OUTER JOIN PTRTREATMENT proc2 on (a.id = proc2.account_id and proc2.TYPE_ID=2 and proc2.TYPE_STATUS_ID = 15004)
        LEFT OUTER JOIN PTRTREATMENT proc3 on (a.id = proc3.account_id and proc3.TYPE_ID=2 and proc3.TYPE_STATUS_ID = 15001)
        LEFT OUTER JOIN PTRTREATMENT pr on (a.id = pr.account_id and pr.TYPE_ID=8 and pr.created_time between #FROM_DATE# and #TO_DATE#)
		WHERE A.ID=#ACCOUNT_ID#
		and a.customer_id = #CUSTOMER_ID:NUMERIC#
		group by a.ACCOUNT_NO, a.MONTHS_IN_ARREARS, c.customer_name, c.customer_no ,p.description, type.description, A.outstanding_balance
	</select>

	<resultMap id="getCustomerInformation" class="hmap">
		<result property="GENDER" javaType="string" />
		<result property="RACE" javaType="string" />
		<result property="NATIONALITY" javaType="string" />
		<result property="DATE_OF_BIRTH" javaType="date" />
		<result property="CUSTOMER_NUMBER" javaType="string" />
		<result property="MARITAL_STATUS" javaType="String" />
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="NRIC" javaType="string" />
		<result property="OLD_IC" javaType="string" />
		<result property="EMPLOYER_NAME" javaType="string" />
		<result property="OCCUPATION" javaType="string" />
		<result property="INCOME_BRACKET" javaType="string" />
		<result property="PRIMARY_ID_TYPE" javaType="string" />
		
	</resultMap>
	<select id="getCustomerInformation" resultMap="getCustomerInformation">
		SELECT
		GENDER.DESCRIPTION,RACE.DESCRIPTION,NATIONALITY.DESCRIPTION AS NATIONALITY,
		C.DATE_OF_BIRTH,C.CUSTOMER_NO,MARITAL.DESCRIPTION as MARITAL_STATUS,
		C.CUSTOMER_NAME,
		c.customer_id_no,
		ic.customer_id_no,
		em.employer_name,
		occ.description as occupation,
		inc.description as INCOME_BRACKET,
		c.customer_id_no as primary_id
		FROM PTRCUSTOMER C
		left join ptrcustomer_identification_no ic on ic.customer_id=c.id
		inner join ptrhost_employment_history em on em.customer_id=c.id
		INNER JOIN PTRACCOUNT A ON	A.CUSTOMER_ID=C.ID
		LEFT JOIN PTRGENDER_REF GENDER ON GENDER.ID=C.GENDER_ID
		LEFT JOIN PTRETHNICITY_REF RACE ON RACE.ID=C.ETHNICITY_ID
		LEFT JOIN PTRCITIZENSHIP_REF NATIONALITY ON	NATIONALITY.ID=C.CITIZENSHIP_ID
		LEFT JOIN PTRMARITAL_STATUS_REF MARITAL	ON MARITAL.ID=C.MARITAL_STATUS_ID
		left join ptroccupation_ref occ on em.occupation_id=occ.id
		left join ptrincome_bracket_ref inc on em.income_bracket_id=inc.id
		WHERE A.ID=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getCustEmploymentDetails" class="hmap">
		<result property="EMPLOYER_NAME" javaType="string" />
		<result property="OCCUPATION" javaType="string" />
		<result property="INCOME_BRACKET" javaType="string" />
	</resultMap>
	
	<select id="getCustEmploymentDetails" resultMap="getCustEmploymentDetails">
		SELECT
		heh.employer_name,occ.description as occupation,
		inc.description as INCOME_BRACKET
		FROM PTRHOST_EMPLOYMENT_HISTORY HEH
		LEFT JOIN PTRACCOUNT A  ON A.CUSTOMER_ID=HEH.CUSTOMER_ID
		left join ptroccupation_ref occ on HEH.occupation_id=occ.id
		left join ptrincome_bracket_ref inc on HEH.income_bracket_id=inc.id
		WHERE A.ID=#ACCOUNT_ID#
	</select>

	<resultMap id="getCustomerAccountRelationship" class="hmap">
		<result property="ACCOUNT_NUMBER" javaType="string" />
		<result property="RELATIONSHIP" javaType="string" />
		<result property="LOAN_TYPE" javaType="string" />
	</resultMap>
	<select id="getCustomerAccountRelationship" resultMap="getCustomerAccountRelationship">
		SELECT
		A.ACCOUNT_NO,TYPE.DESCRIPTION,PRODUCT.DESCRIPTION
		FROM PTRACCOUNT A
		INNER JOIN PTRCUSTOMER_ACCOUNT_REL R ON R.ACCOUNT_ID=A.ID
		INNER JOIN
		PTRCUSTOMER_ACCOUNT_RELATION_TYPE_REF TYPE ON TYPE.ID=R.TYPE_ID
		INNER
		JOIN PTRPRODUCT_TYPE_REF PRODUCT ON PRODUCT.ID=A.PRODUCT_TYPE_ID
		WHERE
		R.CUSTOMER_ID=cast(#CUSTOMER_ID# as bigint)
	</select>
	
	<resultMap id="getCustomerAccountGuarantorCount" class="hmap">
		<result property="GUARANTOR_COUNT" javaType="long" />
	</resultMap>
	
	<select id="getCustomerAccountGuarantorCount" resultMap="getCustomerAccountGuarantorCount">
		select  count(r.customer_id)
	from ptrcustomer_account_rel r 
	inner join ptrcustomer_account_relation_type_ref tr on tr.id=r.type_id and tr.code !='P'
	inner join ptrcustomer c on r.customer_id=c.id
	where r.account_id=#ACCOUNT_ID#
	</select>

	
	<resultMap class="hmap" id="getCustomerEmploymentDetails">
		<result property="CUSTOMER_NAME_EMP" javaType="string" />
		<result property="PRIMARY_NUMBER" javaType="string" />
		<result property="PDRM_IC" javaType="string" />
		<result property="KEMENTERIAN_JABATAN_RECON" javaType="string" />
		<result property="IMPORT_EMPLOYER_NAME" javaType="string" />
		<result property="EMPLOYER_NUMBER" javaType="string" />
		<result property="LOCATION" javaType="string" />
		<result property="NEW_EMPLOYMENT_STATUS" javaType="string" />
		<result property="INFO_MAJIKAN" javaType="string" />
		<result property="INFO_BIRO" javaType="string" />
		<result property="PAYMENT_METHOD" javaType="string" />
		<result property="CALL_STATUS" javaType="string" />
		<result property="IN_FLOW" javaType="string" />
		<result property="CONTACT_NUMBER" javaType="string" />
		<result property="ECA_TPS" javaType="string" />
		<result property="REMARKS" javaType="string" />
	</resultMap>

	
	<select id="getCustomerEmploymentDetails" resultMap="getCustomerEmploymentDetails">
		select
		cus.CUSTOMER_NAME,
		cus.customer_no as PRIMARY_NUMBER,
		c.pdrm_ic as PDRM_IC,
		e.code as KEMENTERIAN_JABATAN_RECON,
		gr.description as EMPLOYER_NAME,
		c.employer_no as EMPLOYER_NUMBER,
		c.location as LOCATION,
		c.new_contact_number as NEW_EMPLOYMENT_STATUS,
		inf.description as INFO_MAJIKAN,
		c.info_from_biro as INFO_BIRO,
		c.payment_method as PAYMENT_METHOD,
		c.calling_status as CALL_STATUS,
		c.inflow as IN_FLOW,
		c.mobile as CONTACT_NUMBER,
		c.eca_tps as ECA_TPS,
		c.remarks as REMARKS
		from ptrcustomer cus
		inner join ptrcustomer_employment_details c on cus.id=c.customer_id
		left join ptremployer_ref e on e.id=c.employer_id
		left join ptremployer_default_reason_ref inf on inf.id=c.employer_default_reason_id
		left join ptremployer_group_ref gr on gr.id=e.group_id
		where c.customer_id=cast(#CUSTOMER_ID# as bigint)
	</select>

	<resultMap id="getAccountVehicleInformation" class="hmap">
		<result property="VEHICLE_NUMBER" javaType="string" />
		<result property="CAR_MAKE" javaType="string" />
		<result property="MODEL" javaType="string" />
		<result property="DATE_REGISTRATION" javaType="date" />
		<result property="MANUFACTURED_YEAR" javaType="string" />
		<result property="CHASSIS_NUMBER" javaType="string" />
		<result property="ENGINE_NUMBER" javaType="string" />
		<result property="COLLATERAL_DESCRIPTION" javaType="string" />
		<result property="PURCHASES_CASH" javaType="$" />
		<result property="DOWNPAYMENT" javaType="$" />
		<result property="LOG_NUMBER" javaType="string" />
		<result property="RELEASE_LETTER_SERIAL_NO" javaType="string" />
		<result property="OWNERSHIP_NO" javaType="string" />
		<result property="EOWN_OCL_NO" javaType="string" />
		<result property="FAIR_VALUE" javaType="$" />
		<result property="INSURANCE_COMPANY" javaType="string" />
		<result property="COVER_NUMBER" javaType="string" />
		
	</resultMap>
	<select id="getAccountVehicleInformation" resultMap="getAccountVehicleInformation">
		select col.registration_no, col.make_of_goods,col.model_no, col.registration_date, col.year_of_manufacture,
		col.chasis_number, col.engine_number, col.description, col.purchase_price, col.DOWNPAYMENT_CASH_AMOUNT, 
		col.log_book_no,col.rl_serial_no,
		case when col.ownership_claim_no != '0' or col.ownership_claim_no != '999999999999999' then col.ownership_claim_no end as OWNERSHIP_NO,
		case when col.ownership_claim_no != '0' or col.ownership_claim_no != '999999999999999' then (concat(concat(SUBSTR(la.credit_application_number,1,3), SUBSTR(la.credit_application_number, 5,2)), concat(SUBSTR(la.credit_application_number, 8,4), SUBSTR(la.credit_application_number, 13,8)))) end as EOWN_OCL_NO,
		col.current_value,i.description,pci.cover_note_no
		from ptrcollateral col 
		inner join ptraccount_collateral_rel rel on col.id=rel.collateral_id
		inner join ptraccount a on a.id=rel.account_id
		inner join ptrcustomer cus on a.customer_id = cus.id
		left join ptraccount_loan_application_rel l on l.account_id=a.id
		left join ptrloan_application la on la.id=l.loan_application_id
		left join ptrhost_collateral_insurance pci on pci.collateral_id=col.id
		left join ptrinsurance_company_ref i on i.id=pci.insurance_company_id
		where rel.account_id= #ACCOUNT_ID#
		and cus.customer_no = ltrim(col.registered_owner_cif_no, '0')
	</select>
	
	<resultMap id="getAccountMaxTreatmentIdRepo" class="hmap">
		<result property="TREATMENT_ID" javaType="long" />
		
	</resultMap>
	<select id="getAccountMaxTreatmentIdRepo" resultMap="getAccountMaxTreatmentIdRepo">
	
		SELECT max(treatment_id) FROM ptrtreatment_repossession where account_id=#ACCOUNT_ID#
		
	</select>
	
	<resultMap id="getAccountReposessionDetails" class="hmap">
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		<result property="COLLATERAL_ID" javaType="string" />
		<result property="NO_ISSUED" javaType="long" />
		<result property="RO_UNTIL" javaType="date" />
		
		<result property="GUARANTOR_RIGHTS" javaType="string" />
		<result property="DATE_REDEEMED" javaType="date" />
		<result property="LAST_REINSTATE" javaType="date" />
		<result property="CONDITION_GOODS" javaType="string" />
		<result property="REPOSSESSION_DATE" javaType="date" />
		
		<result property="KEY_AVAILABLE" javaType="string" />
		<result property="AUTOMATIC_CAR" javaType="string" />
		<result property="ACCIDENT_CAR" javaType="string" />
		<result property="STOREYARD_NAME" javaType="string" />
		<result property="OTHER_CHARGES" javaType="$" />
		
		<result property="5TH_DATE" javaType="date" />
		<result property="ESTI_VALUE" javaType="$" />
		<result property="SOURCE_VALUATION" javaType="string" />
		<result property="COST_REPO" javaType="$" />
		<result property="STORE_COST" javaType="$" />
		
		<result property="COST_REDELIVERY" javaType="$" />
		<result property="LEGAL_FEES" javaType="$" />
		<result property="LOC_GOODS" javaType="string" />
		<result property="DATE_OF_REPOSESSION" javaType="date" />
		<result property="DATE_OF_REDEEMED" javaType="date" />
		
		<result property="REMARK_HOST" javaType="string" />

	</resultMap>
	<select id="getAccountReposessionDetails" resultMap="getAccountReposessionDetails">
		select 
		col.name,
		ctr.description,
		ltrim(col.host_collateral_id, '0'),
		repo.no_of_ro_issued,
		repo.fifth_schedule_date,
			
		repo.guarantor_waiver_rights,
		repo.redemption_date,
		repo.last_date_to_reinstate,
		repo.condition_of_goods,
		repo.reposession_date,
		
		repo.key_available_flag,
		repo.automatic_car_flag,
		repo.accident_car_flag,
		repo.location_of_repo_goods,
		repo.other_charges,
		
		repo.fifth_schedule_date,
		repo.estimate_sales_value,
		repo.valuation_by,
		repo.repossession_cost,
		repo.storage_cost,
		
		repo.redelivery_cost,
		repo.legal_fees,
		repo.location_of_repo_goods,
		repo.reposession_date,
		repo.redemption_date,
		
		repo.remarks_1 || '/' || repo.remarks_2 || '/' || repo.remarks_3
		
		from ptrcollateral col 
		inner join ptraccount_collateral_rel rel on col.id=rel.collateral_id
		left join ptrhost_repossession_order repo on rel.account_id=repo.account_id
		left join ptrcollateral_type_ref ctr on col.type_id = ctr.id
		where rel.account_id= #ACCOUNT_ID#
	</select>
	
	<resultMap id="getAccountReposessionDetailsTwa" class="hmap">

		<result property="REPO_TOWING" javaType="string" />
	</resultMap>
	<select id="getAccountReposessionDetailsTwa" resultMap="getAccountReposessionDetailsTwa">
		select 
		towing
		from ptrtreatment_repossession 
		where treatment_id= #TREATMENT_ID#
	</select>

	<resultMap id="getAccountVehicleRcMovement" class="hmap">
		<result property="REGISTRATION_NUMBER" javaType="string" />
		<result property="CHASSIS_NUMBER" javaType="string" />
		<result property="ENGINE_NUMBER" javaType="string" />
		<result property="LOG_BOOK_NO" javaType="string" />
		<result property="ROAD_TAX_EXPIRY_DATE" javaType="date" />
		<result property="DEALER_NUMBER" javaType="string" />
		<result property="OWNER_CLAIM_NUMBER" javaType="string" />
		<result property="EOWN_OCL_NO" javaType="string" />
		<result property="REMARKS" javaType="string" />
	</resultMap>
	<select id="getAccountVehicleRcMovement" resultMap="getAccountVehicleRcMovement">
		select col.registration_no,col.chasis_number,col.engine_number,col.log_book_no,
		col.road_tax_expiry_date,col.dealer_number,col.ownership_claim_no,
		case when col.ownership_claim_no != '0' or col.ownership_claim_no != '999999999999999' then (concat(concat(SUBSTR(la.credit_application_number,1,3), SUBSTR(la.credit_application_number, 5,2)), concat(SUBSTR(la.credit_application_number, 8,4), SUBSTR(la.credit_application_number, 13,8)))) end as EOWN_OCL_NO,
		pci.remark_1
		from ptraccount_collateral_rel rel 
		inner join ptrcollateral col on col.id=rel.collateral_id
		inner join ptraccount a on a.id=rel.account_id
		left join ptraccount_loan_application_rel l on l.account_id=a.id
		left join ptrloan_application la on la.id=l.loan_application_id
		left join ptrhost_collateral_insurance pci on pci.collateral_id=col.id
		where rel.account_id= #ACCOUNT_ID#
	</select>
	
	<resultMap id="getAccount75Ruling" class="hmap">

	</resultMap>
	<select id="getAccount75Ruling" resultMap="getAccount75Ruling">

	</select>
	
	<resultMap id="getAccountAuctionDetails" class="hmap">

		<result property="COLLATERAL_NAME" javaType="string" jdbcType="VARCHAR" />
		<result property="COLLATERAL_CODE" javaType="string" jdbcType="VARCHAR" />
		<result property="DATE_OF_REGISTRATION" javaType="date" jdbcType="DATE" />
		<result property="YEAR_OF_MANUFACTURE" javaType="string" jdbcType="VARCHAR" />
		<result property="5TH_SCHEDULE_SENDING_DATE" javaType="date" jdbcType="DATE" />
		<result property="REGISTRATION_CARD" javaType="string" jdbcType="VARCHAR" />
		<result property="AUCTION_DATE" javaType="date"/>
		<result property="STORAGE_FEE_PAID" javaType="double" />
		<result property="REPOSSESSION_FEE_PAID" javaType="double" />
		<result property="OTHER_INCIDENTAL_COST_PAID" javaType="double" />

	</resultMap>
	<select id="getAccountAuctionDetails" resultMap="getAccountAuctionDetails">
		select
		col.name,
		ctr.description,
		col.registration_date,
		col.year_of_manufacture,
		repo.fifth_schedule_date,
		col.registration_no,
		col.auction_date,
		repo.storage_cost,
		repo.repossession_cost,
		repo.other_charges
		from ptrcollateral col 
		inner join ptraccount_collateral_rel rel on col.id=rel.collateral_id
		left join ptrhost_repossession_order repo on rel.account_id=repo.account_id
		left join ptrcollateral_type_ref ctr on col.type_id = ctr.id
		where rel.account_id= #ACCOUNT_ID#
	</select>
	
	<resultMap id="getAccountAuctionDetailsAcutionFee" class="hmap">

		<result property="AUCTION_FEE_PAID" javaType="double" />

	</resultMap>
	<select id="getAccountAuctionDetailsAcutionFee" resultMap="getAccountAuctionDetailsAcutionFee">
		select
		case when ac.misc_charges &gt; 0 then sum(ac.misc_charges) 
		when ac.other_charges &gt; 0 then sum(ac.other_charges) end
		from ptrcollateral col 
		inner join ptraccount_collateral_rel rel on col.id=rel.collateral_id
		left join ptraccount_charge_details ac on rel.account_id=ac.account_id
		inner join ptrcharge_type_ref type on ac.type_id=type.id
		where rel.account_id=#ACCOUNT_ID#
		and type.code = '09'
		group by ac.misc_charges,ac.other_charges 
	</select>
	
	<resultMap id="getAccountMaxTreatmentId" class="hmap">
		<result property="TREATMENT_ID" javaType="long" />
		
	</resultMap>
	<select id="getAccountMaxTreatmentId" resultMap="getAccountMaxTreatmentId">
	
		SELECT max(treatment_id) FROM ptrtreatment_auction where account_id=#ACCOUNT_ID#
		
	</select>
	
	<resultMap id="getAccountAuctionDetailsTwa" class="hmap">
		<result property="TREATMENT_ID" javaType="long" />
		<result property="STORE_YARD" javaType="string" jdbcType="VARCHAR" />
		<result property="AUCTION_HOUSE" javaType="string" jdbcType="VARCHAR" />
		<result property="SUCCESSFUL_BIDDER" javaType="string" jdbcType="VARCHAR" />
		<result property="BIDDER_CRIC" javaType="string" jdbcType="VARCHAR" />
		<result property="CONTACT_NO" javaType="string" jdbcType="VARCHAR" />
		<result property="AUCTION_14DAYS_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<result property="DATE_SOLD_AUCTION" javaType="date"/>
		<result property="SALES_PROCEED_AMOUNT" javaType="double" />
		<result property="SHORTFALL_DATE" javaType="date" jdbcType="DATE" />
		<result property="DISCHARGED_DATE" javaType="date" jdbcType="DATE" />
		<result property="SHORTFALL_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<result property="FS_DATE" javaType="date" jdbcType="DATE" />
		<result property="NI_DATE" javaType="date" jdbcType="DATE" />
		<result property="LAST_5S_DATE" javaType="date" jdbcType="DATE" />
		<result property="TECHNICAL_REASON" javaType="string" jdbcType="VARCHAR" />
		<result property="TECHNICAL_REASON_DESCRIPTION" javaType="long" />
		<result property="COC_SECTION42" javaType="double" />
		<result property="COC_SECTION161A" javaType="double" />
		<result property="NOTES" jdbcType="VARCHAR"/>
		<result property="RESERVE_PRICE" javaType="double"/>
		<result property="BIDDER_ADDRESS" javaType="string"/>
		<result property="TYPE_STATUS_ID" javaType="long" />
	</resultMap>
	<select id="getAccountAuctionDetailsTwa" resultMap="getAccountAuctionDetailsTwa">
		select
		TREATMENT_ID,
		STORE_YARD,
		AUCTION_HOUSE,
		SUCCESSFUL_BIDDER,
		BIDDER_NRIC_ROC,
		CONTACT_NO,
		AUCTION_14DAYS_NOTICE_DATE,
		DATE_SOLD,
		SALES_PROCEED_AMOUNT as SALES_PROCEED_AMOUNT,
		SHORTFALL_DATE,
		E_DISCHARGE_DATE,
		SHORTFALL_NOTICE_DATE,
		FS_DATE,
		NI_DATE,
		LAST_5S_DATE,
		TECHNICAL_REASON,
		TECHNICAL_REASON_DESCRIPTION,
		COC_SECTION42,
		COC_SECTION161A,
		NOTES,
		RESERVE_PRICE,
		BIDDER_ADDRESS,
		TYPE_STATUS_ID
		from ptrtreatment_auction
		where
		TREATMENT_ID =#TREATMENT_ID#
	</select>
	
	<resultMap id="getAccountShortfallDetails" class="hmap">
	
	    <result property="SALES_PROCEED_AMOUNT" javaType="$" />
		<result property="PROVISION_CHARGES" javaType="$" />
		<result property="SHORTFALL_NOTICE_PRINTING_DUE" javaType="date" />
		<result property="PAYOFF_AMOUNT" javaType="$" />
		<result property="SHORTFALL_OUTSTANDING_BALANCE" javaType="$" />

	</resultMap>
	<select id="getAccountShortfallDetails" resultMap="getAccountShortfallDetails">
		
		select 
		s.sales_proceed_amount,
		s.provision_charges, 
		case when t.status_id=15007 then current_date else s.printing_date end as printing_date ,
		case when t.status_id=15007 then a.payoff_amount else s.payoff_amount end as payoff_amount,
		(case when t.status_id=15007 then a.payoff_amount else s.payoff_amount end ) + s.provision_charges as SHORTFALL_OUTSTANDING_BALANCE
		from ptrtreatment_shortfall s
		inner join ptraccount a on a.id=s.account_id
		inner join ptrtreatment t on t.id=s.treatment_id
		where s.treatment_id=(select max(ss.treatment_id)
		from ptrtreatment_shortfall ss
		inner join ptrtreatment tt on tt.id=ss.treatment_id and tt.status_id in(15004,15007)
		where ss.account_id=s.account_id)
		and s.account_id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPropertyInformation" class="hmap">
		<result property="COLLATERAL_ID" javaType="long" />
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
	</resultMap>
	<select id="getPropertyInformation" resultMap="getPropertyInformation">
		select col.id,col.host_collateral_id,col.description 
		from ptraccount_collateral_rel r 
		inner join ptrcollateral col on r.collateral_id=col.id
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		where r.account_id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPropertyInsuranceInformation" class="hmap">
		<result property="COLLATERAL_ID" javaType="long" />
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<!-- <result property="TYPE" javaType="string" /> -->
	</resultMap>
	
	<select id="getPropertyInsuranceInformation" resultMap="getPropertyInsuranceInformation">
		select col.id,col.host_collateral_id,col.description 
		<!--  case when typeref.code in ('H10','H99') then 'MRTA' else 'PG' end as TYPE -->
		from ptraccount_collateral_rel r 
		inner join ptrcollateral col on r.collateral_id=col.id
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		where r.account_id=#ACCOUNT_ID#
	</select>
	
	<select id="getPropertyFireInsuranceInformation" resultMap="getPropertyInformation">
		select col.id,col.host_collateral_id,col.description 
		from ptraccount_collateral_rel r 
		inner join ptrcollateral col on r.collateral_id=col.id
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		where r.account_id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPropertyInformationDetail" class="hmap">
		<result property="LOC_OF_LOT_LINE1" javaType="string" />
		<result property="LOC_OF_LOT_LINE2" javaType="string" />
		<result property="LOC_OF_LOT_LINE3" javaType="string" />
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		
		<result property="COLLATERAL_DESC" javaType="string" />
		<result property="LAND_AREA" javaType="string" />
		<result property="BUILD_UP_AREA" javaType="string" />
		<result property="TITLE_NUMBER" javaType="string" />
		<result property="LOT_NUMBER" javaType="string" />
		
		<result property="TITLE_EXPIRY_DATE" javaType="date" />
		<result property="OFFICIAL_VALUER" javaType="string" />
		<result property="OFFICIAL_VALUE" javaType="$" />
		<result property="TIE_TO_MASTER_TITLE_NUMBER" javaType="string" />
		<result property="VALUATION_DATE" javaType="date" />
		
		<result property="LAND_VALUE" javaType="$" />
		<result property="MARKET_VALUE" javaType="$" />
		<result property="FORCE_SALE_VALUE" javaType="$" />
		<result property="BRANCH_VALUATION" javaType="$" />
		<result property="OFFICIAL_VALUATION_DATE" javaType="date" />
		
		<result property="LOC_OF_LOT_POSTCODE" javaType="string"/>
		<result property="TITLE_TYPE" javaType="string"/>
		<result property="MUKIM" javaType="string" />
		<result property="TITLE_HELD_BY" javaType="string" />
		<result property="FREE_LEASE_HOLD" javaType="string" />
		
		<result property="LEASEHOLD_TENURE" javaType="long" />
		<result property="MASTER_TITLE" javaType="string" />
		<result property="TITLE_ISSUED_DATE" javaType="date" />
		<result property="LAND_CATEGORY" javaType="string" />
		<result property="SP_VALUE" javaType="$" />
		<result property="SP_DATE" javaType="date" />
		
		
		<result property="VALUER_NAME" javaType="string" />
		<result property="VALUATION_VALUE" javaType="$" />
		<result property="NEXT_VALUATION_DATE" javaType="date" />
		<result property="BRANCH_VALUATION_DATE" javaType="date" />
		<result property="PROPERTY_TYPE" javaType="string" />
	</resultMap>
	
	<select id="getPropertyInformationDetail" resultMap="getPropertyInformationDetail">
		select 
		col.location_of_lot_1 as LOC_OF_LOT_LINE1,
		col.location_of_lot_2 as LOC_OF_LOT_LINE2,
		col.location_of_lot_line_3 as LOC_OF_LOT_LINE3,
		col.host_collateral_id as COLLATERAL_NAME,
		typeref.code as COLLATERAL_CODE,
		
		col.name as COLLATERAL_DESC,
		col.land_area as LAND_AREA,
		col.build_up_area as BUILD_UP_AREA,
		COL.title_no as TITLE_NUMBER,
		COL.lot_no AS LOT_NUMBER,
		
		col.title_expiry_date as TITLE_EXPIRY_DATE,
		col.official_valuer as OFFICIAL_VALUER, 
		col.official_valuation_amount as OFFICIAL_VALUE,
		col.master_title_no as TIE_TO_MASTER_TITLE_NUMBER,
		col.valuation_date as VALUATION_DATE,
		
		col.land_value as LAND_VALUE,
		col.current_value as MARKET_VALUE,
		col.forced_sale_value as FORCE_SALE_VALUE,
		col.internal_br_valuation_amount as BRANCH_VALUATION,
		col.official_valuation_date as OFFICIAL_VALUATION_DATE,
		
		null as LOC_OF_LOT_POSTCODE,
		coalesce(t.code,' ') ||' - ' ||coalesce(t.description,' ')  as TITLE_TYPE,
		col.county_district_town as MUKIM,
		col.title_held_by as TITLE_HELD_BY,
		col.freehold_leasehold_flag as FREE_LEASE_HOLD,
		
		col.deposit_term as LEASEHOLD_TENURE,
		col.master_title_flag as MASTER_TITLE,
		col.title_bond_issued_date as TITLE_ISSUED_DATE,
		col.category_of_land as LAND_CATEGORY,
		col.purchase_price as SP_VALUE,
		col.s_and_p_date as SP_DATE,
		
		
		col.official_valuer as VALUER_NAME,
		col.official_valuation_amount as VALUATION_VALUE,
		col.next_valuation_date as NEXT_VALUATION_DATE,
		null as BRANCH_VALUATION_DATE,
		pt.description
		from ptrcollateral col 
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		left join ptrproperty_type_ref pt on pt.id=col.property_type_id
		left join ptrtitle_type_ref t on t.id=col.title_type_id
		where col.id=#COLLATERAL_ID#
	</select>
	
	<resultMap id="getInsuranceMRTADetail" class="hmap">
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="COLLATERAL_DESC" javaType="string" />
		<result property="INSURED_CIF_NUMBER" javaType="long" />
		<result property="INSURED_SHORT_NAME" javaType="string" />
		<result property="PREMIUM_AMOUNT" javaType="$" />
		<result property="TOTAL_SUM_INSURED" javaType="$" />
		<result property="REMARKS" javaType="string" />
		<result property="TOTAL_FINANCE_AMOUNT" javaType="string" />
		<result property="TOTAL_PREMIUM_AMOUNT" javaType="string" />
		
	</resultMap>
	
	<select id="getInsuranceMRTADetail" resultMap="getInsuranceMRTADetail">
	select 
		col.host_collateral_id as COLLATERAL_NAME,
		typeref.code as COLLATERAL_CODE,
		c.customer_name as CUSTOMER_NAME,
		col.name as COLLATERAL_DESC,
		c.customer_no as INSURED_CIF_NUMBER,
		c.short_name as INSURED_SHORT_NAME,
		pci.insurance_premium_amount as PREMIUM_AMOUNT,
		pci.insured_amount as TOTAL_SUM_INSURED,
		pci.remark_1 as REMARKS,
		null as TOTAL_FINANCE_AMOUNT,
		null as TOTAL_PREMIUM_AMOUNT
	from ptrcollateral col
	inner join ptraccount_collateral_rel r on r.collateral_id=col.id
	inner join ptraccount a on a.id=r.account_id
	inner join ptrcustomer c on a.customer_id=c.id
	inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
	left join ptrhost_collateral_insurance pci on pci.collateral_id=col.id
	where col.id=#COLLATERAL_ID# AND a.id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getInsurancePGDetail" class="hmap">
		<result property="COLLATERAL_NAME_1" javaType="string" />
		<result property="COLLATERAL_CODE_1" javaType="string" />
		<result property="COLLATERAL_DESC_1" javaType="string" />
		<result property="GUARANTOR_CIF_NUMBER" javaType="long" />
	</resultMap>
	
	<select id="getInsurancePGDetail" resultMap="getInsurancePGDetail">
	select col.host_collateral_id,
	typeref.code,
	col.name,
	c.customer_id as GUARANTOR_CIF_NUMBER
	from ptrcollateral col
	inner join ptraccount_collateral_rel r on r.collateral_id=col.id
	inner join ptraccount a on a.id=r.account_id
	inner join ptrcustomer c on a.customer_id=c.id
	inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
	where col.id=#COLLATERAL_ID# AND a.id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPropertyInsuranceDetail" class="hmap">
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		<result property="CUSTOMER_NAME" javaType="string" />
		<result property="COLLATERAL_DESC" javaType="string" />
		<result property="INSURED_CIF_NUMBER" javaType="long" />
		<result property="INSURED_SHORT_NAME" javaType="string" />
		<result property="PREMIUM_AMOUNT" javaType="$" />
		<result property="TOTAL_SUM_INSURED" javaType="$" />
		<result property="REMARKS" javaType="string" />
		<result property="TOTAL_FINANCE_AMOUNT" javaType="$" />
		<result property="TOTAL_PREMIUM_AMOUNT" javaType="$" />
		<result property="COLLATERAL_NAME_1" javaType="string" />
		<result property="COLLATERAL_CODE_1" javaType="string" />
		<result property="COLLATERAL_DESCRIPTION_1" javaType="string" />
		<result property="GUARANTOR_CIF_NUMBER" javaType="long" />
	</resultMap>
	
	<select id="getPropertyInsuranceDetail" resultMap="getPropertyInsuranceDetail">
	select 
		col.host_collateral_id as COLLATERAL_NAME,
		typeref.code as COLLATERAL_CODE,
		c.customer_name as CUSTOMER_NAME,
		col.name as COLLATERAL_DESC,
		c.customer_no as INSURED_CIF_NUMBER,
		c.short_name as INSURED_SHORT_NAME,
		pci.insured_amount as PREMIUM_AMOUNT,
		pci.insured_amount as TOTAL_SUM_INSURED,
		pci.remark_1 as REMARKS,
		a.ORIGINAL_BALANCE as TOTAL_FINANCE_AMOUNT,
		pci.INSURANCE_PREMIUM_AMOUNT as TOTAL_PREMIUM_AMOUNT,
		col.host_collateral_id as COLLATERAL_NAME_1,
		typeref.code as COLLATERAL_CODE_1,
		col.name as COLLATERAL_DESC_1,
		c.CUSTOMER_NO as GUARANTOR_CIF_NUMBER
		from ptrcollateral col
		inner join ptraccount_collateral_rel r on r.collateral_id=col.id
		inner join ptraccount a on a.id=r.account_id
		inner join ptrcustomer c on a.customer_id=c.id
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		left join ptrhost_collateral_insurance pci on pci.collateral_id=col.id
		where col.id=#COLLATERAL_ID# AND a.id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPropertyFireInsuranceDetail" class="hmap">
		<result property="TAKAFUL_INSURANCE_COMPANY" javaType="string" />
		<result property="POLICY_NUMBER" javaType="string" />
		<result property="TYPE_OF_COVERAGE" javaType="string" />
		<result property="ISSUE_DATE" javaType="date" />
		<result property="EXPIRY_DATE" javaType="date" />
		<result property="CANCELLATION_DATE" javaType="date" />
	</resultMap>
	
	<select id="getPropertyFireInsuranceDetail" resultMap="getPropertyFireInsuranceDetail">
		SELECT 
		i.description as TAKAFUL_INSURANCE_COMPANY,
		pci.cover_note_no as POLICY_NUMBER,
		pci.remark_2 as TYPE_OF_COVERAGE,
		col.issue_date as ISSUE_DATE,
		col.title_expiry_date as EXPIRY_DATE,
		null as CANCELLATION_DATE
		from ptrcollateral col
		inner join ptraccount_collateral_rel r on r.collateral_id=col.id
		inner join ptraccount a on a.id=r.account_id
		inner join ptrcustomer c on a.customer_id=c.id
		inner join ptrcollateral_type_ref typeref on typeref.id=col.type_id
		left join ptrhost_collateral_insurance pci on pci.collateral_id=col.id
		left join ptrinsurance_company_ref i on i.id=pci.insurance_company_id
		where col.id=#COLLATERAL_ID# AND a.id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getParties" class="hmap">
		<result property="GTR_RELATIONSHIP" javaType="string" />
		<result property="PARTY_ID" javaType="long" />
		<result property="GTR_NAME" javaType="string" />
	</resultMap>
	
	<select id="getParties" resultMap="getParties">
	select tr.description,c.id,c.customer_name as GTR_NAME
	from ptrcustomer_account_rel r 
	inner join ptrcustomer_account_relation_type_ref tr on tr.id=r.type_id and tr.code !='P'
	inner join ptrcustomer c on r.customer_id=c.id
	where r.account_id=#ACCOUNT_ID#
	</select>
	
	<resultMap id="getPartiesDetail" class="hmap">
		<result property="CUSTOMER_NO" javaType="string" />
		<result property="GTR_NAME" javaType="string" />
		<result property="GTR_CREDIT_APPLICATION_NO" javaType="string" />
		<result property="GTR_ACCOUNT_RELATIONSHIP" javaType="string" />
		<result property="GTR_DESCRIPTION_OF_RELATIONSHIP" javaType="string" />
		<result property="GTR_PRIMARY_IC" javaType="string" />
		<result property="GTR_NATIONALITY" javaType="string" />
		<result property="ADDRESS_1" javaType="string" />
		<result property="ADDRESS_2" javaType="string" />
		<result property="ADDRESS_3" javaType="string" />
		<result property="ADDRESS_4" javaType="string" />
		<result property="ADDRESS_5" javaType="string" />
		<result property="POSTCODE" javaType="string" />
		<result property="CITY" javaType="string" />
		<result property="STATE" javaType="string" />
		<result property="COUNTRY" javaType="string" />
		<result property="GTR_SEQUENCE" javaType="string" />
		<result property="GTR_GENDER" javaType="string" />
	</resultMap>
	
	<select id="getPartiesDetail" resultMap="getPartiesDetail">
		select c.customer_no,c.customer_name as GTR_NAME,
		NULL as GTR_CREDIT_APPLICATION_NO,
		tr.description as GTR_ACCOUNT_RELATIONSHIP,
		NULL as GTR_DESCRIPTION_OF_RELATIONSHIP,
		c.customer_id_no,
		z.description,
		ad.line_1,ad.line_2,ad.line_3,ad.line_4,ad.line_5,ad.postal_code,ad.city,st.description,
		cr.description,
		h.sequence,g.description
		from ptrcustomer c
		inner join ptrhost_address ad on c.id=ad.customer_id
		inner join ptrhost_employment_history h on c.id=h.customer_id
		left join ptrcitizenship_ref z on c.citizenship_id=z.id
		left join ptrcountry_ref cr on ad.country_id=cr.id
		INNER JOIN PTRCUSTOMER_ACCOUNT_REL R ON R.CUSTOMER_ID=C.ID
		inner join ptrcustomer_account_relation_type_ref tr on tr.id=r.type_id and tr.code !='P'
		left join ptrgender_ref g on c.gender_id=g.id
		left join ptrstate_ref st on ad.state_id=st.id
		where c.id=#PARTY_ID#	
	</select>
	
	<resultMap id="getSecondaryIc" class="hmap">
		<result property="SECONDARY_IC" javaType="string" />
		<result property="IC_TYPE" javaType="string" />
	</resultMap>
	<select id="getSecondaryIc" resultMap="getSecondaryIc">
		select ci.customer_id_no, ictype.description
		from ptrcustomer c
		inner join PTRCUSTOMER_IDENTIFICATION_NO ci on ci.customer_id=c.id
		left join PTRCUSTOMER_ID_NO_TYPE_REF ictype on ci.CUSTOMER_ID_NO_TYPE_ID = ictype.id
		where c.id=#CUSTOMER_ID#	
	</select>
	
	
	<resultMap id="getPartiesSecondaryIc" class="hmap">

		<result property="SECONDARY_IC" javaType="string" />
		<result property="IC_TYPE" javaType="long" />

	</resultMap>
	<select id="getPartiesSecondaryIc" resultMap="getPartiesSecondaryIc">
		select ci.customer_id_no,ci.customer_id_no_type_id
		from ptrcustomer c
		inner join PTRCUSTOMER_IDENTIFICATION_NO ci on ci.customer_id=c.id
		where c.id=#PARTY_ID#	
	</select>
	
	<resultMap id="getPartiesEmploymentDetails" class="hmap">
		<result property="EMPLOYER_NAME" javaType="string" />
		<result property="OCCUPATION" javaType="long" />
		<result property="INCOME_BRACKET" javaType="long" />
		
	</resultMap>
	
	<select id="getPartiesEmploymentDetails" resultMap="getPartiesEmploymentDetails">
		select eh.employer_name,eh.occupation_id,pbr.code
		from ptrhost_employment_history eh
		inner join ptrcustomer c on eh.customer_id=c.id
		left join ptrincome_bracket_ref pbr on eh.income_bracket_id=pbr.id
		where c.id=#PARTY_ID#
	</select>
	
	<resultMap id="getPartiesContactDetails" class="hmap">
		<result property="GTR_CONTACT_TYPE" javaType="string" />
		<result property="GTR_CONTACT_NUMBER" javaType="string" />
		
	</resultMap>
	
	<select id="getPartiesContactDetails" resultMap="getPartiesContactDetails">
		select 
		   pntr.code ||' - '|| pntr.description as GTR_CONTACT_TYPE,
		   pn.no as GTR_CONTACT_NUMBER
		   from ptrcustomer c
		   left join ptrhost_phone_no pn on pn.customer_id=c.id
		   left join ptrhost_phone_no_type_ref pntr on pntr.id=pn.host_phone_no_type_id
		   where c.id=#PARTY_ID#
	</select>
	
	<resultMap class="hmap" id="getCustomerCorrespondenceAddress">
	<result property="LINE_1" javaType="string"/>
	<result property="LINE_2" javaType="string"/>
	<result property="LINE_3" javaType="string"/>
	<result property="LINE_4" javaType="string"/>
	<result property="LINE_5" javaType="string"/>
	<result property="CITY" javaType="string"/>
	<result property="POSTCODE" javaType="string"/>
	<result property="STATE" javaType="string"/>
	<result property="COUNTRY" javaType="string"/>
	<result property="SEQUENCE" javaType="long"/>
	</resultMap>
	
	<select id="getCustomerCorrespondenceAddress" resultMap="getCustomerCorrespondenceAddress">
	select
	ha.line_1 as LINE_1,
	ha.line_2 as LINE_2,
	ha.line_3 as LINE_3,
	ha.line_4 as LINE_4,
	ha.line_5 as LINE_5,
	ha.city as CITY,
	ha.postal_code as POSTCODE,
	st.description as STATE,
	ct.description as COUNTRY,
	ha.sequence as SEQUENCE
	from ptrhost_address ha
	inner join ptrhost_address_type_ref ty on ty.id=ha.host_address_type_id
	left join ptrstate_ref st on st.id=ha.state_id
	left join ptrcountry_ref ct on ct.id=ha.country_id
	where ha.customer_id=#CUSTOMER_ID# and ty.code='M'
	</select>

	<resultMap class="hmap" id="getGenericCustomerLetterData">
		<result property="CUSTOMER_NAME" javaType="string"/>
		<result property="ACCOUNT_NO" javaType="string"/>
	</resultMap>
	<select id="getGenericCustomerLetterData" resultMap="getGenericCustomerLetterData">
		select
			   ptrcustomer.customer_name as CUSTOMER_NAME,
			   ptraccount.account_no as ACCOUNT_NO
		from ptrcustomer inner join ptraccount on ptraccount.customer_id = ptrcustomer.id
		where ptrcustomer.id=#CUSTOMER_ID#
	</select>
	
	<resultMap class="hmap" id="getCustomerEmploymentDetailsPC">
	<result property="PC_EMPLOYER_CATEGORY" javaType="string"/>
	<result property="PC_EMPLOYER_CODE" javaType="string"/>
	<result property="PC_EMPLOYER_NAME" javaType="string"/>
	<result property="PC_EMPLOYMENT_STATUS" javaType="string"/>
	<result property="PC_REMARKS" javaType="string"/>
	</resultMap>


	
	<select id="getCustomerEmploymentDetailsPC" resultMap="getCustomerEmploymentDetailsPC">
	select 
emc.description as PC_EMPLOYER_CATEGORY,
em.code as PC_EMPLOYER_CODE,
gr.description as PC_EMPLOYER_NAME,
ems.description as PC_EMPLOYMENT_STATUS,
ce.note_text as PC_REMARKS
from ptrcustomer_employment_maintenance ce
left join ptremployer_ref em on em.id=ce.employer_id
left join ptremployer_group_ref gr on gr.id=em.group_id
left join ptremployer_category_ref emc on emc.id=ce.employer_category_id
left join ptremployment_status_ref ems on ems.id=ce.employment_status_id
where ce.CUSTOMER_ID=#CUSTOMER_ID#
</select>

<resultMap class="hmap" id="getCamFinanceInquiry">
	<result property="PROFIT_RATE" javaType="$"/>
	<result property="GPP_REBATE_MTD" javaType="string"/>
	<result property="GPP_CAL_MTD" javaType="string"/>
	<result property="GRACE_TERM_CODE" javaType="string"/>
	<result property="GPP_PAYMENT_CODE" javaType="string"/>
	<result property="IBS_DUAL_MODE" javaType="string"/>
	<result property="FULL_REL_COMPUTATION_MTD" javaType="string"/>
	<result property="FULL_REL_PROFIT_REBATE_MTD" javaType="string"/>
	<result property="SNP_AGREEMENT_DATE" javaType="DATE"/>
	<result property="SNP_TERM_CODE" javaType="string"/>
	<result property="GPP_DURATION_FROM_SNP_DATE" javaType="string"/>
	<result property="BILLED_PROFIT" javaType="$"/>
	<result property="CURR_PROFIT" javaType="$"/>
	<result property="CURR_PROFIT_OS" javaType="$"/>
	<result property="OVERDUE_PROFIT" javaType="$"/>
	<result property="CURR_YEAR_PROFIT" javaType="$"/>
	<result property="PROFIT_PAID_YTD" javaType="$"/>
	<result property="PFT_PAID_FTD" javaType="$"/>
	<result property="DATE_STOP_COMPOUND" javaType="DATE"/>
	<result property="GRACE_EXPIRY_DATE" javaType="DATE"/>
	<result property="LAST_MAINT_DATE" javaType="DATE"/>
	<result property="SEC_DEPOSIT_AMOUNT" javaType="$"/>
	<result property="FIXED_REBATE_AMOUNT" javaType="$"/>
	<result property="FIXED_COMMISION_AMOUNT" javaType="$"/>
	<result property="COMMISION_FEE" javaType="$"/>
	<result property="GPP_REBATE" javaType="$"/>
	<result property="BILLED_REBATE" javaType="$"/>
	<result property="CURR_REBATE" javaType="$"/>
	<result property="OVERDUE_REBATE" javaType="$"/>
	<result property="COMM_REBATE" javaType="$"/>
	<result property="BILLED_COMMISSION" javaType="$"/>
	<result property="CURR_COMMISION" javaType="$"/>
	<result property="OVERDUE_COMM" javaType="$"/>
	<result property="COMMISSION_EXPIRY_DATE" javaType="DATE"/>
	<result property="SELLING_PRICE" javaType="$"/>
	<result property="TOTAL_GPP_AMT" javaType="$"/>
	<result property="PDPA" javaType="string"/>

	</resultMap>
	
	<select id="getCamFinanceInquiry" resultMap="getCamFinanceInquiry">
	SELECT 
	case when det.INTEREST_RATE * 100 &lt; 10 then det.INTEREST_RATE * 100  
	when det.INTEREST_RATE * 100 &lt; 100 then det.INTEREST_RATE * 100 
	else det.INTEREST_RATE * 100 end as PROFIT_RATE,
	gpp.description as GPP_REBATE_MTD,
    cal.description as GPP_CAL_MTD,
    loan.sptf_term ||'/'|| loan.sptf_term_code as GRACE_TERM_CODE,
    pmt.description as GPP_PAYMENT_CODE,
    sptf.description as IBS_DUAL_MODE,
    fulrel.description as FULL_REL_COMPUTATION_MTD,
    fulpro.description as FULL_REL_PROFIT_REBATE_MTD,
    det.snp_agreement_date as SNP_AGREEMENT_DATE,
    det.snp_term||'/'|| det.snp_term_code_flag as SNP_TERM_CODE,
    det.gpp_duration_flag as GPP_DURATION_FROM_SNP_DATE,
    det.billed_profit_amount as BILLED_PROFIT,
    det.sptf_current_month_profit_amount as CURR_PROFIT,
    det.sptf_profit_outstanding_amount as CURR_PROFIT_OS,
    det.sptf_profit_overdue_amount as OVERDUE_PROFIT,
    det.sptf_current_year_profit_amount as CURR_YEAR_PROFIT,
    det.sptf_profit_paid_ytd_amount as PROFIT_PAID_YTD,
    det.sptf_profit_paid_ltd_amount as PFT_PAID_FTD,
    det.compounding_stop_date as DATE_STOP_COMPOUND,
    det.sptf_grace_expiry_date as GRACE_EXPIRY_DATE,
    det.sptf_last_maintainance_date as LAST_MAINT_DATE,
    det.security_deposit_amount as SEC_DEPOSIT_AMOUNT,
    det.fixed_refund_amount as FIXED_REBATE_AMOUNT,
    det.fixed_comission_amount as FIXED_COMMISION_AMOUNT,
    det.comission_fee_amount as COMMISION_FEE,
    det.gpp_refund_amount as GPP_REBATE,
    det.billed_refund_amount as BILLED_REBATE,
    det.current_refund_amount as CURR_REBATE,
    det.overdue_refund_amount as OVERDUE_REBATE,
    det.comission_rebate_amount as COMM_REBATE,
    det.billed_comission_amount as BILLED_COMMISSION,
    det.current_comission_amount as CURR_COMMISION,
    det.overdue_comission_amount as OVERDUE_COMM,
    det.comission_expiry_date as COMMISSION_EXPIRY_DATE,
    det.sptf_selling_price_amount as SELLING_PRICE,
    det.sptf_grace_period_profit_amount as TOTAL_GPP_AMT,
    a.loan_term|| ' / ' || extract(year from age(a.NEXT_SCHEDULED_PAYMENT_DATE, a.first_payment_date))*12 + extract(month from age(a.NEXT_SCHEDULED_PAYMENT_DATE, a.first_payment_date))  ||' / '||
        a.INSTALLMENT_PAID_COUNT ||' / '|| extract(year from age(a.NEXT_SCHEDULED_PAYMENT_DATE, a.NEXT_PAYMENT_DUE_DATE))*12 + extract(month from age(a.NEXT_SCHEDULED_PAYMENT_DATE, a.NEXT_PAYMENT_DUE_DATE)) 
        as PDPA
	from ptraccount a 
	left join PTRACCOUNT_ISLAMIC_DET det on a.id=det.account_id
	left join ptraccount_loan_application_rel app on a.id=app.account_id
    left join ptrloan_application loan on app.loan_application_id=loan.id
    left join ptrsptf_pmt_code_ref sptf on det.sptf_dual_repayment_id=sptf.id
    left join ptrrefund_gpp_profit_ref gpp on loan.refund_gpp_profit_id=gpp.id
    left join ptrgpp_calculation_method_ref cal on loan.gpp_calculation_method_id=cal.id
    left join ptrsptf_pmt_code_ref pmt on loan.sptf_pmt_code_id=pmt.id
    left join ptrfulrel_profit_cal_method_ref fulrel on loan.fulrel_profit_cal_method_id=fulrel.id
    left join ptrrefund_fulrel_profit_ref fulpro on loan.refund_fulrel_profit_id=fulpro.id
	where a.id=#ACCOUNT_ID#
</select>

<resultMap class="hmap" id="getCustomerSummaryAgencyDetails">
<result property="ASSIGNMENT_TYPE" javaType="string"/>
<result property="AGENCY_NAME" javaType="string"/>
<result property="ABORT_DATE" javaType="date"/>
<result property="LIASON_NAME" javaType="string"/>
</resultMap>

<select id="getCustomerSummaryAgencyDetails" resultMap="getCustomerSummaryAgencyDetails">
select sb.description, ag.description, ass.expected_end_date, ag.bank_coordinator
from ptraccount_agency_assignment ass
inner join ptragency ag on ag.id=ass.agency_id
inner join ptrtreatment_subtype_ref sb on sb.id=ass.subtype_id
where ass.status_id=15007
and ass.account_id=#ACCOUNT_ID#
</select>
	
	<resultMap class="hmap" id="getCustomerSummaryLegalStatus">
	<result property="DATE_ISSUE" javaType="date"/>
	<result property="LEGAL_STATUS" javaType="string"/>
	</resultMap>
	
	<select id="getCustomerSummaryLegalStatus" resultMap="getCustomerSummaryLegalStatus">
	select ap.created_time, sr.description from ptrlegal_action_instruction ai
inner join ptrlegal_action_process ap on ap.id=ai.process_id
inner join ptraccount_agency_assignment ass on ass.id=ai.agency_assignment_id
inner join ptraccount a on a.id=ass.account_id
inner join ptrtreatment_status_ref sr on sr.id=ap.status_id
where a.id=#ACCOUNT_ID#
order by ap.created_time desc
	</select>
	
</sqlMap>