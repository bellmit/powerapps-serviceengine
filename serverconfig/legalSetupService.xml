<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="legalSetupService">
<!-- stage -->
	<resultMap id="getSubtypeForSetup" class="hmap" extends="global.ref">	
		<result property="PROCESS_TYPE_ID" javaType="long" />
	</resultMap>
	<select id="getSubtypeForSetup" resultMap="getSubtypeForSetup">
		<include refid="refselect" /> ,type_id
		from ptrtreatment_subtype_ref
		where type_id in (50,51,52)
	</select>

	<select id="getEcaSubtypeForSetup" resultMap="getSubtypeForSetup">
		<include refid="refselect" /> ,type_id
		from ptrtreatment_subtype_ref
		where type_id =19
	</select>
		
	<resultMap id="getStageList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TAT" javaType="long" />
		<result property="REMARKS" javaType="string" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
	</resultMap>
	<select id="getStageList" resultMap="getStageList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.TAT,R.REMARKS,
		R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY 
		FROM PTRLEGAL_STAGE_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# and R.TYPE_ID=#TYPE_ID#
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 
		order by r.sort_priority asc	
	</select>
	<resultMap id="getStageForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TAT" javaType="long" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getStageForEditing" resultMap="getStageForEditing">
		SELECT CODE,DESCRIPTION,TAT,DISABLE
		FROM PTRLEGAL_STAGE_REF
		WHERE ID = #STAGE_ID#	
	</select>
	<insert id="insertStageRef">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_STAGE_REF_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_STAGE_REF(ID,CODE,DESCRIPTION,SUBTYPE_ID,TYPE_ID,TAT,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#TYPE_ID#,#TAT#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	<update id="updateStageRef">
		UPDATE PTRLEGAL_STAGE_REF SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		TAT =#TAT#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#STAGE_ID#
	</update>
	<update id="updateStageRefPriority">
		UPDATE PTRLEGAL_STAGE_REF SET
		SORT_PRIORITY = #SORT_PRIORITY#
		WHERE ID=#ID#
	</update>
<!-- additional details -->	
	<resultMap id="getAdditionalDetailList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TYPE" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
	</resultMap>
	<select id="getAdditionalDetailList" resultMap="getAdditionalDetailList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,TR.DESCRIPTION,R.REMARKS,
		R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY 
		FROM PTRLEGAL_ADDITIONAL_DETAIL_REF R
		INNER JOIN PTRADDITIONAL_DETAIL_TYPE_REF TR ON TR.ID=R.TYPE_ID
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID#
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
	</select>
	
	<select id="getAdditionalDetailTypes" resultMap="global.ref">
		<include refid="pleaseSelectRef"/> <include refid="fromdual"/>
		union
		<include refid="refselect" /> 
		from PTRADDITIONAL_DETAIL_TYPE_REF
	</select>	
	<resultMap id="getAdditionalDetailForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TYPE_ID" javaType="long" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getAdditionalDetailForEditing" resultMap="getAdditionalDetailForEditing">
		SELECT CODE,DESCRIPTION,TYPE_ID,DISABLE
		FROM PTRLEGAL_ADDITIONAL_DETAIL_REF
		WHERE ID = #DETAIL_ID#	
	</select>
	<insert id="insertAdditionalDetailRef">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_ADDITIONAL_DETAIL_REF_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_ADDITIONAL_DETAIL_REF(ID,CODE,DESCRIPTION,SUBTYPE_ID,TYPE_ID,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#TYPE_ID#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	<update id="updateAdditionalDetailRef">
		UPDATE PTRLEGAL_ADDITIONAL_DETAIL_REF SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		TYPE_ID =#TYPE_ID#,
		TAT = #TAT#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#DETAIL_ID#
	</update>
	<update id="updateAdditionalDetailRefPriority">
		UPDATE PTRLEGAL_ADDITIONAL_DETAIL_REF SET
		SORT_PRIORITY = #SORT_PRIORITY#
		WHERE ID=#ID#
	</update>	
<!-- instructions -->	

	<resultMap id="getInstructionList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="TAT_PERIOD" javaType="long" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
		<result property="REMEDIAL_INITIATION" javaType="boolean" />
		<result property="HOST_CCRIS_STATUS" javaType="string" />
		<result property="SST" javaType="boolean" />
	</resultMap>
	<select id="getInstructionList" resultMap="getInstructionList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,
		R.TAT_PERIOD,R.VISUAL_ACTION,R.DISABLE,R.CREATED_TIME,
		R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY,R.REMEDIAL_INITIATION,
		CCRIS.CODE||' - '||CCRIS.DESCRIPTION AS HOST_CCRIS_STATUS,R.SST
		FROM PTRLEGAL_ACTION_REF R
		LEFT JOIN PTRHOST_CCRIS_STATUS_REF CCRIS ON CCRIS.ID=R.HOST_CCRIS_STATUS_ID
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# and R.TYPE_ID=1
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 
		order by r.sort_priority asc	
	</select>
	<update id="updateActionRefPriority">
		UPDATE PTRLEGAL_ACTION_REF SET
		SORT_PRIORITY = #SORT_PRIORITY#
		WHERE ID=#ID#
	</update>
	
	<resultMap id="getAllAdditionalDetails" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TYPE" javaType="string" />
	</resultMap>
	<select id="getAllAdditionalDetails" resultMap="getAllAdditionalDetails">
		SELECT r.id,r.code,r.description,t.description
		from ptrlegal_additional_detail_ref r
		inner join ptradditional_detail_type_ref t on t.id=r.type_id
		where r.disable = <include refid="false"/> and r.subtype_id=#SUBTYPE_ID#
	</select>
	<select id="getAssignedAdditionalDetails" resultMap="getAllAdditionalDetails">
		SELECT r.id,r.code,r.description,t.description
		from ptrlegal_additional_detail_ref r
		inner join ptradditional_detail_type_ref t on t.id=r.type_id
		INNER JOIN PTRLEGAL_ACTION_DETAIL_REL AR on AR.ADDITIONAL_DETAIL_ID=R.ID and AR.ACTION_ID = #ACTION_ID#
		where r.disable = <include refid="false"/>
	</select>		
	<insert id="insertInstructionRef">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_ACTION_REF_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_ACTION_REF(ID,CODE,DESCRIPTION,SUBTYPE_ID,TYPE_ID,REMARKS,
		SORT_PRIORITY,CREATED_TIME,CREATED_BY,TAT_PERIOD,CONTRACT,VISUAL_ACTION,HOST_CCRIS_STATUS_ID,SST)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#TYPE_ID#,#REMARKS#,
		#ID#,#CURRENT_TIME#,#LOGON_USER#,#TAT_PERIOD#,#CONTRACT#,#VISUAL_ACTION#,#HOST_CCRIS_STATUS_ID#,#SST#)	
	</insert>
	<update id="updateInstructionRef">
		UPDATE PTRLEGAL_ACTION_REF SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		VISUAL_ACTION = #VISUAL_ACTION#,
		TAT_PERIOD=#TAT_PERIOD#,
		CONTRACT = #CONTRACT#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#,
		HOST_CCRIS_STATUS_ID = #HOST_CCRIS_STATUS_ID#,
		SST = #SST#
		WHERE ID=#ACTION_ID#
	</update>
	<delete id="deleteActionDetailRel">
		delete from PTRLEGAL_ACTION_DETAIL_REL WHERE ACTION_ID=#ACTION_ID#
	</delete>
	<insert id="insertActionDetailRel">
		INSERT INTO PTRLEGAL_ACTION_DETAIL_REL(ACTION_ID,ADDITIONAL_DETAIL_ID)
		VALUES(#ACTION_ID#,#ID#)
	</insert>
	
	<resultMap id="getInstructionForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="TAT_PERIOD" javaType="long" />
		<result property="DISABLE" javaType="boolean" />
		<result property="CONTRACT" javaType="boolean" />
		<result property="HOST_CCRIS_STATUS_ID" javaType="long" />
		<result property="SST" javaType="boolean" />
	</resultMap>
	<select id="getInstructionForEditing" resultMap="getInstructionForEditing">
		SELECT CODE,DESCRIPTION,VISUAL_ACTION,TAT_PERIOD,DISABLE,CONTRACT,HOST_CCRIS_STATUS_ID,SST
		FROM PTRLEGAL_ACTION_REF
		WHERE ID = #ACTION_ID#	
	</select>

<!-- special action -->	
	<resultMap id="getSpecialActionList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
		<result property="REMEDIAL_INITIATION" javaType="boolean" />
	</resultMap>

	<select id="getSpecialActionList" resultMap="getSpecialActionList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,
		R.VISUAL_ACTION,R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY ,R.REMEDIAL_INITIATION
		FROM PTRLEGAL_ACTION_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# and R.TYPE_ID=3
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
		order by r.sort_priority asc
	</select>
<!-- remedial -->
	<select id="getRemedialActionList" resultMap="getSpecialActionList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,
		R.VISUAL_ACTION,R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY ,R.REMEDIAL_INITIATION
		FROM PTRLEGAL_ACTION_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# and R.TYPE_ID=4
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
		order by r.sort_priority asc
	</select>	
<!-- follow up -->
	<resultMap id="getFollowUpActionList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
		<result property="REMEDIAL_INITIATION" javaType="boolean" />
	</resultMap>
	<select id="getFollowUpActionList" resultMap="getFollowUpActionList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,
		R.VISUAL_ACTION,R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY ,R.REMEDIAL_INITIATION
		FROM PTRLEGAL_ACTION_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# and R.TYPE_ID=5
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
		order by r.sort_priority asc
	</select>
	
<!-- actions -->	
	<resultMap id="getActionList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="CONTRACT" javaType="boolean" />
		<result property="DISBURSEMENT" javaType="boolean" />
		<result property="EXPENSE" javaType="boolean" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
		<result property="INSTRUCTION" javaType="string" />
		<result property="CATEGORY" javaType="string" />
		<result property="HOST_CCRIS_STATUS" javaType="string" />
		<result property="SST" javaType="boolean" />
	</resultMap>
	<select id="getActionList" resultMap="getActionList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,
		R.VISUAL_ACTION,R.CONTRACT,R.DISBURSEMENT,R.EXPENSE,R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY,
		I.DESCRIPTION AS INSTRUCTION,C.DESCRIPTION,CCRIS.CODE||' - '||CCRIS.DESCRIPTION AS HOST_CCRIS_STATUS,R.SST
		FROM PTRLEGAL_ACTION_REF R
<!-- 		LEFT JOIN PTRLEGAL_STAGE_REF S ON S.ID=R.STAGE_ID -->
<!-- 		LEFT JOIN PTRLEGAL_STAGE_REF B ON B.ID=R.BILLING_STAGE_ID -->
		LEFT JOIN PTRLEGAL_ACTION_REF I ON I.ID=R.INSTRUCTION_ID
		LEFT JOIN PTRACTION_CATEGORY_REF C ON C.ID=R.CATEGORY_ID
		LEFT JOIN PTRHOST_CCRIS_STATUS_REF CCRIS ON CCRIS.ID=R.HOST_CCRIS_STATUS_ID
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# <isNull property="DETAIL_ID">and R.TYPE_ID=2</isNull>
		<isNotEqual property="SHOW_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
<!-- 		<isNotNull property="STAGE_ID"> -->
<!-- 			<isEqual property="TYPE_ID" compareValue="1"> -->
<!-- 			AND R.STAGE_ID=#STAGE_ID# -->
<!-- 			</isEqual> -->
<!-- 			<isEqual property="TYPE_ID" compareValue="2"> -->
<!-- 			AND R.BILLING_STAGE_ID=#STAGE_ID# -->
<!-- 			</isEqual> -->
<!-- 		</isNotNull> -->
		<isNotNull property="ACTION_ID">
			AND R.INSTRUCTION_ID = #ACTION_ID#
		</isNotNull>
		<isNotNull property="DETAIL_ID">
		and R.ID in(select ACTION_ID from PTRLEGAL_ACTION_DETAIL_REL WHERE ADDITIONAL_DETAIL_ID = #DETAIL_ID#)
		</isNotNull>
		order by r.sort_priority asc
	</select>
	<resultMap id="getActionExpenses" class="hmap">
		<result property="ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="LIMIT_AMOUNT" javaType="$" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getActionExpenses" resultMap="getActionExpenses">
		select action_id,description,limit_amount,disable from PTRACTION_EXPENSES_REF
		where action_id in(<iterate property="IDS" conjunction=",">#IDS[]#</iterate>)
	</select>	
	<select id="getParentInstructions" resultMap="global.ref">
		<include refid="pleaseSelectRef"/> <include refid="fromdual"/>
		union
		<include refid="refselect" /> 
		from PTRLEGAL_ACTION_REF WHERE  SUBTYPE_ID = #SUBTYPE_ID# and TYPE_ID=1
	</select>
	<select id="getActionStages" resultMap="global.ref">
		<include refid="pleaseSelectRef"/> <include refid="fromdual"/>
		union
		<include refid="refselect" /> 
		from PTRLEGAL_STAGE_REF WHERE  SUBTYPE_ID = #SUBTYPE_ID# and TYPE_ID =1
	</select>
	<select id="getActionBillingStages" resultMap="global.ref">
		<include refid="pleaseSelectRef"/> <include refid="fromdual"/>
		union
		<include refid="refselect" /> 
		from PTRLEGAL_STAGE_REF WHERE  SUBTYPE_ID = #SUBTYPE_ID# and TYPE_ID =2
	</select>
	<select id="getActionCategory" resultMap="global.ref">
		<include refid="pleaseSelectRef"/> <include refid="fromdual"/>
		union
		<include refid="refselect" /> 
		from PTRACTION_CATEGORY_REF
	</select>	
	<resultMap id="getActionForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="VISUAL_ACTION" javaType="boolean" />
		<result property="TAT" javaType="boolean" />
		<result property="DISABLE" javaType="boolean" />
		<result property="INSTRUCTION_ID" javaType="long" />
		<result property="STAGE_ID" javaType="long" />
		<result property="BILLING_STAGE_ID" javaType="long" />
		<result property="CONTRACT" javaType="boolean" />
		<result property="DISBURSEMENT" javaType="boolean" />
		<result property="EXPENSE" javaType="boolean" />
		<result property="INTERNAL_ACTION" javaType="boolean" />
		<result property="CATEGORY_ID" javaType="long" />
		<result property="BILLING_MILESTONE" javaType="boolean" />
		<result property="HOST_CCRIS_STATUS_ID" javaType="long" />
		<result property="SST" javaType="boolean" />
	</resultMap>
	
	<select id="getActionForEditing" resultMap="getActionForEditing">
		SELECT CODE,DESCRIPTION,VISUAL_ACTION,TAT,DISABLE,INSTRUCTION_ID,STAGE_ID,
		BILLING_STAGE_ID,CONTRACT,DISBURSEMENT,EXPENSE,INTERNAL_ACTION,CATEGORY_ID,
		BILLING_MILESTONE,HOST_CCRIS_STATUS_ID,SST
		FROM PTRLEGAL_ACTION_REF
		WHERE ID = #ACTION_ID#	
	</select>
	
	<insert id="insertActionRef">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_ACTION_REF_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_ACTION_REF(ID,CODE,DESCRIPTION,SUBTYPE_ID,TYPE_ID,REMARKS,SORT_PRIORITY,
		CREATED_TIME,CREATED_BY,TAT,VISUAL_ACTION,CONTRACT,INSTRUCTION_ID,STAGE_ID,BILLING_STAGE_ID,
		DISBURSEMENT,EXPENSE,INTERNAL_ACTION,CATEGORY_ID,BILLING_MILESTONE,HOST_CCRIS_STATUS_ID,SST)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#TYPE_ID#,#REMARKS#,#ID#,
		#CURRENT_TIME#,#LOGON_USER#,#TAT#,#VISUAL_ACTION#,#CONTRACT#,#INSTRUCTION_ID#,#STAGE_ID#,#BILLING_STAGE_ID#,
		#DISBURSEMENT#,#EXPENSE#,#INTERNAL_ACTION#,#CATEGORY_ID#,#BILLING_MILESTONE#,#HOST_CCRIS_STATUS_ID#,#SST#)	
	</insert>
	
	<update id="updateActionRef">
		UPDATE PTRLEGAL_ACTION_REF SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		VISUAL_ACTION = #VISUAL_ACTION#,
		CONTRACT = #CONTRACT#,
		DISBURSEMENT = #DISBURSEMENT#,
		EXPENSE = #EXPENSE#,
		TAT=#TAT#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#,
		INSTRUCTION_ID = #INSTRUCTION_ID#,
		STAGE_ID = #STAGE_ID#,
		BILLING_STAGE_ID = #BILLING_STAGE_ID#,
		INTERNAL_ACTION = #INTERNAL_ACTION#,
		CATEGORY_ID=#CATEGORY_ID#,
		BILLING_MILESTONE = #BILLING_MILESTONE#,
		HOST_CCRIS_STATUS_ID = #HOST_CCRIS_STATUS_ID#,
		SST = #SST#
		WHERE ID=#ACTION_ID#
	</update>
<!-- abort evaluation -->	
	
	<update id="setAbortTreesIsBatchToFalseBySubtype">
	update PTRLEGAL_ABORT_TREE set is_batch = <include refid="false"/>
	where subtype_id = #SUBTYPE_ID# <isNotNull property="PRODUCT_CATEGORY_ID">and PRODUCT_CATEGORY_ID=#PRODUCT_CATEGORY_ID#</isNotNull>
	</update>
	
	
	<resultMap class="hmap" id="getLegalAbortEvaluationTree" extends="global.ref">
		<result property="IS_BATCH" javaType="boolean"/>
	</resultMap>
	<select id="getLegalAbortEvaluationTree" resultMap="getLegalAbortEvaluationTree">
		<include refid="refselect" />,is_batch 
		FROM PTRLEGAL_ABORT_TREE
		WHERE SUBTYPE_ID =#SUBTYPE_ID# 
		<isNotNull property="PRODUCT_CATEGORY_ID">and PRODUCT_CATEGORY_ID=#PRODUCT_CATEGORY_ID#</isNotNull> 
		AND DISABLE = <include refid="false"/>
		order by id desc
	</select>
	<resultMap id="getAbortTreeForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="SUBTYPE_ID" javaType="long" />
		<result property="PRODUCT_CATEGORY_ID" javaType="long" />
		<result property="IS_BATCH" javaType="boolean" />
		<result property="SEND_VERIFICATION" javaType="boolean" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getAbortTreeForEditing" resultMap="getAbortTreeForEditing">
		SELECT CODE,DESCRIPTION,SUBTYPE_ID,PRODUCT_CATEGORY_ID,IS_BATCH,SEND_VERIFICATION,DISABLE
		FROM PTRLEGAL_ABORT_TREE
		WHERE ID = #ID#	
	</select>
	
	<update id="updateAbortEvaluationTree">
		UPDATE PTRLEGAL_ABORT_TREE SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		SUBTYPE_ID =#SUBTYPE_ID#,
		PRODUCT_CATEGORY_ID = #PRODUCT_CATEGORY_ID#,
		IS_BATCH = #IS_BATCH#,
		SEND_VERIFICATION = #SEND_VERIFICATION#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#ID#	
	</update>

	<insert id="insertAbortEvaluationTree">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_ABORT_TREE_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_ABORT_TREE(ID,CODE,DESCRIPTION,IS_BATCH,SEND_VERIFICATION,SUBTYPE_ID,PRODUCT_CATEGORY_ID,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#IS_BATCH#,#SEND_VERIFICATION#,#SUBTYPE_ID#,#PRODUCT_CATEGORY_ID#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>	
	
	<resultMap id="getAbortEvaluationTreeDocumentId" class="hmap">
		<result property="DOCUMENT_ID" javaType="long" />
	</resultMap>
	<select id="getAbortEvaluationTreeDocumentId" resultMap="getAbortEvaluationTreeDocumentId">
		SELECT DOCUMENT_ID FROM PTRLEGAL_ABORT_TREE WHERE ID=#ID#	
	</select>

<!-- 	<sql id="agingCondition">
		select 'MONTH_IN_ARREARS','NUMERIC','Aging(MIA)','0',0,<include refid="false"/> <include refid="fromdual"/>
	</sql>
	<sql id="outstandingAmountCondition">
		select 'OUTSTANDING_AMOUNT','NUMERIC','Outstanding Amount','0',0,<include refid="false"/> <include refid="fromdual"/>
	</sql>	
		
	<resultMap id="getLegalTreeCondition" class="hmap">
		<result property="FIELD_NAME" javaType="string" />
		<result property="FIELD_TYPE" javaType="string" />
		<result property="FIELD_DESCRIPTION" javaType="string" />
		<result property="DISCRETE_VALUE_DESCRIPTION" javaType="string" />
		<result property="DISCRETE_VALUE_ID" javaType="long" />
		<result property="DISCRETE_VALUE_DISABLED" javaType="boolean" />
	</resultMap>
	<select id="getLegalTreeCondition" resultMap="getLegalTreeCondition">
		<include refid="agingCondition"/> union
		<include refid="outstandingAmountCondition"/>
	</select>-->
	
	<select id="getAbortEvaluationTreeBuckets" resultMap="global.ref">
		<include refid="refselect" /> 
		FROM PTRLEGAL_ABORT_REASON_REF WHERE SUBTYPE_ID=#SUBTYPE_ID# 
	</select>	 
	
	<update id="updateAbortEvaluationTreeContent">
		UPDATE PTRLEGAL_ABORT_TREE SET DOCUMENT_ID = #DOCUMENT_ID#, 
		REMARKS = #REMARKS#, UPDATED_BY = #LOGON_USER#, UPDATED_TIME =#CURRENT_TIME#
		WHERE ID =#ID#
	</update>
	<select id="getECAExclusionEvaluationTreeBuckets" resultMap="global.ref">
		<include refid="refselect" /> 
		FROM PTRAGENCY_EXLUSION_REASON_REF
	</select>	
<!-- contracts -->	
	<resultMap id="getContractList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="DISABLED" javaType="boolean" />
		<result property="REMARKS" javaType="string" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
		<result property="TOTAL_ACCOUNTS" javaType="long" />
	</resultMap>
	<select id="getContractList" resultMap="getContractList">
		SELECT R.ID,
		R.CODE,
		R.DESCRIPTION,
		R.DISABLE,
		R.REMARKS,
		R.CREATED_TIME,
		R.UPDATED_TIME,
		R.CREATED_BY,
		R.UPDATED_BY,
		count(*) as TOTAL_ACCOUNTS
		FROM PTRAGENCY_CONTRACT R
		left join ptraccount_agency_assignment assign
		on r.id = assign.contract_id
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID#
		<isNotEqual property="SHOW_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual>
		group by R.ID,
		R.CODE,
		R.DESCRIPTION,
		R.DISABLE,
		R.REMARKS,
		R.CREATED_TIME,
		R.UPDATED_TIME,
		R.CREATED_BY,
		R.UPDATED_BY
		ORDER BY R.SORT_PRIORITY
	</select>
	<update id="updateContractPriority">
		UPDATE PTRAGENCY_CONTRACT SET
		SORT_PRIORITY = #SORT_PRIORITY#
		WHERE ID=#ID#
	</update>
	
	<resultMap id="getContractForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="DISABLE" javaType="boolean" />
		<result property="DEFAULT" javaType="boolean" />
	</resultMap>
	<select id="getContractForEditing" resultMap="getContractForEditing">
		SELECT CODE,DESCRIPTION,DISABLE,IS_DEFAULT FROM PTRAGENCY_CONTRACT
		WHERE ID=#CONTRACT_ID#	
	</select>
	
	<select id="getAllContractTags" resultMap="global.ref">
		<include refid="refselect" /> 
		FROM ptrcontract_tag_ref 
		<isEqual property="PROCESS_TYPE_ID" compareValue="19">
		WHERE MODULE='ECA'
		</isEqual>
		<isNotEqual property="PROCESS_TYPE_ID" compareValue="19">
		WHERE MODULE='LEGAL'
		</isNotEqual>
	</select>	
	<select id="getContractTags" resultMap="global.ref">
		select t.id,t.code,t.description,t.disable,t.sort_priority 
		from ptrcontract_tag_rel r
		inner join ptrcontract_tag_ref t on t.id=r.tag_id
		where r.contract_id=#CONTRACT_ID#
	</select>
	<delete id="clearContractTags">
		delete from ptrcontract_tag_rel where contract_id=#CONTRACT_ID#
	</delete>
	<insert id="insertContractTags">
		insert into ptrcontract_tag_rel(contract_id,tag_id)
		values(#CONTRACT_ID#,#ID#)
	</insert>
	<insert id="insertContract">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRAGENCY_CONTRACT_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRAGENCY_CONTRACT(ID,CODE,DESCRIPTION,SUBTYPE_ID,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY,IS_DEFAULT)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#,COALESCE(#DEFAULT#,false))	
	</insert>
	<update id="updateContract">
		UPDATE PTRAGENCY_CONTRACT SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#,
		IS_DEFAULT=#DEFAULT#
		WHERE ID=#CONTRACT_ID#
	</update>
	
	<sql id="contestedCondition">
		select 'CONTESTED','DISCRETE','Contested','Not Applicable',null,false <include refid="fromdual"/>
		union
		select 'CONTESTED','DISCRETE','Contested','No',0,false <include refid="fromdual"/>
		union
		select 'CONTESTED','DISCRETE','Contested','Yes',1,false <include refid="fromdual"/>
	</sql>	
	<sql id="institutionLevelCondition">
		select 'INSTITUTION_LEVEL_ID','DISCRETE','Institution Level','Not Applicable',null,false <include refid="fromdual"/>
		union
		select 'INSTITUTION_LEVEL_ID','DISCRETE','Institution Level',description,id,disable  
		from ptrinstitution_level_ref
	</sql>	
	<sql id="auctionStatusCondition">
		select 'AUCTION_STATUS_ID','DISCRETE','Auction Status','Not Applicable',null,false <include refid="fromdual"/>
		union
		select 'AUCTION_STATUS_ID','DISCRETE','Auction Status',description,id,disable  
		from ptrlegal_action_auction_status_ref
	</sql>	
	<sql id="legalActionCondition">
		select 'ACTION_ID','DISCRETE','Action',description,id,disable  from ptrlegal_action_ref
		where subtype_id=#SUBTYPE_ID# and contract = <include refid="true"/>
	</sql>	
	<sql id="legalActionStatusCondition">
		select 'STATUS_ID','DISCRETE','Status',description,id,disable  from PTRTREATMENT_STATUS_REF
		WHERE ID IN (15004,15005,15001)	
	</sql>
	<sql id="feeCondition">
		select 'FEE','CURRENCY','fee','',0,<include refid="false"/> <include refid="fromdual"/>
	</sql>		
	<sql id="miaBeginCondition">
		select 'MIA_BEGIN','NUMERIC','MIA (Begin)','',0,<include refid="false"/> <include refid="fromdual"/>
	</sql>	
	<sql id="miaCurrentCondition">
		select 'MIA_CURRENT','NUMERIC','MIA (Current)','',0,<include refid="false"/> <include refid="fromdual"/>
	</sql>	
	<sql id="paymentMethodCondition">
		select 'PAYMENT_METHOD_ID','DISCRETE','Payment Method',description,id,disable  from ptrpayment_method_ref
	</sql>
	<sql id="accountTaggingCondition">
		select 'ACCOUNT_TAGGING_ID','DISCRETE','Account Tagging',description,id,disable  from ptraccount_tagging_ref
	</sql>	
	<resultMap id="getLegalContractCondition" class="hmap">
		<result property="FIELD_NAME" javaType="string" />
		<result property="FIELD_TYPE" javaType="string" />
		<result property="FIELD_DESCRIPTION" javaType="string" />
		<result property="DISCRETE_VALUE_DESCRIPTION" javaType="string" />
		<result property="DISCRETE_VALUE_ID" javaType="long" />
		<result property="DISCRETE_VALUE_DISABLED" javaType="boolean" />
	</resultMap>
	<select id="getLegalContractCondition" resultMap="getLegalContractCondition">
		<include refid="legalActionCondition"/> union
		<include refid="institutionLevelCondition"/> union
		<include refid="contestedCondition"/> union
		<include refid="auctionStatusCondition"/> union
		<include refid="feeCondition"/> union
		<include refid="miaBeginCondition"/> union
		<include refid="miaCurrentCondition"/> union
		<include refid="paymentMethodCondition"/> union
		<include refid="legalActionStatusCondition"/> union
		<include refid="accountTaggingCondition"/>
	</select>
	
	<resultMap id="getContractVersion" class="hmap">
		<result property="ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="SORT_PRIORITY" javaType="long" />
		<result property="EFFECTIVE_DATE" javaType="date" />
		<result property="TYPE_ID" javaType="long" />
		<result property="READ_ONLY" javaType="boolean" />
	</resultMap>
	<select id="getContractVersion" resultMap="getContractVersion">
		select v.id,'draft' as description, case when v.id is not null then 99999999 else 0 end as sort_priority ,v.effective_date,s.type_id, <include refid="false"/>
		from ptragency_contract c
		inner join ptrtreatment_subtype_ref s on s.id=c.subtype_id
		left join ptragency_contract_version v  on c.id=v.contract_id and v.version_no is null
		where c.id=#CONTRACT_ID#
		union
		(select v.id,v.version_no, v.id as sort_priority ,v.effective_date,s.type_id,<include refid="true"/>
		from ptragency_contract c
		inner join ptrtreatment_subtype_ref s on s.id=c.subtype_id
		inner join ptragency_contract_version v  on c.id=v.contract_id and v.version_no is not null
		where c.id=#CONTRACT_ID#
		order by cast(v.version_no as bigint) desc) order by sort_priority desc
	</select>
	
	<insert id="insertContractVersion">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRAGENCY_CONTRACT_VERSION_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRAGENCY_CONTRACT_VERSION(ID,CONTRACT_ID,EFFECTIVE_DATE,VERSION_NO,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CONTRACT_ID#,#EFFECTIVE_DATE#,#VERSION_NO#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	<update id="updateContractVersion">
		UPDATE PTRAGENCY_CONTRACT_VERSION SET
		EFFECTIVE_DATE = #EFFECTIVE_DATE#,
		VERSION_NO = #VERSION_NO#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#VERSION_ID#
	</update>
	<resultMap id="getContractVersionNo" class="hmap">
		<result property="VERSION_NO" javaType="string" />
	</resultMap>
	<select id="getContractVersionNo" resultMap="getContractVersionNo">
		select coalesce(max(cast(version_no as bigint)),0)+1 from PTRAGENCY_CONTRACT_VERSION where contract_id=#CONTRACT_ID# and version_no is not null
	</select>	
	<insert id="insertContractVersionTerm">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRAGENCY_CONTRACT_VERSION_TERM_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		insert into PTRAGENCY_CONTRACT_VERSION_TERM(ID,VERSION_ID,DESCRIPTION,DOCUMENT_ID,TYPE_ID)
		VALUES(#ID#,#VERSION_ID#,#DESCRIPTION#,#DOCUMENT_ID#,#TYPE_ID#)	
	</insert>
	<delete id="deleteContractVersionTerm">
		delete from PTRAGENCY_CONTRACT_VERSION_TERM where version_id=#VERSION_ID#
	</delete>

	<resultMap id="getContractVersionTermForDraft" class="hmap">
		<result property="VERSION_ID" javaType="long" />
	</resultMap>
	<select id="getContractVersionTermForDraft" resultMap="getContractVersionTermForDraft">
		select id from ptragency_contract_version v
		where id=(select max(id) from ptragency_contract_version vv where vv.contract_id=v.contract_id)
		and v.contract_id=#CONTRACT_ID# and date(effective_date) &lt;= cast(#CURRENT_TIME# as date)
	</select>
		
	<resultMap id="getContractVersionTerm" class="hmap">
		<result property="DESCRIPTION" javaType="string" />
		<result property="DOCUMENT_ID" javaType="long" />
	</resultMap>
	<select id="getContractVersionTerm" resultMap="getContractVersionTerm">
		select description,document_id from PTRAGENCY_CONTRACT_VERSION_TERM
		where version_id = #VERSION_ID#
	</select>
	
	<resultMap id="getContractAgencies" class="hmap">
		<result property="ID" javaType="long" />
		<result property="AGENCY_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="AGENCY_NAME" javaType="string" />
		<result property="ASSIGNED_DATE" javaType="date" />
		<result property="ASSIGNED_BY" javaType="string" />
	</resultMap>
	<select id="getContractAgencies" resultMap="getContractAgencies">
		SELECT R.ID,A.ID as AGENCY_ID,A.CODE,A.DESCRIPTION ,R.ASSIGNED_DATE,R.ASSIGNED_BY
		FROM PTRAGENCY_CONTRACT_REL R
		INNER JOIN PTRAGENCY A ON A.ID=R.AGENCY_ID
		WHERE R.CONTRACT_ID=#CONTRACT_ID#
	</select>
	
	<resultMap id="getContractAvailableAgencies" class="hmap">
		<result property="AGENCY_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="AGENCY_NAME" javaType="string" />
	</resultMap>
	<select id="getContractAvailableAgencies" resultMap="getContractAvailableAgencies">
		select A.ID,A.CODE,A.DESCRIPTION from PTRAGENCY A
		INNER JOIN PTRAGENCY_TYPE_REF T ON T.ID=A.TYPE_ID 
		<isEqual property="SUBTYPE" compareValue="ECA">
		and T.CODE='ECA'
		</isEqual>
		<isNotEqual property="SUBTYPE" compareValue="ECA">
		and T.CODE='LGL'
		</isNotEqual>
		
		WHERE NOT EXISTS(
		SELECT 1 FROM PTRAGENCY_CONTRACT_REL R WHERE R.AGENCY_ID=A.ID and R.CONTRACT_ID=#CONTRACT_ID#
		)
	</select>
	<insert id="insertContractAgencyRel">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRAGENCY_CONTRACT_REL_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRAGENCY_CONTRACT_REL(ID,AGENCY_ID,CONTRACT_ID,ASSIGNED_DATE,ASSIGNED_BY)
		VALUES(#ID#,#AGENCY_ID#,#CONTRACT_ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	
	<insert id="insertContractAgencyRelHistory">	
		INSERT INTO PTRAGENCY_CONTRACT_REL_HISTORY(ID,AGENCY_ID,CONTRACT_ID,ASSIGNED_DATE,ASSIGNED_BY)
		VALUES(#ID#,#AGENCY_ID#,#CONTRACT_ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	<delete id="deleteAgencyContract">
		delete from PTRAGENCY_CONTRACT_REL where id=#ID#
	</delete>
	<update id="updateContractRelHistory">
		update PTRAGENCY_CONTRACT_REL_HISTORY set removed_by =#LOGON_USER#, removed_date = #CURRENT_TIME# WHERE ID = #ID#
	</update>
	
	<resultMap id="getUsersForApprovalMatrix" class="hmap">
		<result property="USER_ID" javaType="string" />
		<result property="FIRST_NAME" javaType="string" />
		<result property="MIDDLE_NAME" javaType="string" />
		<result property="LAST_NAME" javaType="string" />
		<result property="DESIGNATION" javaType="string" />
		<result property="SUBTYPE_ID" javaType="long" />
		<result property="APPROVAL_TYPE_ID" javaType="long" />
		<result property="AMOUNT_LIMIT" javaType="$" />
	</resultMap>
	<select id="getUsersForApprovalMatrix" resultMap="getUsersForApprovalMatrix">
		select distinct ur.user_id,e.first_name,e.middle_name,e.last_name,e.designation ,m.subtype_id,m.approval_type_id,m.amount_limit
		from ptruser_role ur
		inner join ptruser u on u.user_id=ur.user_id
		inner join ptrrole_access_rel ar on ar.role_id=ur.role_id
		inner join ptremployee e on e.id=u.employee_id
		left join ptruser_approval_matrix m on m.user_id=ur.user_id and m.approval_type_id=#APPROVAL_TYPE_ID# and m.subtype_id=#SUBTYPE_ID#
		where 
		<isEqual property="APPROVAL_TYPE_ID" compareValue="1">
		ar.access_rights_id = 87651
		</isEqual>
		<isEqual property="APPROVAL_TYPE_ID" compareValue="2">
		ar.access_rights_id = 87743
		</isEqual>
	</select>
	<update id="updateApprovalMatrix">
		update ptruser_approval_matrix set amount_limit=#AMOUNT_LIMIT# where user_id=#USER_ID# and approval_type_id=#APPROVAL_TYPE_ID# and subtype_id=#SUTYPE_ID#
	</update>
	<insert id="insertApprovalMatrix">	
		insert into ptruser_approval_matrix(user_id,approval_type_id,subtype_id,amount_limit)
		values(#USER_ID#,#APPROVAL_TYPE_ID#,#SUBTYPE_ID#,#AMOUNT_LIMIT#)
	</insert>
	
	<resultMap id="getTurnaroundStageList" class="hmap">
		<result property="ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="REMARKS" javaType="string" />
		<result property="PERIOD" javaType="long" />
		<result property="DISABLED" javaType="boolean" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_BY" javaType="string" />
	</resultMap>
	<select id="getTurnaroundStageList" resultMap="getTurnaroundStageList">
		SELECT R.ID,R.CODE,R.DESCRIPTION,R.REMARKS,R.PERIOD,
		R.DISABLE,R.CREATED_TIME,R.UPDATED_TIME,R.CREATED_BY,R.UPDATED_BY 
		FROM PTRLEGAL_TURNAROUND_STAGE_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID#
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
			AND R.DISABLE = <include refid="false"/>
		</isNotEqual> 	
	</select>
	
	<resultMap id="getTurnaroundStageForEditing" class="hmap">
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="PERIOD" javaType="long" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getTurnaroundStageForEditing" resultMap="getTurnaroundStageForEditing">
		SELECT CODE,DESCRIPTION,PERIOD,DISABLE
		FROM PTRLEGAL_TURNAROUND_STAGE_REF
		WHERE ID = #STAGE_ID#	
	</select>
	<insert id="insertTurnaroundStageRef">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRLEGAL_TURNAROUND_STAGE_REF_ID
			<include refid="sequenceSuffix" />
		</selectKey>	
		INSERT INTO PTRLEGAL_TURNAROUND_STAGE_REF(ID,CODE,DESCRIPTION,SUBTYPE_ID,PERIOD,REMARKS,SORT_PRIORITY,CREATED_TIME,CREATED_BY)
		VALUES(#ID#,#CODE#,#DESCRIPTION#,#SUBTYPE_ID#,#PERIOD#,#REMARKS#,#ID#,#CURRENT_TIME#,#LOGON_USER#)	
	</insert>
	<update id="updateTurnaroundStageRef">
		UPDATE PTRLEGAL_TURNAROUND_STAGE_REF SET
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		PERIOD = #PERIOD#,
		REMARKS = #REMARKS#,
		DISABLE = #DISABLE#,
		UPDATED_BY = #LOGON_USER#,
		UPDATED_TIME =#CURRENT_TIME#
		WHERE ID=#STAGE_ID#
	</update>
	<update id="updateTurnaroundStageRefPriority">
		UPDATE PTRLEGAL_TURNAROUND_STAGE_REF SET
		SORT_PRIORITY = #SORT_PRIORITY#
		WHERE ID=#ID#
	</update>	

	<resultMap id="getTurnaroundActions" class="hmap">
		<result property="ACTION_ID" javaType="long" />
		<result property="STAGE_ID" javaType="long" />
		<result property="TYPE_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TYPE" javaType="string" />
	</resultMap>
	<select id="getTurnaroundEntries" resultMap="getTurnaroundActions">
		SELECT R.ID,S.ID,T.TYPE_ID,R.CODE,R.DESCRIPTION,TR.DESCRIPTION FROM PTRLEGAL_TURNAROUND_STAGE_REF S INNER JOIN 
		PTRSTAGE_ACTION_TURNAROUND T ON T.STAGE_ID=S.ID
		INNER JOIN PTRLEGAL_ACTION_REF R ON R.ID=T.ACTION_ID
		INNER JOIN PTRLEGAL_ACTION_TYPE_REF TR ON TR.ID=R.TYPE_ID
		WHERE T.TYPE_ID=1 AND S.ID=#STAGE_ID#	
	</select>
	<select id="getTurnaroundExits" resultMap="getTurnaroundActions">
		SELECT R.ID,S.ID,T.TYPE_ID,R.CODE,R.DESCRIPTION,TR.DESCRIPTION FROM PTRLEGAL_TURNAROUND_STAGE_REF S INNER JOIN 
		PTRSTAGE_ACTION_TURNAROUND T ON T.STAGE_ID=S.ID
		INNER JOIN PTRLEGAL_ACTION_REF R ON R.ID=T.ACTION_ID
		INNER JOIN PTRLEGAL_ACTION_TYPE_REF TR ON TR.ID=R.TYPE_ID
		WHERE T.TYPE_ID=2 AND S.ID=#STAGE_ID#	
	</select>
	
	<resultMap id="getTurnaroundAvailableActions" class="hmap">
		<result property="ACTION_ID" javaType="long" />
		<result property="SUBTYPE_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="TYPE" javaType="string" />
	</resultMap>
	<select id="getTurnaroundAvailableEntries" resultMap="getTurnaroundAvailableActions">
		SELECT R.ID,R.SUBTYPE_ID,R.CODE,R.DESCRIPTION,TR.DESCRIPTION 
		FROM PTRLEGAL_ACTION_REF R
		INNER JOIN PTRLEGAL_ACTION_TYPE_REF TR ON TR.ID=R.TYPE_ID
		WHERE R.SUBTYPE_ID=#SUBTYPE_ID# AND R.ID NOT IN(SELECT T.ACTION_ID 
		FROM PTRLEGAL_TURNAROUND_STAGE_REF RR INNER JOIN PTRSTAGE_ACTION_TURNAROUND T ON T.STAGE_ID =RR.ID 
		AND RR.SUBTYPE_ID=#SUBTYPE_ID# WHERE T.TYPE_ID=1)	
	</select>
	<select id="getTurnaroundAvailableExits" resultMap="getTurnaroundAvailableActions">
		SELECT R.ID,R.SUBTYPE_ID,R.CODE,R.DESCRIPTION,TR.DESCRIPTION 
		FROM PTRLEGAL_ACTION_REF R
		INNER JOIN PTRLEGAL_ACTION_TYPE_REF TR ON TR.ID=R.TYPE_ID
		WHERE R.SUBTYPE_ID=#SUBTYPE_ID# AND R.ID NOT IN(SELECT T.ACTION_ID 
		FROM PTRLEGAL_TURNAROUND_STAGE_REF RR INNER JOIN PTRSTAGE_ACTION_TURNAROUND T ON T.STAGE_ID =RR.ID 
		AND RR.SUBTYPE_ID=#SUBTYPE_ID# WHERE T.TYPE_ID=2)	
	</select>
	<insert id="insertTurnaroundStageAction">	
		INSERT INTO PTRSTAGE_ACTION_TURNAROUND(ACTION_ID,STAGE_ID,TYPE_ID)
		VALUES(#ACTION_ID#,#STAGE_ID#,#TYPE_ID#)	
	</insert>	
	
	<delete id="deleteTurnaroundActions">
		delete from PTRSTAGE_ACTION_TURNAROUND where ACTION_ID=#ACTION_ID# and STAGE_ID=#STAGE_ID# and TYPE_ID =#TYPE_ID#
	</delete>
	
	
	<select id="getStatusForInstructionTermination" resultMap="global.ref">
		<include refid="pleaseSelectRef"/>
		union
		<include refid="refselect" /> 
		FROM PTRTREATMENT_STATUS_REF
		WHERE ID IN (15004,15005,15001)	
	</select>
	<select id="getHostCCRISStatus" resultMap="global.ref">
		<include refid="pleaseSelectRef"/>
		union
		<include refid="refselect" /> 
		FROM PTRHOST_CCRIS_STATUS_REF
	</select>		
	<select id="getActionListTermination" resultMap="global.ref" >
		<include refid="pleaseSelectRef"/>
		union
		<include refid="refselect" /> 
		FROM PTRLEGAL_ACTION_REF R
		WHERE R.INSTRUCTION_ID = #ACTION_ID# 
	</select>
	
	<resultMap class="hmap" id="getAuctionStatusTermination">
		<result property="ID" javaType="long"/>
		<result property="DESCRIPTION" javaType="string"/>
		<result property="DISABLE" javaType="boolean"/>
		<result property="SORT_PRIORITY" javaType="long"/>
	</resultMap>
	
	<select id="getInstructionListTermination" resultMap="getAuctionStatusTermination">
		select NULL as ID, ' Not Applicable' as DESCRIPTION, false as DISABLE, -1 as SORT_PRIORITY
		union
		select R.ID, R.DESCRIPTION, R.DISABLE, R.SORT_PRIORITY
		FROM PTRLEGAL_ACTION_REF R
		WHERE R.SUBTYPE_ID = #SUBTYPE_ID# AND R.TYPE_ID=1 AND DISABLE=FALSE	 
	</select>
	
	<select id="getAuctionStatusTermination" resultMap="getAuctionStatusTermination">
		select NULL as ID, ' Not Applicable' as DESCRIPTION, false as DISABLE, -1 as SORT_PRIORITY
		union
		select ID, DESCRIPTION, DISABLE,SORT_PRIORITY
		FROM PTRLEGAL_ACTION_AUCTION_STATUS_REF 
		WHERE DISABLE=FALSE
	</select>
	
	<insert id="insertInstructionTerminateCondition">	
		INSERT INTO PTRLEGAL_INSTRUCTION_TERMINATE_CONDITION(INSTRUCTION_ID,ACTION_ID,ACTION_STATUS_ID,NEW_INSTRUCTION_ID,INSTRUCTION_STATUS_ID,AUCTION_STATUS_ID)
		VALUES(#INSTRUCTION_ID#,#CURRENT_ACTION_ID#,#ACTION_STATUS_ID#,#NEW_INSTRUCTION_ID#,#INSTRUCTION_STATUS_ID#,#AUCTION_STATUS_ID#)	
	</insert>
	
	<delete id="deleteInstructionTerminateCondition">
		delete from PTRLEGAL_INSTRUCTION_TERMINATE_CONDITION where INSTRUCTION_ID = #ACTION_ID#
	</delete>
	
	<resultMap id="getTerminationCondition" class="hmap" >
		<result property="CURRENT_ACTION_ID" javaType="long" />
		<result property="ACTION" javaType="string" />
		<result property="NEW_INSTRUCTION_ID" javaType="long" />
		<result property="NEXT_INSTRUCTION" javaType="string" />
		<result property="ACTION_STATUS_ID" javaType="long" />
		<result property="STATUS" javaType="string" />
		<result property="INSTRUCTION_STATUS_ID" javaType="long" />
		<result property="CURRENT_INSTRUCTION_STATUS" javaType="string" />
		<result property="AUCTION_STATUS_ID" javaType="long" />
		<result property="AUCTION_STATUS" javaType="string" />
	</resultMap>
	<select id="getTerminationCondition" resultMap="getTerminationCondition" >
		SELECT 
		T.ACTION_ID,LA.DESCRIPTION,
		T.NEW_INSTRUCTION_ID,LNI.DESCRIPTION,
		T.ACTION_STATUS_ID,SA.DESCRIPTION,
		T.INSTRUCTION_STATUS_ID,SI.DESCRIPTION,
		T.AUCTION_STATUS_ID,AAS.DESCRIPTION
		FROM PTRLEGAL_INSTRUCTION_TERMINATE_CONDITION T
		INNER JOIN  PTRLEGAL_ACTION_REF LI ON T.INSTRUCTION_ID=LI.ID
		INNER JOIN  PTRLEGAL_ACTION_REF LA ON T.ACTION_ID=LA.ID
		LEFT JOIN  PTRLEGAL_ACTION_REF LNI ON T.NEW_INSTRUCTION_ID=LNI.ID
		INNER JOIN PTRTREATMENT_STATUS_REF SA ON T.ACTION_STATUS_ID=SA.ID
		INNER JOIN PTRTREATMENT_STATUS_REF SI ON T.INSTRUCTION_STATUS_ID=SI.ID
		LEFT JOIN PTRLEGAL_ACTION_AUCTION_STATUS_REF AAS ON T.AUCTION_STATUS_ID=AAS.id
		WHERE T.INSTRUCTION_ID = #ACTION_ID#
	</select>
	
 <update id="updateExpensesRef">
 		update PTRACTION_EXPENSES_REF set description=#DESCRIPTION#,limit_amount=#LIMIT_AMOUNT#,disable=#DISABLE#,SST =#SST#
 		where id=#ID#
 </update>
	
 <insert id="insertExpensesRef">
 	insert into PTRACTION_EXPENSES_REF (action_id,description,limit_amount,disable,sst)
	values (#ACTION_ID#,#DESCRIPTION#,#LIMIT_AMOUNT#,#DISABLE#,#SST#)
	</insert>
	
	<resultMap id="getExpensesForSetup" class="hmap" >
		<result property="ID" javaType="long" />
		<result property="ACTION_ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="LIMIT_AMOUNT" javaType="$" />
		<result property="DISABLE" javaType="boolean" />	
		<result property="SST" javaType="boolean" />	
	</resultMap>
	<select id="getExpensesForSetup" resultMap="getExpensesForSetup" >
		select id, 
		action_id,description,limit_amount,disable,sst
		from PTRACTION_EXPENSES_REF
		WHERE ACTION_ID = #ACTION_ID#
	</select>
	
	
	<resultMap id="getContractEffectiveVersion" class="hmap">
	<result property="ID" javaType="long" />
	<result property="IS_EFFECTIVE" javaType="boolean" />
</resultMap>
	<select id="getContractEffectiveVersion" resultMap="getContractEffectiveVersion">
		select distinct r.id, <include refid="true"/> as is_effective from ptragency_contract r
		inner join ptragency_contract_version v on v.contract_id=r.id
		where v.id=(select max(id) from ptragency_contract_version vv where
		vv.contract_id=v.contract_id)
		and date(v.effective_date) &lt;= cast(#CURRENT_TIME# as DATE)
		and r.SUBTYPE_ID=#SUBTYPE_ID#
		<isNotEqual compareValue="true" property="SHOW_ALL">
			AND R.DISABLE =
			<include refid="false" />
		</isNotEqual>
	</select>

</sqlMap>