<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="treatmentProcessService">

<!--  2.Query to get all read only field -->

<resultMap id="getTreatmentAuctionCollateralDetails" class="hmap">
		<result property="ACCOUNT_ID" javaType="long" />
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		<result property="YEAR_OF_MANUFACTURE" javaType="string" />
		<result property="DATE_OF_REGISTRATION" javaType="date" />
	</resultMap>


	<select id="getTreatmentAuctionCollateralDetails" resultMap="getTreatmentAuctionCollateralDetails">
		SELECT R.ACCOUNT_ID, 
C.NAME,
COALESCE (C.collateral_code, ' ' ) || ' ' || COALESCE (C.DESCRIPTION, ' '),
(C.year_of_manufacture) as YEAR,
C.REGISTRATION_DATE
		FROM PTRACCOUNT A 
		LEFT JOIN PTRACCOUNT_COLLATERAL_REL R ON A.ACCOUNT_ID = R.ACCOUNT_ID 
          	inner JOIN PTRCOLLATERAL C ON (R.COLLATERAL_ID = C.ID)
          	inner join ptrcollateral_type_ref colref on (C.type_id = colref.id)
		WHERE A.ACCOUNT_ID =  #ACCOUNT_ID:NUMERIC# 
		AND C.registration_no is not null 
<!-- 		and colref.code not in ('K01','K02','K03','K04','K05','K06','K07','K08','K10','K99') -->
	</select>
	
<resultMap class="hmap" id="getStoreYardforAuction">
		<result javaType="long" property="AGENCY_ID_HOUSE"/>
		<result javaType="string" property="STORE_YARD_NAME"/>
		<result javaType="long" property="STOREYARD_ID"/>
	</resultMap>
	
	<select id="getStoreYardforAuction" resultMap="getStoreYardforAuction">
		select b.AGENCY_ID, b.AGENCY_NAME as AUCTION_HOUSE,b.AGENCY_ID
		from ptrrepossession_order a
		left join PTRAGENCY b on a.STORE_YARD_ID = b.AGENCY_ID
		where TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTRREPOSSESSION_ORDER c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# and b.PROCESS_STATUS_ID = 15004 )
	</select>
	
	<resultMap class="hmap" id="get14DaysDetailsforAuction">
		<result javaType="long" property="AGENCY_ID_HOUSE"/>
		<result javaType="string" property="AUCTION_HOUSE_NAME"/>
		<result javaType="date" property="FIFTH_SCHED_SENDING_DATE"/>
		<result javaType="date" property="AUCTION_14DAYS_NOTICE_DATE"/>
		<result javaType="long" property="AUCTION_HOUSE_ID"/>
	</resultMap>
	
	<select id="get14DaysDetailsforAuction" resultMap="get14DaysDetailsforAuction">
		select b.AGENCY_ID, b.AGENCY_NAME as AUCTION_HOUSE, a.FIFTH_SCHED_SEND_DATE, a.NOTICE_DATE,b.AGENCY_ID
		from PTR14_DAYS_NOTICE a
		left join PTRAGENCY b on a.AUCTION_HOUSE_ID = b.AGENCY_ID
		where TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTR14_DAYS_NOTICE c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# and b.PROCESS_STATUS_ID = 15004 )
	</select>
	
	<resultMap class="hmap" id="getAuctionDetailsFifthScheduleDate">
<result javaType="date" property="LAST_FIFTH_SCHEDULE_SENDING_DATE"/>
</resultMap>

<select id="getAuctionDetailsFifthScheduleDate" resultMap="getAuctionDetailsFifthScheduleDate">
select tp.CREATED_DATE from PTRACC_TREATMENT_PLAN pl
inner join PTRTREATMENT_PROCESS tp on tp.TREATMENT_PLAN_ID=pl.TREATMENT_PLAN_ID
inner join PTRTREATPROC_SUBTYPE_REF sb on sb.TREATPROC_SUBTYPE_ID=tp.PROCESS_SUBTYPE_ID 
where pl.ACCOUNT_ID=#ACCOUNT_ID# 
and tp.PROCESS_TYPE_ID=14 
and tp.FROM_HOST=1
and sb.TREATPROC_TYPE_CODE='5S'
order by tp.CREATED_DATE desc
fetch first row only
</select>


<!--  2.Query to get Technical Reason Description -->

	<resultMap id="getTechnicalReasonDescriptionForAuctionDetails" class="hmap">
		<result property="ID" column="ID" javaType="long" />
		<result property="CODE" column="CODE" javaType="string" />
		<result property="DESCRIPTION" column="DESCRIPTION" javaType="string" />
		<result property="DISABLE" column="DISABLE" javaType="boolean" />
		<result property="SORT_PRIORITY" javaType="long" />
	</resultMap>


	<select id="getTechnicalReasonDescriptionForAuctionDetails" resultMap="getTechnicalReasonDescriptionForAuctionDetails">
		select ID,CODE,DESCRIPTION,DISABLE,SORT_PRIORITY from PTRTECH_REASON_DESC_REF
	</select>

<!--  2.Query to get Auction Date -->

	<resultMap id="getAuctionDateForAuctionDetails-rmap" class="hmap">
		<result property="AUCTION_DATE" javaType="date" />
	</resultMap>
	

	<select id="getAuctionDateForAuctionDetails" resultMap="getAuctionDateForAuctionDetails-rmap">
		select min(TENTATIVE_AUCTION_TIME) from PTRAGENCY_AUCTION_SETUP
	</select>
	

<!--  2.Query to get 5th Schedule Sending Date -->

	<resultMap id="get5thSchedSendDateForAuctionDetails-rmap" class="hmap">
		<result property="FIFTH_SCHED_SENDING_DATE" javaType="date" />
	</resultMap>
	

	<select id="get5thSchedSendDateForAuctionDetails" resultMap="get5thSchedSendDateForAuctionDetails-rmap">
		select FIFTH_SCHED_SEND_DATE 
		from PTR14_DAYS_NOTICE
		where TREATMENT_PROCESS_ID = (SELECT MAX(TREATMENT_PROCESS_ID) FROM PTR14_DAYS_NOTICE WHERE ACCOUNT_ID = #ACCOUNT_ID# )
	</select>
	
<!--  2.Query to get Auction 14 Days Notice Date -->

	<resultMap id="getAuction14DaysNoticeDateForAuctionDetails-rmap" class="hmap">
		<result property="AUCTION_14DAYS_NOTICE_DATE" javaType="date" />
	</resultMap>
	

	<select id="getAuction14DaysNoticeDateForAuctionDetails" resultMap="getAuction14DaysNoticeDateForAuctionDetails-rmap">
		select NOTICE_DATE
		from PTR14_DAYS_NOTICE
		where TREATMENT_PROCESS_ID = (SELECT MAX(TREATMENT_PROCESS_ID) FROM PTR14_DAYS_NOTICE WHERE ACCOUNT_ID = #ACCOUNT_ID#)
	</select>

<!--  2.Query to get Shortfall Notice Date -->

	<resultMap id="getShortfallNoticeDateForAuctionDetails-rmap" class="hmap">
		<result property="SHORTFALL_NOTICE_DATE" javaType="date" />
	</resultMap>
	

	<select id="getShortfallNoticeDateForAuctionDetails" resultMap="getShortfallNoticeDateForAuctionDetails-rmap">
		select PRINTING_DATE as SHORTFALL_NOTICE_DATE from PTRSHORTFALL
		where TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTRSHORTFALL c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# )
	</select>

<!--  1.Query to get Auction House -->

	<resultMap class="hmap" id="getAuctionHouseForAuctionDetails-rmap">
		<result javaType="string" property="AUCTION_HOUSE"/>
	</resultMap>
	
	<select id="getAuctionHouseForAuctionDetails" resultMap="getAuctionHouseForAuctionDetails-rmap">
		select PLACE_OF_REPOSSESSED as AUCTION_HOUSE
		from ptrrepossession_order
		where TREATMENT_PROCESS_ID = (SELECT MAX(TREATMENT_PROCESS_ID) FROM ptrrepossession_order WHERE ACCOUNT_ID = #ACCOUNT_ID# )
	</select>
	
<!--  1.Query to get Store Yard -->

	<resultMap class="hmap" id="getStoreYardForAuctionDetails-rmap">
		<result javaType="string" property="STORE_YARD"/>
	</resultMap>
	
	<select id="getStoreYardForAuctionDetails" resultMap="getStoreYardForAuctionDetails-rmap">
		select STOREYARD as STORE_YARD
		from ptrrepossession_order
		where TREATMENT_PROCESS_ID = (SELECT MAX(TREATMENT_PROCESS_ID) FROM ptrrepossession_order WHERE ACCOUNT_ID = #ACCOUNT_ID# )
	</select>
	
<!--  1.Query to get Collateral Name -->

	<resultMap class="hmap" id="getCollateralNameForAuctionDetails-rmap">
		<result javaType="string" property="COLLATERAL_NAME"/>
	</resultMap>
	
	<select id="getCollateralNameForAuctionDetails" resultMap="getCollateralNameForAuctionDetails-rmap">
		select col.NAME from PTRCOLLATERAL col
		inner join PTRACCOUNT_COLLATERAL_REL acr on col.ID = acr.COLLATERAL_ID
		WHERE acr.ACCOUNT_ID = #ACCOUNT_ID# 
	</select>
	
<!--  1.Query to get Collateral Code -->

	<resultMap class="hmap" id="getCollateralCodeForAuctionDetails-rmap">
		<result javaType="string" property="COLLATERAL_CODE"/>
	</resultMap>
	
	<select id="getCollateralCodeForAuctionDetails" resultMap="getCollateralCodeForAuctionDetails-rmap">
		select collref.code as COLLATERAL_CODE from PTRCOLLATERAL_TYPE_REF collref
		inner join PTRCOLLATERAL col on collref.ID = col.TYPE_ID
		inner join PTRACCOUNT_COLLATERAL_REL acr on col.ID = acr.COLLATERAL_ID
		WHERE acr.ACCOUNT_ID = #ACCOUNT_ID#
	</select>
	
<!--  1.Query to get Year of Manufacture -->

	<resultMap class="hmap" id="getYearOfManufactureForAuctionDetails-rmap">
		<result javaType="string" property="YEAR_OF_MANUFACTURE"/>
	</resultMap>
	
	<select id="getYearOfManufactureForAuctionDetails" resultMap="getYearOfManufactureForAuctionDetails-rmap">
		select YEAR(col.YEAR) as YEAR_OF_MANUFACTURE from PTRCOLLATERAL col
		inner join PTRACCOUNT_COLLATERAL_REL acr on col.ID = acr.COLLATERAL_ID
		WHERE acr.ACCOUNT_ID = #ACCOUNT_ID#
	</select>			
	
	<resultMap id="getTreatmentAuctionDetails" class="hmap">
		<result property="COLLATERAL_NAME" javaType="string" />
		<result property="COLLATERAL_CODE" javaType="string" />
		<result property="DATE_OF_REGISTRATION" javaType="date" />
		<result property="YEAR_OF_MANUFACTURE" javaType="string" />
	</resultMap>
	<select id="getTreatmentAuctionDetails" resultMap="getTreatmentAuctionDetails">
		select col.name,
		ctr.code ||'-'|| ctr.description as collateral_code,
		col.registration_date,
		col.year_of_manufacture
		from ptraccount_collateral_rel rel 
		inner join ptrcollateral col on col.id=rel.collateral_id
		left join ptrcollateral_type_ref ctr on ctr.id=col.type_id
		where rel.account_id= #ACCOUNT_ID#
	</select>

<!--  General Select Result Map for AuctionDetails Information-->

	<resultMap class="hmap" id="getAuctionDetailsTreatmentProcessInformation-rmap">
		<result property="TREATMENT_ID" javaType="long" />
		<result property="COLLATERAL_NAME" javaType="string" jdbcType="VARCHAR" />
		<result property="COLLATERAL_CODE" javaType="string" jdbcType="VARCHAR" />
		<result property="DATE_OF_REGISTRATION" javaType="date" jdbcType="DATE" />
		<result property="YEAR_OF_MANUFACTURE" javaType="string" jdbcType="VARCHAR" />
		<result property="STORE_YARD" javaType="string" jdbcType="VARCHAR" />
		<result property="AUCTION_HOUSE" javaType="string" jdbcType="VARCHAR" />
		<result property="SUCCESSFUL_BIDDER" javaType="string" jdbcType="VARCHAR" />
		<result property="BIDDER_NRIC_ROC" javaType="string" jdbcType="VARCHAR" />
		<result property="CONTACT_NO" javaType="string" jdbcType="VARCHAR" />
		<result property="FIFTH_SCHED_SENDING_DATE" javaType="date" jdbcType="DATE" />
		<result property="REGISTRATION_CARD" javaType="string" jdbcType="VARCHAR" />
		<result property="AUCTION_14DAYS_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<result property="DATE_SOLD_AUCTION" javaType="date"/>
		<result property="SALES_PROCEED_AMT" javaType="double" />
		<result property="SHORTFALL_DATE" javaType="date" jdbcType="DATE" />
		<result property="E_DISCHARGE_DATE" javaType="date" jdbcType="DATE" />
		<result property="SHORTFALL_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<result property="FS_DATE" javaType="date" jdbcType="DATE" />
		<result property="NI_DATE" javaType="date" jdbcType="DATE" />
		<result property="LAST_5S_DATE" javaType="date" jdbcType="DATE" />
		<result property="AUCTION_FEE" javaType="double" />
		<result property="STORAGE_FEE" javaType="double" />
		<result property="REPO_FEE" javaType="double" />
		<result property="OTHER_INCIDENTAL_COST_PAID" javaType="double" />
		<result property="TECHNICAL_REASON" javaType="string" jdbcType="VARCHAR" />
		<result property="TECHNICAL_REASON_DESCRIPTION" javaType="long" />
		<result property="COC_SECTION42" javaType="double" />
		<result property="COC_SECTION161A" javaType="double" />
		<result property="NOTES" jdbcType="VARCHAR"/>
		<result property="RESERVE_PRICE" javaType="double"/>
		<result property="AUCTION_DATE" javaType="date"/>
		<result property="BIDDER_ADDRESS" javaType="string"/>
		<result property="TYPE_STATUS_ID" javaType="long" />
	</resultMap>

<!--  General Query to get AuctionDetails Information -->

	<select id="getAuctionDetailsTreatmentProcessInformation" resultMap="getAuctionDetailsTreatmentProcessInformation-rmap">
		select
		TREATMENT_ID,
		COLLATERAL_NAME,
		COLLATERAL_CODE,
		DATE_OF_REGISTRATION,
		YEAR_OF_MANUFACTURE,
		STORE_YARD,
		AUCTION_HOUSE,
		SUCCESSFUL_BIDDER,
		BIDDER_NRIC_ROC,
		CONTACT_NO,
		FIFTH_SCHED_SENDING_DATE,
		REGISTRATION_CARD,
		AUCTION_14DAYS_NOTICE_DATE,
		DATE_SOLD,
		SALES_PROCEED_AMOUNT as SALES_PROCEED_AMOUNT,
		SHORTFALL_DATE,
		E_DISCHARGE_DATE,
		SHORTFALL_NOTICE_DATE,
		FS_DATE,
		NI_DATE,
		LAST_5S_DATE,
		AUCTION_FEE,
		STORAGE_FEE,
		REPO_FEE,
		OTHER_INCIDENTAL_COST_PAID,
		TECHNICAL_REASON,
		TECHNICAL_REASON_DESCRIPTION,
		COC_SECTION42,
		COC_SECTION161A,
		NOTES ,
		RESERVE_PRICE,
		AUCTION_DATE,
		BIDDER_ADDRESS,
		TYPE_STATUS_ID
		from ptrtreatment_auction
		where
		TREATMENT_ID = #ID#
 	</select>


<!--  General Insert/Update Parameter Map for AuctionDetails Information -->
	
	<parameterMap id="insertAuctionDetailsTreatmentProcess-pmap" class="map">
	    <parameter property="ACCOUNT_ID" javaType="long"/>
		<parameter property="COLLATERAL_NAME" javaType="string" jdbcType="VARCHAR" />
		<parameter property="COLLATERAL_CODE" javaType="string" jdbcType="VARCHAR" />
		<parameter property="DATE_OF_REGISTRATION" javaType="date" jdbcType="DATE" />
		<parameter property="YEAR_OF_MANUFACTURE" javaType="string" jdbcType="VARCHAR" />
		<parameter property="STORE_YARD_NAME" javaType="string" jdbcType="VARCHAR" />
		<parameter property="STOREYARD_ID" javaType="long"  />
		<parameter property="AUCTION_HOUSE_ID" javaType="long"  />
		<parameter property="AUCTION_HOUSE_NAME" javaType="string" jdbcType="VARCHAR" />
		<parameter property="SUCCESSFUL_BIDDER" javaType="string" jdbcType="VARCHAR" />
		<parameter property="BIDDER_NRIC_ROC" javaType="string" jdbcType="VARCHAR" />
		
		<parameter property="CONTACT_NO" javaType="string" jdbcType="VARCHAR" />
		<parameter property="FIFTH_SCHED_SENDING_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="REGISTRATION_CARD" javaType="string" jdbcType="VARCHAR" />
		<parameter property="AUCTION_14DAYS_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="DATE_SOLD_AUCTION" javaType="date"/>
		<parameter property="SALES_PROCEED_AMT" javaType="double" />
		<parameter property="SHORTFALL_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="E_DISCHARGE_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="SHORTFALL_NOTICE_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="FS_DATE" javaType="date" jdbcType="DATE" />
		
		<parameter property="NI_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="LAST_5S_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="AUCTION_FEE" javaType="double" />
		<parameter property="STORAGE_FEE" javaType="double" />
		<parameter property="REPO_FEE" javaType="double" />
		<parameter property="OTHER_INCIDENTAL_COST_PAID" javaType="double" />
		<parameter property="TECHNICAL_REASON" javaType="string" jdbcType="VARCHAR" />
		<parameter property="TECHNICAL_REASON_DESCRIPTION" javaType="long" />
		<parameter property="COC_SECTION42" javaType="double" />
		<parameter property="COC_SECTION161A" javaType="double" />
		
		<parameter property="NOTES" jdbcType="VARCHAR"/>
		<parameter property="RESERVE_PRICE" javaType="double"/>
		<parameter property="AUCTION_DATE" javaType="date"/>
		<parameter property="BIDDER_ADDRESS" javaType="string"/>
		<parameter property="TREATMENT_ID" javaType="long"/>
		<parameter property="SUBTYPE_ID" javaType="long"/>
		<parameter property="TYPE_STATUS_ID" javaType="long"/>
	</parameterMap>

<!--  General Insert statement for AuctionDetails Information -->
	
	<insert id="insertAuctionDetailsTreatmentProcess" parameterClass="map">
		insert into
		ptrtreatment_auction
		(
		ACCOUNT_ID,
		COLLATERAL_NAME,
		COLLATERAL_CODE,
		DATE_OF_REGISTRATION,
		YEAR_OF_MANUFACTURE,
		STORE_YARD,
		STORE_YARD_ID,
		AUCTION_HOUSE_ID,
		AUCTION_HOUSE,
		SUCCESSFUL_BIDDER,
		BIDDER_NRIC_ROC,
		
		CONTACT_NO,
		FIFTH_SCHED_SENDING_DATE,
		REGISTRATION_CARD,
		AUCTION_14DAYS_NOTICE_DATE,
		DATE_SOLD,
		SALES_PROCEED_AMOUNT,
		SHORTFALL_DATE,
		E_DISCHARGE_DATE,
		SHORTFALL_NOTICE_DATE,
		FS_DATE,
		
		NI_DATE,
		LAST_5S_DATE,
		AUCTION_FEE,
		STORAGE_FEE,
		REPO_FEE,
		OTHER_INCIDENTAL_COST_PAID,
		TECHNICAL_REASON,
		TECHNICAL_REASON_DESCRIPTION,
		COC_SECTION42,
		COC_SECTION161A,
		
		NOTES, 
		RESERVE_PRICE,
		AUCTION_DATE,
		BIDDER_ADDRESS,
		TREATMENT_ID,
		SUBTYPE_ID,
		TYPE_STATUS_ID
		) values (#ACCOUNT_ID#,#COLLATERAL_NAME#, #COLLATERAL_CODE#, #DATE_OF_REGISTRATION#, #YEAR_OF_MANUFACTURE#, #STORE_YARD_NAME#, #STOREYARD_ID#, #AUCTION_HOUSE_ID#, #AUCTION_HOUSE_NAME#, #SUCCESSFUL_BIDDER#, #BIDDER_NRIC_ROC#, 
		#CONTACT_NO#, #FIFTH_SCHED_SENDING_DATE#, #REGISTRATION_CARD#, #AUCTION_14DAYS_NOTICE_DATE#, #DATE_SOLD_AUCTION#, #SALES_PROCEED_AMT#, #SHORTFALL_DATE#, #E_DISCHARGE_DATE#, #SHORTFALL_NOTICE_DATE#, #FS_DATE#, #NI_DATE#,
		#LAST_5S_DATE#, #AUCTION_FEE#, #STORAGE_FEE#, #REPO_FEE#, #OTHER_INCIDENTAL_COST_PAID#, #TECHNICAL_REASON#, #TECHNICAL_REASON_DESCRIPTION#, #COC_SECTION42#, #COC_SECTION161A#, #NOTES#,
		#RESERVE_PRICE#,#AUCTION_DATE#,#BIDDER_ADDRESS#,#ID#,#SUBTYPE_ID#,#TYPE_STATUS_ID#)
	</insert>

<!--  General Update statement for AuctionDetails Information -->	

	<update id="updateAuctionDetailsTreatmentProcess" parameterClass="map">
		update
		ptrtreatment_auction
		set
		COLLATERAL_NAME = #COLLATERAL_NAME#,
		COLLATERAL_CODE = #COLLATERAL_CODE#,
		DATE_OF_REGISTRATION = #DATE_OF_REGISTRATION# ,
		YEAR_OF_MANUFACTURE = #YEAR_OF_MANUFACTURE# ,
		STORE_YARD = #STORE_YARD_NAME# ,
		STORE_YARD_ID =#STOREYARD_ID# ,
		AUCTION_HOUSE_ID = #AUCTION_HOUSE_ID# ,
		AUCTION_HOUSE = #AUCTION_HOUSE_NAME# ,
		SUCCESSFUL_BIDDER = #SUCCESSFUL_BIDDER# ,
		BIDDER_NRIC_ROC = #BIDDER_NRIC_ROC# ,
		CONTACT_NO =#CONTACT_NO# ,
		FIFTH_SCHED_SENDING_DATE = #FIFTH_SCHED_SENDING_DATE# ,
		REGISTRATION_CARD = #REGISTRATION_CARD# ,
		AUCTION_14DAYS_NOTICE_DATE = #AUCTION_14DAYS_NOTICE_DATE# ,
		DATE_SOLD = #DATE_SOLD_AUCTION# ,
		SALES_PROCEED_AMOUNT = #SALES_PROCEED_AMT# ,
		SHORTFALL_DATE = #SHORTFALL_DATE# ,
		E_DISCHARGE_DATE = #E_DISCHARGE_DATE# ,
		SHORTFALL_NOTICE_DATE = #SHORTFALL_NOTICE_DATE# ,
		FS_DATE = #FS_DATE# ,
		NI_DATE = #NI_DATE# ,
		LAST_5S_DATE = #LAST_5S_DATE# ,
		AUCTION_FEE = #AUCTION_FEE# ,
		STORAGE_FEE = #STORAGE_FEE# ,
		REPO_FEE = #REPO_FEE# ,
		OTHER_INCIDENTAL_COST_PAID = #OTHER_INCIDENTAL_COST_PAID# ,
		TECHNICAL_REASON = #TECHNICAL_REASON# ,
		TECHNICAL_REASON_DESCRIPTION = #TECHNICAL_REASON_DESCRIPTION#,
		COC_SECTION42 =  #COC_SECTION42#,
		COC_SECTION161A =  #COC_SECTION161A# ,
		NOTES = #NOTES# ,
		RESERVE_PRICE = #RESERVE_PRICE# ,
		AUCTION_DATE = #AUCTION_DATE# ,
		BIDDER_ADDRESS =#BIDDER_ADDRESS#,
		TYPE_STATUS_ID=#TYPE_STATUS_ID# 
		where  TREATMENT_ID = #ID# 
  	</update>

<!--  Select Result Map for AuctionDetails UI Table Information-->

	<resultMap class="hmap" id="getAuctionDetailsTreatmentUITableInformation-rmap">
		<result property="ID" javaType="long" />
		<result property="TREATMENT_PROCESS_ID" javaType="long" />
		<result property="AUCTION_DATE" javaType="date" jdbcType="DATE" />
		<result property="RESERVE_PRICE" javaType="double" />
		<result property="AUCTION_STATUS_ID" javaType="long" />
		<result property="SALES_PROCEED_AMOUNT" javaType="double" />
		<result property="REMARK" javaType="string" jdbcType="VARCHAR" />
	</resultMap>

<!--  Query to get AuctionDetails UI Table Information -->

	<select id="getAuctionDetailsTreatmentUITableInformation" resultMap="getAuctionDetailsTreatmentUITableInformation-rmap">
		select
		ID,
		TREATMENT_PROCESS_ID,
		AUCTION_DATE,
		RESERVE_PRICE,
		AUCTION_STATUS_ID,
		SALES_PROCEED_AMOUNT,
		REMARK,
		TREATMENT_PROCESS_ID
		from PTRAUCTION_UITABLE
		where
		ID = #ID#
		and TREATMENT_PROCESS_ID = #TREATMENT_PROCESS_ID#
 	</select>

<!--  Insert/Update Parameter Map for AuctionDetails UI Table Information -->
	
	<parameterMap id="insertAuctionDetailsTreatmentUITableInformation-pmap" class="map">
		<parameter property="AUCTION_DATE" javaType="date" jdbcType="DATE" />
		<parameter property="RESERVE_PRICE" javaType="double" />
		<parameter property="AUCTION_STATUS_ID" javaType="long" />
		<parameter property="SALES_PROCEED_AMOUNT" javaType="double" />
		<parameter property="REMARK" javaType="string" jdbcType="VARCHAR" />
		<parameter property="ID" javaType="long" />
		<parameter property="TREATMENT_PROCESS_ID" javaType="long" />
	</parameterMap>

<!--  General Insert statement for AuctionDetails UI Table Information -->
	
	<insert id="insertAuctionDetailsTreatmentUITableInformation" parameterMap="insertAuctionDetailsTreatmentUITableInformation-pmap">
		insert into
		PTRAUCTION_UITABLE
		(
		AUCTION_DATE,
		RESERVE_PRICE,
		AUCTION_STATUS_ID,
		SALES_PROCEED_AMOUNT,
		REMARK, 
		ID,
		TREATMENT_PROCESS_ID
		) values (?, ?, ?, ?, ?, ?, ?)
	</insert>

<!--  General Update statement for AuctionDetails UI Table Information -->	

	<update id="updateAuctionDetailsTreatmentUITableInformation" parameterMap="insertAuctionDetailsTreatmentUITableInformation-pmap">
		update
		PTRAUCTION_UITABLE
		set
		AUCTION_DATE = ?,
		RESERVE_PRICE = ?,
		AUCTION_STATUS_ID = ?,
		SALES_PROCEED_AMOUNT = ?,
		REMARK = ?
		where  ID = ?
		and TREATMENT_PROCESS_ID = ?
  	</update>


 	<resultMap id="getAuctionDateStatus" class="hmap">
		<result property="ID" javaType="long" />
		<result property="STATUS_ID" javaType="long" />
		<result property="CODE" javaType="string" />
		<result property="DESCRIPTION" javaType="string" />
		<result property="DISABLE" javaType="boolean" />
		<result property="SORT_PRIORITY" javaType="long" />
		<result property="IS_AUCTION_SOLD" javaType="boolean" jdbcType="NUMERIC"/>
	</resultMap> 	
  	
  		<select id="getAuctionDateStatus"
		resultMap="getAuctionDateStatus">
		select TREATPROC_TYPE_STATUS_ID, TREATPROC_STATUS_ID,
		TREATPROC_TYPE_STATUS_CODE, TREATPROC_TYPE_STATUS_DESC, DISABLE,
		SORT_PRIORITY, case when TREATPROC_TYPE_STATUS_CODE = 'AUCTION_SOLD' then 1 else 0 end
		from PTRTREAT_PROC_TYPE_STATUS_REF where GROUP_ID=1001 and
		TREATPROC_TYPE_ID = 44
	</select>


<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields">
<result property="ACCOUNT_ID" javaType="long"/>
  <result property="SHORTFALL_DATE" javaType="date"/>
  <result property="POSTAGE_FEE" javaType="$"/>
  <result property="LAST_S5_DATE" javaType="date"/>
  <result property="AUCTION_FEE" javaType="$"/>
  <result property="STORAGE_FEE" javaType="$"/>
  <result property="REPOSSESSION_FEE" javaType="$"/>
  <result property="OTHER_INCIDENTAL_COST_PAID" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields" resultMap="getShortfallNoticeReadOnlyFields">
  	select 
  	trans.ACCOUNT_ID,
	case when trf.code in ('007','008') then trans.effective_date end as SHORTFALL_DATE, 
	case when trf.code = '011' then trans.amount end as POSTAGE_FEE, 
	case when trf.code = '011' then trans.effective_date end as LAST_S5_DATE, 
	0 as AUCTION_FEE, 
	0 as STORAGE_FEE, 
	0 as REPOSSESSION_FEE,
	0 as OTHER_INCIDENTAL_COST_PAID
	from ptrtransaction trans 
	left join ptrtransaction_type_ref trf on (trans.transaction_type_id = trf.id)
	left join PTRCHARGE_TYPE_REF ct on trans.CHARGE_TYPE_ID = ct.ID
	where trans.account_id = #ACCOUNT_ID#
  	</select>
  	
  	<resultMap class="hmap" id="get14DaysDateforAucaytion">
		<result javaType="string" property="AUCTION_DATE_AUCTION"/>
		<result javaType="date" property="AUCTION_DATE_AUCTION_DATE"/>
		<result javaType="long" property="ID"/>
	</resultMap>
	
	<select id="get14DaysDateforAucaytion" resultMap="get14DaysDateforAucaytion">
		select n.DATE, n.DATE1,n.id from PTR14_DAYS_NOTICE a,
		table
		(values
		(COALESCE(to_char(FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIRST_AUCTION_DATE,0 ),
		(COALESCE(to_char(SECOND_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SECOND_AUCTION_DATE, 1),
		(COALESCE(to_char(THIRD_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRD_AUCTION_DATE, 2),
		(COALESCE(to_char(FOURTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FOURTH_AUCTION_DATE, 3),
		(COALESCE(to_char(FIFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIFTH_AUCTION_DATE, 4),
		(COALESCE(to_char(SIXTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SIXTH_AUCTION_DATE,5 ),
		(COALESCE(to_char(SEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SEVENTH_AUCTION_DATE, 6),
		(COALESCE(to_char(EIGHT_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), EIGHT_AUCTION_DATE, 7),
		(COALESCE(to_char(NINTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), NINTH_AUCTION_DATE, 8),
		(COALESCE(to_char(TENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TENTH_AUCTION_DATE, 9),
		(COALESCE(to_char(ELEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), ELEVENTH_AUCTION_DATE,10 ),
		
		(COALESCE(to_char(TWELFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWELFTH_AUCTION_DATE,11 ),
		(COALESCE(to_char(THIRTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTEENTH_AUCTION_DATE, 12),
		(COALESCE(to_char(FOURTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FOURTEENTH_AUCTION_DATE, 13),
		(COALESCE(to_char(FIFTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIFTEENTH_AUCTION_DATE, 14),
		(COALESCE(to_char(SIXTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SIXTEENTH_AUCTION_DATE, 15),
		(COALESCE(to_char(SEVENTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SEVENTEENTH_AUCTION_DATE,16 ),
		(COALESCE(to_char(EIGHTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), EIGHTEENTH_AUCTION_DATE, 17),
		(COALESCE(to_char(NINETEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), NINETEENTH_AUCTION_DATE, 18),
		(COALESCE(to_char(TWENTIETH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTIETH_AUCTION_DATE, 19),
		(COALESCE(to_char(TWENTY_FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FIRST_AUCTION_DATE, 20),
		(COALESCE(to_char(TWENTY_SECOND_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SECOND_AUCTION_DATE,21 ),
		(COALESCE(to_char(TWENTY_THIRD_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_THIRD_AUCTION_DATE,22 ),
		(COALESCE(to_char(TWENTY_FOURTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FOURTH_AUCTION_DATE, 23),
		(COALESCE(to_char(TWENTY_FIFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FIFTH_AUCTION_DATE, 24),
		(COALESCE(to_char(TWENTY_SIXTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SIXTH_AUCTION_DATE, 25),
		(COALESCE(to_char(TWENTY_SEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SEVENTH_AUCTION_DATE, 26),
		(COALESCE(to_char(TWENTY_EIGHTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_EIGHTH_AUCTION_DATE,27 ),
		(COALESCE(to_char(TWENTY_NINTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_NINTH_AUCTION_DATE, 28),
		(COALESCE(to_char(THIRTIETH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTIETH_AUCTION_DATE, 29),
		(COALESCE(to_char(THIRTY_FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTY_FIRST_AUCTION_DATE, 30)
		
		)
		as n(DATE, DATE1,id)
		where a.TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTR14_DAYS_NOTICE c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# and b.PROCESS_STATUS_ID = 15004 )
	</select>
	
	<resultMap class="hmap" id="get14DaysDateforAucaytionDateSold">
		<result javaType="string" property="SOLD_DATE_AUCTION"/>
		<result javaType="date" property="SOLD_DATE_AUCTION_DATE"/>
	</resultMap>
	
	<select id="get14DaysDateforAucaytionDateSold" resultMap="get14DaysDateforAucaytionDateSold">
		select n.DATE, n.DATE1 from PTR14_DAYS_NOTICE a,
		table
		(values
		(COALESCE(to_char(FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIRST_AUCTION_DATE ),
		(COALESCE(to_char(SECOND_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SECOND_AUCTION_DATE ),
		(COALESCE(to_char(THIRD_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRD_AUCTION_DATE ),
		(COALESCE(to_char(FOURTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FOURTH_AUCTION_DATE ),
		(COALESCE(to_char(FIFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIFTH_AUCTION_DATE ),
		(COALESCE(to_char(SIXTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SIXTH_AUCTION_DATE ),
		(COALESCE(to_char(SEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SEVENTH_AUCTION_DATE ),
		(COALESCE(to_char(EIGHT_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), EIGHT_AUCTION_DATE ),
		(COALESCE(to_char(NINTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), NINTH_AUCTION_DATE ),
		(COALESCE(to_char(TENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TENTH_AUCTION_DATE ),
		(COALESCE(to_char(ELEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), ELEVENTH_AUCTION_DATE ),
		
		(COALESCE(to_char(TWELFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWELFTH_AUCTION_DATE ),
		(COALESCE(to_char(THIRTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTEENTH_AUCTION_DATE),
		(COALESCE(to_char(FOURTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FOURTEENTH_AUCTION_DATE),
		(COALESCE(to_char(FIFTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), FIFTEENTH_AUCTION_DATE),
		(COALESCE(to_char(SIXTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SIXTEENTH_AUCTION_DATE),
		(COALESCE(to_char(SEVENTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), SEVENTEENTH_AUCTION_DATE),
		(COALESCE(to_char(EIGHTEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), EIGHTEENTH_AUCTION_DATE),
		(COALESCE(to_char(NINETEENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), NINETEENTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTIETH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTIETH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FIRST_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_SECOND_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SECOND_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_THIRD_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_THIRD_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_FOURTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FOURTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_FIFTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_FIFTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_SIXTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SIXTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_SEVENTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_SEVENTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_EIGHTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_EIGHTH_AUCTION_DATE),
		(COALESCE(to_char(TWENTY_NINTH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), TWENTY_NINTH_AUCTION_DATE),
		(COALESCE(to_char(THIRTIETH_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTIETH_AUCTION_DATE),
		(COALESCE(to_char(THIRTY_FIRST_AUCTION_DATE,'dd-mm-yyyy HH12:MI AM '), 'Not Provided'), THIRTY_FIRST_AUCTION_DATE)
		)
		as n(DATE, DATE1)
		where a.TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTR14_DAYS_NOTICE c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# and b.PROCESS_STATUS_ID = 15004 )
	</select>
	
	<resultMap id="getAuctionHistory" class="hmap">
	<result property="AUCTION_DATE" javaType="date" />
		<result property="RESERVE_PRICE" javaType="double" />
		<result property="REMARK" javaType="string" />
		<result property="AUCTION_STATUS" javaType="string" />
		<result property="SALES_PROCEED_AMOUNT" javaType="double" />
	</resultMap> 	
  	
  		<select id="getAuctionHistory"
		resultMap="getAuctionHistory">
		SELECT 
		a.AUCTION_DATE,
		a.RESERVE_PRICE,
		a.NOTES,
		c.TREATPROC_TYPE_STATUS_DESC,
		a.SALES_PROCEED_AMOUNT
		FROM PTRAUCTION a 
		inner join PTRTREATMENT_PROCESS b on a.TREATMENT_PROCESS_ID = b.TREATMENT_PROCESS_ID
		inner join PTRACC_TREATMENT_PLAN d on b.TREATMENT_PLAN_ID = d.TREATMENT_PLAN_ID
		inner join PTRTREAT_PROC_TYPE_STATUS_REF c on b.PROCESS_TYPE_STATUS_ID = c.TREATPROC_TYPE_STATUS_ID
		where d.ACCOUNT_ID = #ACCOUNT_ID#
		order by a.AUCTION_DATE asc
	</select>
	
	<resultMap id="getShortfallDate" class="hmap">
		<result property="SHORTFALL_NOTICE_DATE" javaType="date" />
	</resultMap> 	
  	
  		<select id="getShortfallDate"
		resultMap="getShortfallDate">
		SELECT 
		a.PRINTING_DATE
		FROM PTRSHORTFALL a 
		where a.TREATMENT_PROCESS_ID = (SELECT MAX(c.TREATMENT_PROCESS_ID) FROM ptracc_treatment_plan a inner join ptrtreatment_process b on a.TREATMENT_PLAN_ID = b.TREATMENT_PLAN_ID
		inner join PTRSHORTFALL c on b.TREATMENT_PROCESS_ID = c.TREATMENT_PROCESS_ID WHERE a.ACCOUNT_ID = #ACCOUNT_ID# and b.PROCESS_STATUS_ID = 15004 )
	</select>
	
	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields1">
  <result property="SHORTFALL_DATE" javaType="date"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields1" resultMap="getShortfallNoticeReadOnlyFields1">
   select 
	trans.transaction_date as SHORTFALL_DATE
	from ptrtransaction trans 
	inner join ptrtransaction_type_ref trf on (trans.transaction_type = trf.id)
	where trans.account_id = #ACCOUNT_ID# and trf.code in ('007','008') and trans.transaction_date is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields2">
  <result property="POSTAGE_FEE" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields2" resultMap="getShortfallNoticeReadOnlyFields2">
  select 
	trans.amount as POSTAGE_FEE
	from ptrtransaction trans 
	inner join ptrtransaction_type_ref trf on (trans.transaction_type = trf.id)
	where trans.account_id = #ACCOUNT_ID# and trf.code = '011' and trans.amount is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields3">
  <result property="LAST_S5_DATE" javaType="date"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields3" resultMap="getShortfallNoticeReadOnlyFields3">
    select 
	trans.transaction_date as LAST_S5_DATE
	from ptrtransaction trans 
	inner join ptrtransaction_type_ref trf on (trans.transaction_type = trf.id)
	where trans.account_id = #ACCOUNT_ID# and trf.code = '011' and trans.transaction_date is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields4">
   <result property="AUCTION_FEE" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields4" resultMap="getShortfallNoticeReadOnlyFields4">
  select 
	trans.amount as AUCTION_FEE
	from ptrtransaction trans 
	inner join PTRCHARGE_TYPE_REF ct on trans.CHARGE_TYPE_ID = ct.ID
	where trans.account_id = #ACCOUNT_ID# and ct.code = '09' and trans.amount is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields5">
  <result property="STORAGE_FEE" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields5" resultMap="getShortfallNoticeReadOnlyFields5">
  select 
	trans.amount as STORAGE_FEE
	from ptrtransaction trans 
	inner join PTRCHARGE_TYPE_REF ct on trans.CHARGE_TYPE_ID = ct.ID
	where trans.account_id = #ACCOUNT_ID# and ct.code = '10' and trans.amount is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields6">
  <result property="REPOSSESSION_FEE" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields6" resultMap="getShortfallNoticeReadOnlyFields6">
  select 
	trans.amount as STORAGE_FEE
	from ptrtransaction trans 
	inner join PTRCHARGE_TYPE_REF ct on trans.CHARGE_TYPE_ID = ct.ID
	where trans.account_id = #ACCOUNT_ID# and ct.code in ('06','89') and trans.amount is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  		<resultMap class="hmap" id="getShortfallNoticeReadOnlyFields7">
  <result property="OTHER_INCIDENTAL_COST_PAID" javaType="$"/>
  </resultMap>	
  
  <select id="getShortfallNoticeReadOnlyFields7" resultMap="getShortfallNoticeReadOnlyFields7">
  select 
	trans.amount as OTHER_INCIDENTAL_COST_PAID
	from ptrtransaction trans 
	inner join PTRCHARGE_TYPE_REF ct on trans.CHARGE_TYPE_ID = ct.ID
	where trans.account_id = #ACCOUNT_ID# and ct.code in ('07','37') and trans.amount is not null
	order by trans.transaction_date desc
	fetch first row only
  	</select>
  	
  	
  	
  	
  	
  	
  	
  <!-- 	
  1.	Auction Fee – Pick up from Ledger under the charge type 09 – Auction Fee (latest debit transaction only)
-->
<resultMap id="getAuctionDetailsAuctionFee" class="hmap"> 
<result property="ACCOUNT_ID" javaType="long"/>
<result property="AUCTION_FEE" javaType="$"/>
	</resultMap>
	
	<select id="getAuctionDetailsAuctionFee" resultMap="getAuctionDetailsAuctionFee">
select t.ACCOUNT_ID, t.AMOUNT
from ptrtransaction t
inner join PTRCHARGE_TYPE_REF tt on tt.ID=t.CHARGE_TYPE_ID
where t.account_id=#ACCOUNT_ID# and tt.CODE='09' and t.DEBIT_CREDIT_FLAG='C'
order by t.ID desc
fetch first row only
</select>

<!-- 
2.	Storage Fee – Latest Charge Type 10 – Storage Fee and evaluate based on debit transaction only. 
Use current/Latest Fee amount on or after the current/Latest Date of Repossession.
Example :  
1st Repossession Dated 01/01/10
1st Repossession’s (10)Storage Fee  RM500.00 debited on 03/01/10

Latest or 2nd Repossession Dated 15/07/15
Latest or 2nd Repossession’s (10)Storage Fee RM210.00 debited on 15/07/15

Ecollect Storage Fee field will capture the latest Storage Fee RM210.00 debited on 15/07/15 only.
(please do not capture 1st Storage Fee RM500.00 or cumulative the 1st and 2nd Storage Fee totaling RM710.00)
  	 -->
<resultMap id="getAuctionDetailsStorageFee" class="hmap"> 
<result property="ACCOUNT_ID" javaType="long"/>
 <result property="STORAGE_FEE" javaType="$"/>
</resultMap>

<select id="getAuctionDetailsStorageFee" resultMap="getAuctionDetailsStorageFee">
select pl.account_id, trans.AMOUNT
from ptrrepossession_order po
inner join ptrtreatment_process tp on tp.treatment_process_id=po.treatment_process_id
inner join ptracc_treatment_plan pl on pl.treatment_plan_id=tp.treatment_plan_id
inner join (
select t.ACCOUNT_ID, t.AMOUNT, t.TRANSACTION_DATE from ptrtransaction t
inner join PTRCHARGE_TYPE_REF tt on tt.ID=t.CHARGE_TYPE_ID
where t.account_id=#ACCOUNT_ID# and tt.CODE='10' and t.DEBIT_CREDIT_FLAG=1
order by t.ID desc
fetch first row only
) trans on trans.ACCOUNT_ID=pl.ACCOUNT_ID
where pl.account_id=#ACCOUNT_ID# and tp.PROCESS_TYPE_ID=23 and po.REPOSESSION_DATE is not null and trans.TRANSACTION_DATE >= po.REPOSESSION_DATE
order by po.REPOSESSION_DATE desc
fetch first row only
</select>

<!-- 
3.	Repossession Fee - Latest Charge Type 06 and 89 – Storage Fee and evaluate based on debit transaction only. 
Use current/Latest Fee amount on or after the current/Latest Date of Repossession.
*Both Charge Type 06 and 89 are refer to Repossession Fee.
Example :  
1st Repossession Dated 01/01/10
1st Repossession’s  (06)Repossession Fee  RM800.00 debited on 18/01/10.

Latest or 2nd Repossession Dated 15/07/15
Latest or 2nd Repossession’s (89)Repossession Fee RM1,800.00 debited on 17/07/15.

Ecollect Repossession Fee field will capture the latest (89)Repossession Fee RM1,800.00 only.
(please do not capture 1st Repossession Fee RM800.00 or cumulative the 1st and 2nd Repossession Fee totaling RM2,600.00)
  	 -->
<resultMap id="getAuctionDetailsRepossessionFee" class="hmap"> 
<result property="ACCOUNT_ID" javaType="long"/>
  <result property="REPO_FEE" javaType="$"/>
  </resultMap>
  
  <select id="getAuctionDetailsRepossessionFee" resultMap="getAuctionDetailsRepossessionFee">
select pl.account_id, trans.AMOUNT
from ptrrepossession_order po
inner join ptrtreatment_process tp on tp.treatment_process_id=po.treatment_process_id
inner join ptracc_treatment_plan pl on pl.treatment_plan_id=tp.treatment_plan_id
inner join (
select t.ACCOUNT_ID, t.AMOUNT, t.TRANSACTION_DATE from ptrtransaction t
inner join PTRCHARGE_TYPE_REF tt on tt.ID=t.CHARGE_TYPE_ID
where t.account_id=#ACCOUNT_ID# and tt.CODE in ('06','89') and t.DEBIT_CREDIT_FLAG=1
order by t.ID desc
fetch first row only
) trans on trans.ACCOUNT_ID=pl.ACCOUNT_ID
where pl.account_id=#ACCOUNT_ID# and tp.PROCESS_TYPE_ID=23 and po.REPOSESSION_DATE is not null and trans.TRANSACTION_DATE >= po.REPOSESSION_DATE
order by po.REPOSESSION_DATE desc
fetch first row only
</select>

<!-- 
4.	Other Incidental Cost Paid – Pick up from the ledger, Charge Type 07- Transport/Tow and 37-Repairs and Maintenance evaluate 
based on the debit transaction only. Use current/Latest Cost amount before or after the Latest Date of Repossession.

Example :
Latest Repossession Dated 15/07/15
Latest (37)Repairs /Maintenance RM1,800.00 debited on 01/07/15 (before the latest Repo Date)
Latest (17) Transport/Tow RM200.00 debited on 02/02/15 (After the latest Repo Date)
Ecollect Other Incidental Cost will capture the latest (37)Repairs/Maintenance RM1,800.00 and latest (17)Transport/Tow RM200.00 simulteneously, thus, the amount will be the cumulative amount totaling RM2,000.00.
(please do not display the amount for 37 and 17  separately for Other Incidental Cost.)
  	 -->
<resultMap id="getAuctionDetailsOtherIncidentalCostPaid" class="hmap"> 
<result property="ACCOUNT_ID" javaType="long"/>
<result property="OTHER_INCIDENTAL_COST_PAID" javaType="$"/>	
</resultMap>

<select id="getAuctionDetailsOtherIncidentalCostPaid" resultMap="getAuctionDetailsOtherIncidentalCostPaid">
select t.ACCOUNT_ID, sum(t.AMOUNT) as AMOUNT from ptrtransaction t
where t.account_id=#ACCOUNT_ID# and t.id in 
(
select max(t.ID) from ptrtransaction t
inner join PTRCHARGE_TYPE_REF tt on tt.ID=t.CHARGE_TYPE_ID
where t.account_id=#ACCOUNT_ID# and tt.CODE in ('07','37') and t.DEBIT_CREDIT_FLAG=1
group by tt.CODE
)
group by t.ACCOUNT_ID
</select>
  	
  	
  	
  	

</sqlMap>
