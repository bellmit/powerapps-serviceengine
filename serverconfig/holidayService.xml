<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="holidayService">
	<resultMap id="getHolidays" class="hmap" extends="global.ref">
		<result property="HOLIDAY_DATE" javaType="date" />
		<result property="DAYS" javaType="long" />
		<result property="CREATED_TIME" javaType="ts" />
		<result property="CREATED_BY" javaType="string" />
		<result property="UPDATED_TIME" javaType="ts" />
		<result property="UPDATED_BY" javaType="string" />
	</resultMap>
	<select id="getHolidays" resultMap="getHolidays" >
		<include refid="refselect" />,HOLIDAY_DATE,DAYS,CREATED_TIME,CREATED_BY,UPDATED_TIME,UPDATED_BY
		FROM PTRHOLIDAY
		<isNotEqual property="INCLUDE_ALL" compareValue="true">
		WHERE DISABLE = <include refid="false"/>
		</isNotEqual>
		ORDER BY HOLIDAY_DATE DESC
	</select>
	<resultMap id="getHolidayAllState" class="hmap">
		<result property="STATE_ID" javaType="long" />
		<result property="DESCRIPTION" javaType="string" />
	</resultMap>
	<select id="getHolidayAllState" resultMap="getHolidayAllState" >
		SELECT ID,DESCRIPTION FROM PTRSTATE_REF
		WHERE DISABLE = <include refid="false"/>
	</select>
	<resultMap id="getStateHolidays" class="hmap">
		<result property="STATE_ID" javaType="long" />
		<result property="CHECKED" javaType="boolean" />
	</resultMap>
	<select id="getStateHolidays" resultMap="getStateHolidays" >
		SELECT state_id,<include refid="true"/> 
		FROM ptrholiday_state_rel where HOLIDAY_ID = #HOLIDAY_ID#
	</select>
	<resultMap id="getHolidayForEditing" class="hmap" extends="global.ref">
		<result property="HOLIDAY_DATE" javaType="date" />
		<result property="DAYS" javaType="long" />
		<result property="DISABLE" javaType="boolean" />
	</resultMap>
	<select id="getHolidayForEditing" resultMap="getHolidayForEditing" >
		<include refid="refselect" />,HOLIDAY_DATE,DAYS,DISABLE
		FROM PTRHOLIDAY WHERE ID = #HOLIDAY_ID#
	</select>
	<insert id="insertHoliday">
		<selectKey keyProperty="ID" resultClass="long">
			<include refid="sequencePrefix" />
			PTRHOLIDAY_ID
			<include refid="sequenceSuffix" />
		</selectKey>
		insert into PTRHOLIDAY (CODE, DESCRIPTION, DISABLE,
		SORT_PRIORITY, ID,DAYS, HOLIDAY_DATE, CREATED_TIME, CREATED_BY)
		values (#CODE#, #DESCRIPTION#, 
		case when #DISABLE# = <include refid="true"/> then <include refid="true"/> else <include refid="false"/> end, 
		#ID#, #ID#, #DAYS#, #HOLIDAY_DATE#, #CURRENT_TIME#, #LOGON_USER#)
	</insert>
	<insert id="insertHolidayState">
		insert into PTRHOLIDAY_STATE_REL(STATE_ID,HOLIDAY_ID)
		values(#STATE_ID#, #HOLIDAY_ID#)
	</insert>
	<delete id="deleteHolidayState">
	delete from PTRHOLIDAY_STATE_REL where holiday_id = #HOLIDAY_ID#</delete>
	<update id="updateHoliday">
		update PTRHOLIDAY set
		CODE = #CODE#,
		DESCRIPTION = #DESCRIPTION#,
		DISABLE = case when #DISABLE# = <include refid="true"/> then <include refid="true"/> else <include refid="false"/> end,
		DAYS = #DAYS#,
		HOLIDAY_DATE = #HOLIDAY_DATE#,
		UPDATED_TIME = #CURRENT_TIME#,
		UPDATED_BY = #LOGON_USER#
		where ID = #HOLIDAY_ID#
	</update>
</sqlMap>
